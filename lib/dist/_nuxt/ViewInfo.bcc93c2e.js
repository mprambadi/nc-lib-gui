import{f as re,bF as $,$ as me,M as _e,r as I,H as J,c9 as ve,o as n,c as u,O as e,S as v,au as ne,ey as fe,a as x,W as se,bv as le,P as z,w as r,d as M,t as h,b as d,T as w,U as C,a0 as ce,a1 as ue,C as we,g as xe,aK as ye}from"./entry.96205fa0.js";import{_ as be}from"./ProjectIcon.384805e6.js";import{_ as de}from"./Tooltip.vue.00c0d0fb.js";import{_ as he}from"./nuxt-link.672ede79.js";import{_ as ge}from"./ViewIcon.vue.fd0fd4d4.js";import{c as Ve,b as ke}from"./ViewActionMenu.bc73aa7b.js";import{_ as Te}from"./Icon.vue.6d0583a0.js";import{_ as De}from"./Dropdown.vue.93f98e1e.js";import{c as F,a as Q,d as Ie}from"./bases.965a49bb.js";import{u as X}from"./views.2c163cf7.js";import{u as $e}from"./index.a2bc84ea.js";import{u as ze}from"./sidebar.30294def.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./iconify.e008aad7.js";import"./DeleteModal.vue.49c1a59b.js";import"./Button.vue.02ce6d5b.js";import"./index.9e8f59f4.js";import"./debounce.1d5af9bf.js";import"./toNumber.ed208f2f.js";import"./isSymbol.d46b4957.js";import"./Modal.vue.b787f37f.js";import"./Select.vue.5a200a6a.js";import"./index.b5e393d6.js";import"./toArray.3561b70e.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.dbc63a5f.js";import"./useState.5a301439.js";import"./CheckOutlined.3b90c20d.js";import"./SearchOutlined.c9794270.js";import"./FormItemContext.b19eb48c.js";import"./Modal.vue.3dac5189.js";import"./index.1431a68b.js";import"./Input.3f1aaf0c.js";import"./isPlainObject.631eb8fb.js";import"./_getPrototype.459a70cf.js";import"./TextArea.b81a19ed.js";import"./Password.803cc3dc.js";import"./index.886d43e1.js";import"./FormItem.9f1f85f2.js";import"./identity.309e9ead.js";import"./Col.b3c5d725.js";import"./responsiveObserve.358bcfe9.js";import"./useSize.c98e621d.js";import"./_flatRest.ce557a88.js";import"./Divider.82129fc6.js";import"./index.c968c966.js";import"./Menu.vue.55c6ca4d.js";import"./index.9b87fcff.js";import"./useCopy.00050b95.js";import"./index.6c1d17b6.js";import"./Dropdown.1dedd322.js";import"./RightOutlined.3ce786f5.js";import"./index.0c5b3837.js";import"./useSharedView.9e320acb.js";const Se=ce(()=>ue(()=>import("./Reload.678dd55c.js"),["./Reload.678dd55c.js","./entry.96205fa0.js","./entry.d09b2482.css","./views.2c163cf7.js","./bases.965a49bb.js","./index.0c5b3837.js","./useSharedView.9e320acb.js","./index.9b87fcff.js"],import.meta.url).then(y=>y.default||y)),Be=re({__name:"OpenedViewAction",setup(y){const{activeTable:t}=$(F()),{isMobileMode:s}=me(),{isSharedBase:p,base:b}=$(Q()),{t:S}=_e(),{$api:_}=we(),{refreshCommandPalette:K}=Ie(),{activeView:a,views:H,openedViewsTab:Y,viewsByTable:Z}=$(X()),{loadViews:q,removeFromRecentViews:O}=X(),{navigateToTable:P}=F(),f=I(!1),U=I(!1),g=I(!1),V=I(),l=I(""),m=I(),A=()=>{g.value=!0,f.value=!1,l.value=a.value.title,setTimeout(()=>{V.value.focus()})};J(V,()=>{var i;(i=V.value)==null||i.focus()});const B=async()=>{var i;L()?(a.value.title=l.value,g.value=!1,m.value=void 0,await _.dbView.update(a.value.id,{title:l.value})):(i=V.value)==null||i.focus()};function L(){return!l.value||l.value.trim().length<0?(m.value=S("msg.error.viewNameRequired"),!1):l.value.trim().length>255?(m.value=S("msg.error.nameMaxLength256"),!1):H.value.some(i=>i.title===l.value&&i.id!==a.value.id)?(m.value=S("msg.error.viewNameDuplicate"),!1):!0}J(l,()=>{m.value&&(m.value=void 0)}),J(f,()=>{setTimeout(()=>{U.value=!1},250)});const j=()=>{l.value=a.value.title,g.value=!1};function E(){const i=I(!0);f.value=!1;const{close:o}=$e(Ve,{modelValue:i,view:a.value,"onUpdate:modelValue":c,onDeleted:async()=>{var T,G;c(),O({viewId:a.value.id,tableId:a.value.fk_model_id,baseId:b.value.id}),K(),((T=a.value)==null?void 0:T.id)===a.value.id&&P({tableId:t.value.id,baseId:b.value.id}),await q({tableId:t.value.id,force:!0});const k=((G=Z.value.get(t.value.id))==null?void 0:G.filter(W=>!W.is_default))??[];t.value.meta={...t.value.meta,hasNonDefaultViews:k.length>1}}});function c(){i.value=!1,o(1e3)}}return(i,o)=>{var ee,te;const c=Te,k=de,T=ke,G=De,W=Se,pe=ve("e");return n(),u(C,null,[e(g)?(n(),u("div",{key:0,class:v(["h-6 relative",{"max-w-2/5":!e(p)&&!e(s)&&((ee=e(a))==null?void 0:ee.is_default),"max-w-3/5":!e(p)&&!e(s)&&!((te=e(a))!=null&&te.is_default)}])},[ne(x("input",{ref_key:"renameInputDom",ref:V,"onUpdate:modelValue":o[0]||(o[0]=D=>se(l)?l.value=D:null),class:v(["ml-0.25 w-full px-1 py-0.5 rounded-md font-medium text-gray-800",{"outline-brand-500":!e(m),"outline-red-500 pr-6":e(m)}]),onBlur:B,onKeydown:[le(B,["enter"]),le(j,["esc"])]},null,34),[[fe,e(l)]]),e(m)?(n(),z(k,{key:0,class:"absolute top-0.25 right-0.5 bg-white rounded-lg"},{title:r(()=>[M(h(e(m)),1)]),default:r(()=>[d(c,{icon:"info",class:"cursor-pointer"})]),_:1})):w("",!0)],2)):(n(),z(G,{key:1,visible:e(f),"onUpdate:visible":o[2]||(o[2]=D=>se(f)?f.value=D:null),class:"!xs:pointer-events-none nc-actions-menu-btn nc-view-context-btn","overlay-class-name":"nc-dropdown-actions-menu"},{overlay:r(()=>[d(T,{table:e(t),view:e(a),onCloseModal:o[1]||(o[1]=D=>f.value=!1),onRename:A,onDelete:E},null,8,["table","view"])]),default:r(()=>{var D,ae,oe,ie;return[ne((n(),u("div",{class:v(["truncate nc-active-view-title flex gap-0.5 items-center !hover:bg-gray-100 !hover:text-gray-800 ml-1 pl-1 pr-0.25 rounded-md py-1 cursor-pointer",{"max-w-2/5":!e(p)&&!e(s)&&((D=e(a))==null?void 0:D.is_default),"max-w-3/5":!e(p)&&!e(s)&&!((ae=e(a))!=null&&ae.is_default),"max-w-1/2":e(s),"text-gray-500":(oe=e(a))==null?void 0:oe.is_default,"text-gray-800 font-medium":!((ie=e(a))!=null&&ie.is_default)}])},[d(k,{class:"truncate xs:pl-1.25 flex-1 text-inherit","show-on-truncate-only":""},{title:r(()=>{var N,R;return[M(h((N=e(a))!=null&&N.is_default?i.$t("title.defaultView"):(R=e(a))==null?void 0:R.title),1)]}),default:r(()=>{var N,R;return[x("span",{class:v({"max-w-28/100":!e(s)})},h((N=e(a))!=null&&N.is_default?i.$t("title.defaultView"):(R=e(a))==null?void 0:R.title),3)]}),_:1}),d(c,{icon:"arrowDown",class:"ml-1"})],2)),[[pe,["c:breadcrumb:view-actions"]]])]}),_:1},8,["visible"])),e(Y)==="view"&&!e(s)&&!e(g)?(n(),z(W,{key:2})):w("",!0)],64)}}}),Ne={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Re=x("path",{fill:"currentColor",d:"M5 4h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2m0 4v4h6V8zm8 0v4h6V8zm-8 6v4h6v-4zm8 0v4h6v-4z"},null,-1),Ce=[Re];function Me(y,t){return n(),u("svg",Ne,[...Ce])}const Oe={name:"mdi-table",render:Me},Pe=ce(()=>ue(()=>import("./EmojiPicker.65c4bf1b.js"),["./EmojiPicker.65c4bf1b.js","./entry.96205fa0.js","./entry.d09b2482.css","./iconify.e008aad7.js","./_plugin-vue_export-helper.c27b6911.js","./index.6c1d17b6.js","./Dropdown.1dedd322.js","./RightOutlined.3ce786f5.js","./EmojiPicker.9b8b75ab.css"],import.meta.url).then(y=>y.default||y)),Ue={class:"capitalize"},Ae={class:"flex flex-row items-center gap-x-1.5"},Le={class:"truncate !text-inherit capitalize"},je=x("div",{class:"px-1.75 text-gray-500"},"/",-1),Ee={key:2,class:"pl-1.25 text-gray-500"},Ft=re({__name:"ViewInfo",setup(y){const{isMobileMode:t}=me(),{activeView:s}=$(X()),{base:p,isSharedBase:b}=$(Q()),{baseUrl:S}=Q(),{activeTable:_}=$(F()),{tableUrl:K}=F(),{isLeftSidebarOpen:a}=$(ze()),H=xe(()=>p.value?`${window.location.origin}/#${S({id:p.value.id,type:"database"})}`:"");return(Y,Z)=>{var l,m,A,B,L,j,E,i;const q=be,O=de,P=he,f=Oe,U=Pe,g=ge,V=Be;return n(),u("div",{class:v(["ml-0.25 flex flex-row font-medium items-center border-gray-50 transition-all duration-100",{"min-w-36/100 max-w-36/100":!e(t)&&e(a),"min-w-39/100 max-w-39/100":!e(t)&&!e(a),"w-2/3 text-base ml-1.5":e(t),"!max-w-3/4":e(b)&&!e(t)}])},[e(t)?w("",!0):(n(),u(C,{key:0},[d(P,{class:v(["!hover:text-black !hover:underline-gray-600 !underline-transparent ml-0.75 max-w-1/4",{"!max-w-none":e(b)&&!e(t),"!text-gray-500":e(_),"!text-gray-700":!e(_)}]),to:e(H)},{default:r(()=>[d(O,{class:"!text-inherit"},{title:r(()=>{var o;return[x("span",Ue,h((o=e(p))==null?void 0:o.title),1)]}),default:r(()=>{var o,c;return[x("div",Ae,[d(q,{meta:{type:(o=e(p))==null?void 0:o.type},class:"!grayscale min-w-4",style:ye({filter:"grayscale(100%) brightness(115%)"})},null,8,["meta","style"]),x("div",{class:v(["hidden !2xl:flex !2xl:truncate !2xl:ml-1",{"!flex":e(b)&&!e(t)}])},[x("span",Le,h((c=e(p))==null?void 0:c.title),1)],2)])]}),_:1})]),_:1},8,["class","to"]),je],64)),e(t)&&!((l=e(s))!=null&&l.is_default)?w("",!0):(n(),u(C,{key:1},[e(t)?(n(),z(U,{key:0,emoji:(A=(m=e(_))==null?void 0:m.meta)==null?void 0:A.icon,readonly:"",size:"xsmall"},{default:r(()=>[d(f,{class:v(["min-w-5",{"!text-gray-500":!e(t),"!text-gray-700":e(t)}])},null,8,["class"])]),_:1},8,["emoji"])):w("",!0),e(_)?(n(),u("div",{key:1,class:v({"max-w-1/2":e(t)||((B=e(s))==null?void 0:B.is_default),"max-w-20/100":!e(b)&&!e(t)&&!((L=e(s))!=null&&L.is_default),"max-w-none":e(b)&&!e(t)})},[d(O,{class:"truncate nc-active-table-title max-w-full","show-on-truncate-only":""},{title:r(()=>{var o;return[M(h((o=e(_))==null?void 0:o.title),1)]}),default:r(()=>{var o,c,k;return[x("span",{class:v(["text-ellipsis overflow-hidden text-gray-500 xs:ml-2",{"text-gray-500":!e(t),"text-gray-800 font-medium":e(t)||((o=e(s))==null?void 0:o.is_default)}]),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},[(c=e(s))!=null&&c.is_default?(n(),u(C,{key:0},[M(h((k=e(_))==null?void 0:k.title),1)],64)):(n(),z(P,{key:1,class:"!text-inherit !underline-transparent !hover:text-black !hover:underline-gray-600",to:e(K)({table:e(_),completeUrl:!0})},{default:r(()=>{var T;return[M(h((T=e(_))==null?void 0:T.title),1)]}),_:1},8,["to"]))],2)]}),_:1})],2)):w("",!0)],64)),e(t)?w("",!0):(n(),u("div",Ee,"/")),e(t)&&((j=e(s))!=null&&j.is_default)?w("",!0):(n(),u(C,{key:3},[e(t)?(n(),z(U,{key:0,emoji:(i=(E=e(s))==null?void 0:E.meta)==null?void 0:i.icon,readonly:"",size:"xsmall"},{default:r(()=>{var o;return[d(g,{meta:{type:(o=e(s))==null?void 0:o.type},class:"min-w-4.5 text-lg flex"},null,8,["meta"])]}),_:1},8,["emoji"])):w("",!0),d(V)],64))],2)}}});export{Ft as default};
