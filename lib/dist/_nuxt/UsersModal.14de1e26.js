import{_ as Y}from"./Icon.vue.129448d5.js";import{u as H}from"./bases.e6c8e3c4.js";import{h as J}from"./validation.2de04583.js";import{f as K,M as Z,r as $,cu as c,g as k,o as n,P as d,w as l,a as t,b as a,d as ee,t as i,O as o,c as C,Q as R,R as T,ae as te,T as U,S as se,X as p,Y as oe,gk as ae,a8 as re,ah as le,C as ie}from"./entry.5958c07b.js";import{u as ne}from"./useCopy.0241e728.js";import{u as ce}from"./useDashboard.7eae7d45.js";import{_ as me}from"./send-outline.b8c4f9e3.js";import{F as E}from"./index.b06c8b67.js";import"./index.ae235b22.js";import{I as de}from"./Input.dca3a2bc.js";import{_ as ue}from"./Title.f2b907cf.js";import{_ as pe}from"./index.1862798a.js";import{_ as _e}from"./FormItem.0bbf90a3.js";import{S as ve,_ as fe}from"./index.5c6e4286.js";import"./index.0feaca99.js";import"./useSize.fad35fe8.js";import"./identity.34c7640e.js";import"./isSymbol.114fe557.js";import"./_flatRest.39582a58.js";import"./debounce.7c24f171.js";import"./toNumber.e09cd85a.js";import"./isPlainObject.ccda79fe.js";import"./_getPrototype.c1f3bae2.js";import"./FormItemContext.ddc65fa5.js";import"./SearchOutlined.a517903c.js";import"./TextArea.9074ff05.js";import"./antInputDirective.8ac36ea7.js";import"./Password.f52125e7.js";import"./CheckOutlined.1fe5f230.js";import"./useState.b891c8bb.js";import"./Col.a97e3e76.js";import"./responsiveObserve.0baefba6.js";import"./toArray.fd74ce6f.js";import"./isMobile.e2e89480.js";import"./useMemo.1dd071d8.js";const xe={class:"flex flex-col"},ye={class:"flex flex-row justify-between items-center pb-1.5 mb-2 border-b-1 w-full"},ge={class:"px-2 mt-1.5"},he={key:0,class:"flex flex-col mt-1 pb-5"},we={class:"flex flex-row items-center pl-1.5 pb-1 h-[1.1rem]"},be={class:"text-xs ml-0.5 mt-0.5","data-rec":"true"},$e={class:"flex flex-row justify-between items-center py-1"},ke={class:"flex pl-2 text-green-700 text-xs","data-rec":"true"},Ce={class:"flex text-xs text-gray-500 mt-2 justify-start ml-2","data-rec":"true"},Re={class:"flex flex-row justify-end mt-4 ml-2"},Te={class:"flex flex-row justify-center items-center space-x-0.5"},Ue={class:"text-xs text-gray-600","data-rec":"true"},Ee={key:1,class:"flex flex-col pb-4"},Ie={class:"border-1 py-3 px-4 rounded-md mt-1"},je={class:"flex flex-row space-x-4"},Ve={class:"flex flex-col w-3/4"},Be={class:"ml-1 mb-1 text-xs text-gray-500","data-rec":"true"},Me={class:"flex flex-col w-2/4"},Se={class:"ml-1 mb-1 text-xs text-gray-500"},Fe={class:"flex items-center gap-1 justify-between"},Ne={"data-rec":"true"},Oe={class:"text-gray-500 text-xs whitespace-normal","data-rec":"true"},Le={class:"flex items-center gap-1 justify-between"},Ae={"data-rec":"true"},De={class:"text-gray-500 text-xs whitespace-normal","data-rec":"true"},We={class:"flex flex-row justify-end"},qe={class:"flex flex-row justify-center items-center space-x-1.5"},ze={"data-rec":"true"},Tt=K({__name:"UsersModal",props:{show:{type:Boolean},selectedUser:{}},emits:["closed","reload"],setup(Pe,{emit:I}){const _=I,{t:x}=Z(),{$api:j,$e:v}=ie(),{copy:V}=ne(),{dashboardUrl:B}=ce(),{clearBasesUser:M}=H(),s=$({emails:"",role:c.VIEWER,invitationToken:void 0}),y=$(),S=E.useForm,F=k(()=>({emails:[J]})),{validateInfos:N}=S(s.value,F),O=async()=>{var e;v("a:org-user:invite",{role:s.value.role}),await((e=y.value)==null?void 0:e.validateFields());try{const r=await j.orgUsers.add({roles:s.value.role,email:s.value.emails});s.value.invitationToken=r.invite_token,_("reload"),p.success(x("msg.success.userAdded")),M()}catch(r){console.error(r),p.error(await oe(r))}},f=k(()=>s.value.invitationToken?`${B.value}#/signup/${s.value.invitationToken}`:null),L=async()=>{if(f.value){try{await V(f.value),p.success(x("msg.toast.inviteUrlCopy"))}catch(e){p.error(e.message)}v("c:shared-base:copy-url")}},A=()=>{v("c:user:invite-more"),s.value.invitationToken=void 0,s.value.role=c.VIEWER,s.value.emails=""},D=e=>e==null?void 0:e.focus();return(e,r)=>{const W=ue,q=ae,u=re,z=pe,g=me,P=de,h=_e,w=Y,b=ve,G=fe,Q=E,X=le;return n(),d(X,{class:se({active:e.show}),footer:null,centered:"",visible:e.show,closable:!1,width:"max(50vw, 44rem)","wrap-class-name":"nc-modal-invite-user",onCancel:r[3]||(r[3]=m=>_("closed"))},{default:l(()=>[t("div",xe,[t("div",ye,[a(W,{class:"select-none",level:4,"data-rec":"true"},{default:l(()=>[ee(i(e.$t("activity.inviteUser")),1)]),_:1}),a(u,{type:"text",class:"!rounded-md mr-1 -mt-1.5",onClick:r[0]||(r[0]=m=>_("closed"))},{icon:l(()=>[a(q,{"data-testid":"nc-root-user-invite-modal-close",class:"flex mx-auto"})]),_:1})]),t("div",ge,[o(s).invitationToken?(n(),C("div",he,[t("div",we,[(n(),d(R(o(T).account))),t("div",be,i(e.$t("activity.copyInviteURL")),1)]),a(z,{class:"!mt-2",type:"success","show-icon":""},{message:l(()=>[t("div",$e,[t("div",ke,i(o(f)),1),a(u,{type:"text",class:"!rounded-md -mt-0.5",onClick:L},{icon:l(()=>[(n(),d(R(o(T).copy),{class:"flex mx-auto text-green-700 h-[1rem]"}))]),_:1})])]),_:1}),t("div",Ce,i(e.$t("msg.info.userInviteNoSMTP"))+" "+i(o(s).invitationToken&&o(s).emails),1),t("div",Re,[a(u,{size:"middle",outlined:"",onClick:A},{default:l(()=>[t("div",Te,[a(g,{class:"flex mx-auto text-gray-600 h-[0.8rem]"}),t("div",Ue,i(e.$t("activity.inviteMore")),1)])]),_:1})])])):(n(),C("div",Ee,[t("div",Ie,[a(Q,{ref_key:"formRef",ref:y,"validate-on-rule-change":!1,model:o(s),"validate-trigger":"onBlur",onFinish:O},{default:l(()=>[t("div",je,[t("div",Ve,[a(h,te(o(N).emails,{"validate-trigger":"onBlur",name:"emails",rules:[{required:!0,message:e.$t("msg.plsInputEmail")}]}),{default:l(()=>[t("div",Be,i(e.$t("datatype.Email"))+":",1),a(P,{ref:D,value:o(s).emails,"onUpdate:value":r[1]||(r[1]=m=>o(s).emails=m),size:"middle","validate-trigger":"onBlur",placeholder:e.$t("labels.email")},null,8,["value","placeholder"])]),_:1},16,["rules"])]),t("div",Me,[a(h,{name:"role",rules:[{required:!0,message:e.$t("msg.roleRequired")}]},{default:l(()=>[t("div",Se,i(e.$t("labels.selectUserRole")),1),a(G,{value:o(s).role,"onUpdate:value":r[2]||(r[2]=m=>o(s).role=m),class:"nc-user-roles","dropdown-class-name":"nc-dropdown-user-role !px-2"},{default:l(()=>[a(b,{class:"nc-role-option",value:o(c).CREATOR,label:e.$t("objects.roleType.orgLevelCreator")},{default:l(()=>[t("div",Fe,[t("div",Ne,i(e.$t("objects.roleType.orgLevelCreator")),1),o(s).role===o(c).CREATOR?(n(),d(w,{key:0,id:"nc-selected-item-icon",icon:"check",class:"w-4 h-4 text-primary"})):U("",!0)]),t("span",Oe,i(e.$t("msg.info.roles.orgCreator")),1)]),_:1},8,["value","label"]),a(b,{class:"nc-role-option",value:o(c).VIEWER,label:e.$t("objects.roleType.orgLevelViewer")},{default:l(()=>[t("div",Le,[t("div",Ae,i(e.$t("objects.roleType.orgLevelViewer")),1),o(s).role===o(c).VIEWER?(n(),d(w,{key:0,id:"nc-selected-item-icon",icon:"check",class:"w-4 h-4 text-primary"})):U("",!0)]),t("span",De,i(e.$t("msg.info.roles.orgViewer")),1)]),_:1},8,["value","label"])]),_:1},8,["value"])]),_:1},8,["rules"])])]),t("div",We,[a(u,{type:"primary",class:"!rounded-md","html-type":"submit"},{default:l(()=>[t("div",qe,[a(g,{class:"flex h-[0.8rem]"}),t("div",ze,i(e.$t("activity.invite")),1)])]),_:1})])]),_:1},8,["model"])])]))])])]),_:1},8,["class","visible"])}}});export{Tt as default};
