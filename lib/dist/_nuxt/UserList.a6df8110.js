import{f as Ee,L as Le,M as Me,$ as Ie,r as v,g as De,N as Se,i as je,o as r,c as p,a as n,t as i,b as a,w as l,O as s,W as N,P as m,Q as U,R as C,d as V,_ as J,U as A,V as Te,S as Z,cu as I,T as y,a0 as ee,a1 as te,fk as Ne,X as d,Y as R,fM as Ve,fN as Ae,C as Oe}from"./entry.5958c07b.js";import{_ as Pe,a as ze}from"./Button.vue.c3ca0e8f.js";import{_ as Ge}from"./TruncateText.vue.104d33b8.js";import{_ as Be}from"./Icon.vue.129448d5.js";import{_ as We}from"./Select.vue.8e3ebbe2.js";import{_ as qe,a as Fe}from"./Menu.vue.6c65c050.js";import{_ as Ke}from"./Divider.7b1fba82.js";import{_ as Qe}from"./Dropdown.vue.0d2ed10f.js";import{_ as Xe}from"./DeleteModal.vue.0320a9db.js";import{u as Ye}from"./useCopy.0241e728.js";import{u as He}from"./useDashboard.7eae7d45.js";import{u as Je,_ as Ze}from"./magnifying-glass-bold.6177140d.js";import"./index.ae235b22.js";import{I as et}from"./Input.dca3a2bc.js";import{S as tt}from"./index.5c6e4286.js";import{_ as st}from"./index.023e2de7.js";import{_ as ot}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.55641318.js";import"./debounce.7c24f171.js";import"./toNumber.e09cd85a.js";import"./isSymbol.114fe557.js";import"./index.07078df6.js";import"./index.dc13a4d6.js";import"./Dropdown.041b2468.js";import"./RightOutlined.7161c742.js";import"./Modal.vue.ee5af191.js";import"./index.0feaca99.js";import"./SearchOutlined.a517903c.js";import"./isPlainObject.ccda79fe.js";import"./_getPrototype.c1f3bae2.js";import"./TextArea.9074ff05.js";import"./antInputDirective.8ac36ea7.js";import"./FormItemContext.ddc65fa5.js";import"./Password.f52125e7.js";import"./toArray.fd74ce6f.js";import"./isMobile.e2e89480.js";import"./useMemo.1dd071d8.js";import"./useState.b891c8bb.js";import"./CheckOutlined.1fe5f230.js";import"./LeftOutlined.1d2f193f.js";import"./useBreakpoint.cbf2ba72.js";import"./responsiveObserve.0baefba6.js";const nt=ee(()=>te(()=>import("./UserMenu.31411707.js"),["./UserMenu.31411707.js","./Icon.vue.129448d5.js","./entry.5958c07b.js","./entry.bdecbb78.css","./Menu.vue.6c65c050.js","./_plugin-vue_export-helper.c27b6911.js","./Menu.eff4a609.css","./index.dc13a4d6.js","./Dropdown.041b2468.js","./RightOutlined.7161c742.js","./UserMenu.d8e809d7.css"],import.meta.url).then(f=>f.default||f)),at=ee(()=>te(()=>import("./UsersModal.14de1e26.js"),["./UsersModal.14de1e26.js","./Icon.vue.129448d5.js","./entry.5958c07b.js","./entry.bdecbb78.css","./bases.e6c8e3c4.js","./index.0feaca99.js","./validation.2de04583.js","./useCopy.0241e728.js","./useDashboard.7eae7d45.js","./send-outline.b8c4f9e3.js","./index.b06c8b67.js","./FormItem.0bbf90a3.js","./identity.34c7640e.js","./isSymbol.114fe557.js","./_getPrototype.c1f3bae2.js","./Col.a97e3e76.js","./responsiveObserve.0baefba6.js","./toArray.fd74ce6f.js","./toNumber.e09cd85a.js","./FormItemContext.ddc65fa5.js","./useSize.fad35fe8.js","./_flatRest.39582a58.js","./debounce.7c24f171.js","./isPlainObject.ccda79fe.js","./index.ae235b22.js","./Input.dca3a2bc.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.a517903c.js","./TextArea.9074ff05.js","./Password.f52125e7.js","./Title.f2b907cf.js","./CheckOutlined.1fe5f230.js","./useState.b891c8bb.js","./index.1862798a.js","./index.5c6e4286.js","./isMobile.e2e89480.js","./useMemo.1dd071d8.js"],import.meta.url).then(f=>f.default||f)),rt={"data-testid":"nc-super-user-list",class:"h-full"},it={class:"max-w-195 mx-auto h-full"},lt={class:"text-2xl text-left font-weight-bold mb-4","data-rec":"true"},ct={class:"py-2 flex gap-4 items-center justify-between"},dt={class:"flex gap-3 items-center justify-center"},ut={class:"flex items-center gap-1","data-rec":"true"},pt={class:"w-full rounded-md max-w-250 h-[calc(100%-12rem)] rounded-md overflow-hidden mt-5"},mt={class:"flex w-full bg-gray-50 border-1 rounded-t-md"},_t={class:"py-3.5 text-gray-500 font-medium text-3.5 w-2/3 text-start pl-6 flex items-center space-x-2","data-rec":"true"},vt={class:"py-3.5 text-gray-500 font-medium text-3.5 w-1/3 text-start flex items-center space-x-2","data-rec":"true"},ft={class:"flex py-3.5 text-gray-500 font-medium text-3.5 w-28 justify-end mr-4","data-rec":"true"},yt={key:0,class:"flex items-center justify-center text-center h-[513px]"},gt={key:1,class:"flex items-center justify-center text-center h-full"},ht={key:2,class:"tbody h-[calc(100%-4rem)] nc-scrollbar-md border-t-0 !overflow-auto"},wt={class:"text-3.5 text-start w-2/3 pl-5 flex items-center"},xt={class:"text-3.5 text-start w-1/3"},bt={key:0,class:"font-weight-bold","data-rec":"true"},kt={class:"flex items-center gap-1 justify-between"},$t={"data-rec":"true"},Ut={class:"text-gray-500 text-xs whitespace-normal","data-rec":"true"},Ct={class:"flex items-center gap-1 justify-between"},Rt={"data-rec":"true"},Et={class:"text-gray-500 text-xs whitespace-normal","data-rec":"true"},Lt={class:"w-26 flex items-center justify-end mr-4"},Mt={"data-rec":"true"},It={"data-rec":"true"},Dt={key:0,class:"flex items-center justify-center mt-4"},St={class:"flex flex-row items-center py-2.25 px-2.5 bg-gray-50 rounded-lg text-gray-700 mb-4"},jt={class:"text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Tt=Ee({__name:"UserList",setup(f){const{api:g,isLoading:O}=Le();O.value=!0;const{$e:h}=Oe(),{t:w}=Me(),{dashboardUrl:se}=He(),{user:oe}=Ie(),{copy:P}=Ye(),{sorts:ne,sortDirection:z,loadSorts:ae,saveOrUpdate:G,handleGetSortedData:re}=Je("Org"),x=v([]),ie=De(()=>re(x.value,ne.value)),u=v(1),D=v(10),S=v(!1),B=v(0),b=v(!1),k=v(""),E=Se({total:0,pageSize:10,position:["bottomCenter"]}),_=Ne(async(e=u.value,o=D.value)=>{u.value=e;try{const c=await g.orgUsers.list({query:{limit:o,offset:k.value.length===0?(e-1)*o:0,query:k.value}});if(!c)return;E.total=c.pageInfo.totalRows??0,E.pageSize=10,x.value=c.list}catch(c){d.error(await R(c))}},500);je(()=>{_(),ae()});const le=async(e,o)=>{try{await g.orgUsers.update(e,{roles:o}),d.success(w("msg.success.roleUpdated")),x.value.forEach(c=>{c.id===e&&(c.roles=o)}),h("a:org-user:role-updated",{role:o})}catch(c){d.error(await R(c))}},L=v(null),ce=async()=>{var e;try{await g.orgUsers.delete((e=L.value)==null?void 0:e.id),d.success(w("msg.success.userDeleted")),await _(),!x.value.length&&u.value!==1&&(u.value--,_(u.value)),h("a:org-user:user-deleted")}catch(o){d.error(await R(o))}finally{b.value=!1,L.value=null}},de=async e=>{try{await g.orgUsers.resendInvite(e.id),d.success(w("msg.success.inviteEmailSent")),await _()}catch(o){d.error(await R(o))}h("a:org-user:resend-invite")},ue=async e=>{if(e.invite_token){try{await P(`${se.value}#/signup/${e.invite_token}`),d.success(w("msg.success.inviteURLCopied"))}catch(o){d.error(o.message)}h("c:user:copy-url")}},pe=async e=>{try{const{reset_password_url:o}=await g.orgUsers.generatePasswordResetToken(e.id);await P(o),d.success(w("msg.success.passwordResetURLCopied")),h("c:user:copy-url")}catch(o){d.error(await R(o))}},me=()=>{S.value=!0,B.value++},_e=e=>{L.value=e,b.value=!0};return(e,o)=>{const c=Ze,ve=et,W=Pe,q=nt,fe=ze,ye=J,ge=Ge,j=Be,F=tt,he=We,we=Ve,M=qe,xe=Ke,be=Ae,ke=Fe,$e=Qe,Ue=st,Ce=Xe,Re=at;return r(),p("div",rt,[n("div",it,[n("div",lt,i(e.$t("title.userMgmt")),1),n("div",ct,[a(ve,{value:s(k),"onUpdate:value":o[0]||(o[0]=t=>N(k)?k.value=t:null),class:"!max-w-90 !rounded-md",placeholder:"Search members",onChange:o[1]||(o[1]=t=>s(_)())},{prefix:l(()=>[a(c,{class:"!h-3.5 text-gray-500"})]),_:1},8,["value"]),n("div",dt,[(r(),m(U(s(C).reload),{class:"cursor-pointer",onClick:o[2]||(o[2]=t=>s(_)(s(u),s(D)))})),a(W,{"data-testid":"nc-super-user-invite",size:"small",type:"primary",onClick:me},{default:l(()=>[n("div",ut,[(r(),m(U(s(C).plus))),V(" "+i(e.$t("activity.inviteUser")),1)])]),_:1})])]),n("div",pt,[n("div",mt,[n("div",_t,[n("span",null,i(e.$t("labels.email")),1),a(q,{direction:s(z).email,field:"email","handle-user-sort":s(G)},null,8,["direction","handle-user-sort"])]),n("div",vt,[n("span",null,i(e.$t("objects.role")),1),a(q,{direction:s(z).roles,field:"roles","handle-user-sort":s(G)},null,8,["direction","handle-user-sort"])]),n("div",ft,i(e.$t("labels.action")),1)]),s(O)?(r(),p("div",yt,[a(fe,{size:"xlarge"})])):s(x).length?(r(),p("section",ht,[(r(!0),p(A,null,Te(s(ie),t=>{var K,Q,X;return r(),p("div",{key:t.id,"data-testid":"nc-token-list",class:Z(["user flex py-3 justify-around px-1 border-b-1 border-l-1 border-r-1",{"py-4":(K=t.roles)==null?void 0:K.includes("super")}])},[n("div",wt,[a(ge,{length:"29"},{default:l(()=>[V(i(t.email),1)]),_:2},1024)]),n("div",xt,[(Q=t==null?void 0:t.roles)!=null&&Q.includes("super")?(r(),p("div",bt,i(e.$t("labels.superAdmin")),1)):(r(),m(he,{key:1,value:t.roles,"onUpdate:value":$=>t.roles=$,class:"w-55 nc-user-roles","dropdown-match-select-width":!1,"dropdown-class-name":"max-w-64",onChange:$=>le(t.id,t.roles)},{default:l(()=>[a(F,{class:"nc-users-list-role-option",value:s(I).CREATOR,label:e.$t("objects.roleType.orgLevelCreator")},{default:l(()=>[n("div",kt,[n("div",$t,i(e.$t("objects.roleType.orgLevelCreator")),1),(t==null?void 0:t.roles)===s(I).CREATOR?(r(),m(j,{key:0,id:"nc-selected-item-icon",icon:"check",class:"w-4 h-4 text-primary"})):y("",!0)]),n("span",Ut,i(e.$t("msg.info.roles.orgCreator")),1)]),_:2},1032,["value","label"]),a(F,{class:"nc-users-list-role-option",value:s(I).VIEWER,label:e.$t("objects.roleType.orgLevelViewer")},{default:l(()=>[n("div",Ct,[n("div",Rt,i(e.$t("objects.roleType.orgLevelViewer")),1),t.roles===s(I).VIEWER?(r(),m(j,{key:0,id:"nc-selected-item-icon",icon:"check",class:"w-4 h-4 text-primary"})):y("",!0)]),n("span",Et,i(e.$t("msg.info.roles.orgViewer")),1)]),_:2},1032,["value","label"])]),_:2},1032,["value","onUpdate:value","onChange"]))]),n("span",Lt,[n("div",{class:Z(["flex items-center gap-2",{"opacity-0 pointer-events-none":(X=t.roles)==null?void 0:X.includes("super")}])},[a($e,{trigger:["click"]},{overlay:l(()=>[a(ke,null,{default:l(()=>{var $,Y,H;return[($=t.roles)!=null&&$.includes("super")?y("",!0):(r(),p(A,{key:0},[a(M,{onClick:T=>de(t)},{default:l(()=>[(r(),m(U(s(C).email),{class:"flex text-gray-600"})),n("div",Mt,i(e.$t("activity.resendInvite")),1)]),_:2},1032,["onClick"]),a(M,{onClick:T=>ue(t)},{default:l(()=>[(r(),m(U(s(C).copy),{class:"flex text-gray-600"})),n("div",It,i(e.$t("activity.copyInviteURL")),1)]),_:2},1032,["onClick"]),a(M,{onClick:T=>pe(t)},{default:l(()=>[(r(),m(U(s(C).copy),{class:"flex text-gray-600"})),n("div",null,i(e.$t("activity.copyPasswordResetURL")),1)]),_:2},1032,["onClick"])],64)),t.id!==((Y=s(oe))==null?void 0:Y.id)?(r(),p(A,{key:1},[(H=t.roles)!=null&&H.includes("super")?y("",!0):(r(),m(xe,{key:0})),a(M,{"data-rec":"true",class:"!text-red-500 !hover:bg-red-50",onClick:T=>_e(t)},{default:l(()=>[a(be),V(" "+i(e.$t("general.remove"))+" "+i(e.$t("objects.user")),1)]),_:2},1032,["onClick"])],64)):y("",!0)]}),_:2},1024)]),default:l(()=>[a(W,{size:"xsmall",type:"ghost"},{default:l(()=>[a(we,{class:"text-gray-600 h-5.5 w-5.5 rounded outline-0 p-0.5 nc-workspace-menu transform transition-transform !text-gray-400 cursor-pointer !hover:text-gray-500 hover:bg-gray-100"})]),_:1})]),_:2},1024)],2)])],2)}),128))])):(r(),p("div",gt,[a(ye,{image:("Empty"in e?e.Empty:s(J)).PRESENTED_IMAGE_SIMPLE,description:e.$t("labels.noData")},null,8,["image","description"])]))]),s(E).total>10?(r(),p("div",Dt,[a(Ue,{current:s(u),"onUpdate:current":o[3]||(o[3]=t=>N(u)?u.value=t:null),total:s(E).total,"show-less-items":"",onChange:o[4]||(o[4]=t=>s(_)(s(u),s(D)))},null,8,["current","total"])])):y("",!0),a(Ce,{visible:s(b),"onUpdate:visible":o[5]||(o[5]=t=>N(b)?b.value=t:null),"entity-name":"User","on-delete":()=>ce()},{"entity-preview":l(()=>{var t;return[n("span",null,[n("div",St,[a(j,{icon:"account",class:"nc-view-icon"}),n("div",jt,i((t=s(L))==null?void 0:t.email),1)])])]}),_:1},8,["visible","on-delete"]),(r(),m(Re,{key:s(B),show:s(S),onClosed:o[6]||(o[6]=t=>S.value=!1),onReload:s(_)},null,8,["show","onReload"]))])])}}});const $s=ot(Tt,[["__scopeId","data-v-5737beac"]]);export{$s as default};
