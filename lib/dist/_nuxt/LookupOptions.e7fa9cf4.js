import F from"./VirtualCellIcon.79739fcf.js";import{_ as A}from"./CellIcon.0a028b40.js";import{_ as E}from"./Tooltip.vue.00c0d0fb.js";import{M as P}from"./index.9b87fcff.js";import{f as Z,a5 as G,bb as Q,r as W,M as Y,bF as z,g as M,eZ as H,cZ as J,cG as K,i as X,o as l,c as u,O as i,b as m,w as s,U as O,V as T,P as c,a as r,d as V,t as _,Q as v,R as L,T as S,ae as I,n as ee,eW as oe}from"./entry.96205fa0.js";import{a as te,b as ne}from"./bases.965a49bb.js";import{b as ie}from"./EditOrAddProvider.vue.8b187915.js";import{S as le,_ as ae}from"./index.b5e393d6.js";import{_ as se}from"./FormItem.9f1f85f2.js";import{_ as re}from"./_plugin-vue_export-helper.c27b6911.js";import"./virtualCell.9142cfee.js";import"./cell.810c4fd3.js";import"./index.0c5b3837.js";import"./Icon.vue.6d0583a0.js";import"./Button.vue.02ce6d5b.js";import"./index.9e8f59f4.js";import"./debounce.1d5af9bf.js";import"./toNumber.ed208f2f.js";import"./isSymbol.d46b4957.js";import"./views.2c163cf7.js";import"./useSharedView.9e320acb.js";import"./validation.64563eeb.js";import"./index.886d43e1.js";import"./useSize.c98e621d.js";import"./identity.309e9ead.js";import"./_flatRest.ce557a88.js";import"./isPlainObject.631eb8fb.js";import"./_getPrototype.459a70cf.js";import"./FormItemContext.b19eb48c.js";import"./vuedraggable.umd.5a03c14e.js";import"./v3-infinite-loading.e5e5dc2d.js";import"./index.6c1d17b6.js";import"./Dropdown.1dedd322.js";import"./RightOutlined.3ce786f5.js";import"./index.1431a68b.js";import"./Input.3f1aaf0c.js";import"./antInputDirective.8ac36ea7.js";import"./SearchOutlined.c9794270.js";import"./TextArea.b81a19ed.js";import"./Password.803cc3dc.js";import"./index.0b4c0f1e.js";import"./Checkbox.cf2cdba0.js";import"./createForOfIteratorHelper.f2005dfe.js";import"./toArray.3561b70e.js";import"./isMobile.e2e89480.js";import"./useMemo.dbc63a5f.js";import"./useState.5a301439.js";import"./CheckOutlined.3b90c20d.js";import"./Col.b3c5d725.js";import"./responsiveObserve.358bcfe9.js";const _e={class:"p-6 w-full flex flex-col border-2 mb-2 mt-4"},ue={key:0,class:"w-full flex flex-row space-x-2"},me={class:"flex gap-2 w-full justify-between truncate items-center"},ce={class:"inline-flex items-center truncate gap-2"},pe={class:"text-[0.65rem] flex-1 truncate text-gray-600 nc-relation-details"},de={class:"uppercase"},fe={class:"truncate"},ke={class:"flex gap-2 truncate items-center"},ve={class:"inline-flex items-center flex-1 truncate font-semibold"},he={class:"truncate flex-1"},ge={key:1},ye=Z({__name:"LookupOptions",props:{value:{}},emits:["update:value"],setup(N,{emit:B}){const t=G(N,"value",B),p=Q(P,W()),{t:h}=Y(),{setAdditionalValidations:q,validateInfos:g,onDataTypeChange:y,isEdit:R}=ie(),U=te(),{tables:d}=z(U),{metas:$}=ne();q({fk_relation_column_id:[{required:!0,message:h("general.required")}],fk_lookup_column_id:[{required:!0,message:h("general.required")}]}),t.value.fk_relation_column_id||(t.value.fk_relation_column_id=null),t.value.fk_lookup_column_id||(t.value.fk_lookup_column_id=null);const f=M(()=>!d.value||!d.value.length||!p.value||!p.value.columns?[]:p.value.columns.filter(e=>{var a;return H(e)&&!e.system&&e.source_id===((a=p.value)==null?void 0:a.source_id)}).map(e=>({col:e.colOptions,column:e,...d.value.find(a=>a.id===e.colOptions.fk_related_model_id)})).filter(e=>{var a;return((a=e.col)==null?void 0:a.fk_related_model_id)===e.id&&!e.mm})),w=M(()=>{const o=f.value.find(e=>e.column.id===t.value.fk_relation_column_id);return o!=null&&o.id?$.value[o.id].columns.filter(e=>t.value.fk_lookup_column_id===e.id||!J(e)&&e.id!==t.value.id&&e.uidt!==K.Links):[]});X(()=>{var o,e;R.value&&(t.value.fk_lookup_column_id=(o=t.value.colOptions)==null?void 0:o.fk_lookup_column_id,t.value.fk_relation_column_id=(e=t.value.colOptions)==null?void 0:e.fk_relation_column_id)});const j=()=>{var o,e;t.value.fk_lookup_column_id=(e=(o=w.value)==null?void 0:o[0])==null?void 0:e.id,y()},D=o=>ee(oe(o)?F:A,{columnMeta:o});return(o,e)=>{const a=E,x=le,b=ae,C=se;return l(),u("div",_e,[i(f).length?(l(),u("div",ue,[m(C,I({class:"flex w-1/2 pb-2",label:o.$t("labels.links")},i(g).fk_relation_column_id),{default:s(()=>[m(b,{value:i(t).fk_relation_column_id,"onUpdate:value":e[0]||(e[0]=n=>i(t).fk_relation_column_id=n),"dropdown-class-name":"!w-64 !rounded-md nc-dropdown-relation-table",onChange:j},{default:s(()=>[(l(!0),u(O,null,T(i(f),(n,k)=>(l(),c(x,{key:k,value:n.col.fk_column_id},{default:s(()=>[r("div",me,[m(a,{class:"font-semibold truncate min-w-1/2","show-on-truncate-only":""},{title:s(()=>[V(_(n.column.title),1)]),default:s(()=>[V(" "+_(n.column.title),1)]),_:2},1024),r("div",ce,[r("div",pe,[r("span",de,_(n.col.type),1),r("span",fe,_(n.title||n.table_name),1)]),i(t).fk_relation_column_id===n.col.fk_column_id?(l(),c(v(("iconMap"in o?o.iconMap:i(L)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):S("",!0)])])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},16,["label"]),m(C,I({class:"flex w-1/2",label:o.$t("labels.childField")},i(g).fk_lookup_column_id),{default:s(()=>[m(b,{value:i(t).fk_lookup_column_id,"onUpdate:value":e[1]||(e[1]=n=>i(t).fk_lookup_column_id=n),name:"fk_lookup_column_id","dropdown-class-name":"nc-dropdown-relation-column !rounded-md",onChange:i(y)},{default:s(()=>[(l(!0),u(O,null,T(i(w),(n,k)=>(l(),c(x,{key:k,value:n.id},{default:s(()=>[r("div",ke,[r("div",ve,[(l(),c(v(D(n)),{"column-meta":n},null,8,["column-meta"])),r("div",he,_(n.title),1)]),i(t).fk_lookup_column_id===n.id?(l(),c(v(("iconMap"in o?o.iconMap:i(L)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):S("",!0)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange"])]),_:1},16,["label"])])):(l(),u("div",ge,_(o.$t("msg.linkColumnClearNotSupportedYet")),1))])}}});const yo=re(ye,[["__scopeId","data-v-b7060d72"]]);export{yo as default};
