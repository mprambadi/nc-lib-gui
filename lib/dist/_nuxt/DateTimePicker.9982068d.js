import{f as W,$ as _,bb as m,r as s,M as ee,g as w,gn as te,go as ae,cp as a,H as le,cg as re,i as ce,bR as ie,cZ as ne,o as oe,P as se,w as ue,O as c,S as de,bv as me,eR as A}from"./entry.5958c07b.js";import{i as fe,m as ve,E as pe,r as ke,l as be,C as ye,t as Ve}from"./index.9b87fcff.js";import{a as we,p as U}from"./bases.e6c8e3c4.js";import{u as he}from"./index.c35df397.js";import{D as Se}from"./dayjs.d5bc2934.js";import{_ as xe}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.0feaca99.js";import"./index.07afd4b8.js";import"./createForOfIteratorHelper.33de41ba.js";import"./index.27219acd.js";import"./useState.b891c8bb.js";import"./useMemo.1dd071d8.js";import"./FormItemContext.ddc65fa5.js";const Ce=W({__name:"DateTimePicker",props:{modelValue:{},isPk:{type:Boolean},isUpdatedFromCopyNPaste:{}},emits:["update:modelValue"],setup(t,{emit:L}){const h=L,{isMssql:T,isXcdbBase:K}=we(),{showNull:E}=_(),v=m(fe,s(!1)),S=m(ve,s(!1)),x=m(pe,s(!1)),{t:C}=ee(),N=m(ke,s(!1)),g=m(be,s(!1)),r=m(ye),q=s(!1),Z=w(()=>{var o,f,k,b;const e=((f=U((o=r==null?void 0:r.value)==null?void 0:o.meta))==null?void 0:f.date_format)??te[0],i=((b=U((k=r==null?void 0:r.value)==null?void 0:k.meta))==null?void 0:b.time_format)??ae[0];return`${e} ${i}`});let u=t.modelValue?a(t.modelValue).utc().local():void 0;const p=s(),n=w({get(){var i;if(!t.modelValue&&p.value)return p.value;if(!t.modelValue)return;if(!a(t.modelValue).isValid()){q.value=!0;return}const e=K(r.value.source_id);if(r.value.title in(t.isUpdatedFromCopyNPaste??{}))return u=a(t.modelValue).utc().local(),u;if(!e)return/^\d+$/.test(t.modelValue)?a(+t.modelValue):a(t.modelValue);if(T(r.value.source_id))return a(t.modelValue);if((i=r==null?void 0:r.value)!=null&&i.cdf)return a(t.modelValue).utc().local();if(u){const o=u;return u=void 0,o}return a(t.modelValue).utc().local()},set(e){if(!e){h("update:modelValue",null);return}e.isValid()&&(u=a(e),h("update:modelValue",a(e).utc().format("YYYY-MM-DD HH:mm:ssZ")))}}),l=s(!1),X=w(()=>v.value||v.value||n.value&&t.isPk?!1:l.value&&(S.value||x.value)),P=`picker_${Math.floor(Math.random()*99999)}`;le(l,e=>{e?(re(document.querySelector(`.${P}`),()=>l.value=!1),t.modelValue?p.value=void 0:p.value=a(new Date).utc().local()):(x.value=!1,p.value=void 0)},{flush:"post"});const z=w(()=>N.value&&(t.modelValue===""||t.modelValue===null)?C("labels.optional"):t.modelValue===null&&E.value?C("general.null").toUpperCase():q.value?C("msg.invalidDate"):"");he(S,e=>{var i,o,f,k,b,I,M,F,j,$,O,Y,B,H,R;switch(e.key){case"Enter":if(e.stopPropagation(),A())return;l.value?(i=document.querySelector(".nc-picker-datetime.active .ant-picker-ok button"))==null||i.click():l.value=!0;break;case"Escape":if(A())return;l.value&&(e.stopPropagation(),l.value=!1);break;case"ArrowLeft":if(!n.value)(o=document.querySelector(".nc-picker-datetime.active .ant-picker-header-prev-btn"))==null||o.click();else{const y=(f=document.querySelector(".nc-picker-datetime.active .ant-picker-cell-selected"))==null?void 0:f.previousElementSibling;if(y)y.click();else{const V=(I=(b=(k=document.querySelector(".nc-picker-datetime.active .ant-picker-cell-selected"))==null?void 0:k.closest("tr"))==null?void 0:b.previousElementSibling)==null?void 0:I.querySelector("td:last-child");V?V.click():(M=document.querySelector(".nc-picker-datetime.active .ant-picker-header-prev-btn"))==null||M.click()}}break;case"ArrowRight":if(!n.value)(F=document.querySelector(".nc-picker-datetime.active .ant-picker-header-next-btn"))==null||F.click();else{const y=(j=document.querySelector(".nc-picker-datetime.active .ant-picker-cell-selected"))==null?void 0:j.nextElementSibling;if(y)y.click();else{const V=(Y=(O=($=document.querySelector(".nc-picker-datetime.active .ant-picker-cell-selected"))==null?void 0:$.closest("tr"))==null?void 0:O.nextElementSibling)==null?void 0:Y.querySelector("td:first-child");V?V.click():(B=document.querySelector(".nc-picker-datetime.active .ant-picker-header-next-btn"))==null||B.click()}}break;case"ArrowUp":n.value||(H=document.querySelector(".nc-picker-datetime.active .ant-picker-header-super-prev-btn"))==null||H.click();break;case"ArrowDown":n.value||(R=document.querySelector(".nc-picker-datetime.active .ant-picker-header-super-next-btn"))==null||R.click();break;case";":n.value=a(new Date);break}});const d=m(Ve,null),D=()=>{v.value||(l.value=(S.value||x.value)&&!l.value)};function G(e){if(!e){h("update:modelValue",null);return}a(e).isValid()&&(u=a(e),h("update:modelValue",a(e).utc().format("YYYY-MM-DD HH:mm:ssZ"))),l.value=!l.value}ce(()=>{d==null||d.on(D)}),ie(()=>{d==null||d.on(D)});const J=()=>{d||D()},Q=w(()=>ne(r.value)||v.value||n.value&&t.isPk);return(e,i)=>{const o=Se;return oe(),se(o,{value:c(n),disabled:c(Q),"show-time":!0,bordered:!1,class:de(["!w-full !py-1 !border-none !text-current",{"nc-null":e.modelValue===null&&c(E),"!px-2":c(g),"!px-0":!c(g)}]),format:c(Z),placeholder:c(z),"allow-clear":!c(v)&&!c(n)&&!e.isPk,"input-read-only":!0,"dropdown-class-name":`${P} nc-picker-datetime children:border-1 children:border-gray-200 ${c(l)?"active":""}`,open:c(X),onClick:J,onOk:G,onKeydown:i[0]||(i[0]=me(f=>l.value=!c(l),["enter"]))},{suffixIcon:ue(()=>[]),_:1},8,["value","disabled","class","format","placeholder","allow-clear","dropdown-class-name","open"])}}});const He=xe(Ce,[["__scopeId","data-v-cad0ff71"]]);export{He as default};
