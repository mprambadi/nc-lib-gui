import{f as J,M as Z,bF as ee,$ as se,r as g,cA as _,g as k,i as te,H as oe,a7 as ae,o as n,P as v,w as i,a as s,O as o,c as u,t as r,T as B,Q as w,R as U,b as l,ae as le,U as ie,V as re,aK as ne,cq as ce,d as $,a0 as de,a1 as me,X as y,Y as ue,a8 as pe,C as ve}from"./entry.5958c07b.js";import{_ as fe}from"./Modal.vue.ee5af191.js";import{h as _e}from"./validation.2de04583.js";import{u as ye}from"./index.c35df397.js";import{a as xe}from"./bases.e6c8e3c4.js";import{u as he}from"./useCopy.0241e728.js";import{u as be}from"./useDashboard.7eae7d45.js";import{_ as ge}from"./send-outline.b8c4f9e3.js";import{F as j}from"./index.b06c8b67.js";import"./index.ae235b22.js";import{I as ke}from"./Input.dca3a2bc.js";import{_ as we}from"./index.1862798a.js";import{_ as Ue}from"./FormItem.0bbf90a3.js";import{S as $e,_ as Ce}from"./index.5c6e4286.js";import"./index.0feaca99.js";import"./useSize.fad35fe8.js";import"./identity.34c7640e.js";import"./isSymbol.114fe557.js";import"./_flatRest.39582a58.js";import"./debounce.7c24f171.js";import"./toNumber.e09cd85a.js";import"./isPlainObject.ccda79fe.js";import"./_getPrototype.c1f3bae2.js";import"./FormItemContext.ddc65fa5.js";import"./SearchOutlined.a517903c.js";import"./TextArea.9074ff05.js";import"./antInputDirective.8ac36ea7.js";import"./Password.f52125e7.js";import"./Col.a97e3e76.js";import"./responsiveObserve.0baefba6.js";import"./toArray.fd74ce6f.js";import"./isMobile.e2e89480.js";import"./useMemo.1dd071d8.js";import"./useState.b891c8bb.js";import"./CheckOutlined.1fe5f230.js";const Te=de(()=>me(()=>import("./ShareBase.b0edfa69.js"),["./ShareBase.b0edfa69.js","./entry.5958c07b.js","./entry.bdecbb78.css","./bases.e6c8e3c4.js","./index.0feaca99.js","./useCopy.0241e728.js","./useDashboard.7eae7d45.js","./index.dc13a4d6.js","./Dropdown.041b2468.js","./RightOutlined.7161c742.js","./index.5c6e4286.js","./toArray.fd74ce6f.js","./antInputDirective.8ac36ea7.js","./isMobile.e2e89480.js","./useMemo.1dd071d8.js","./useState.b891c8bb.js","./CheckOutlined.1fe5f230.js","./SearchOutlined.a517903c.js","./FormItemContext.ddc65fa5.js"],import.meta.url).then(c=>c.default||c)),Me={class:"flex flex-col p-6","data-testid":"invite-user-and-share-base-modal"},Re={class:"flex flex-row justify-between items-center pb-1.5 mb-2 border-b-1 border-gray-100 w-full"},Ee={key:0,class:"select-none font-medium"},Ie={class:"px-2 mt-1.5"},Be={key:0,class:"flex flex-col mt-1 border-b-1 pb-5"},je={class:"flex flex-row items-center pl-1.5 pb-1 h-[1.1rem]"},Fe=s("div",{class:"text-xs ml-0.5 mt-0.5"},"Copy Invite Token",-1),Se={class:"flex flex-row justify-between items-center py-1"},Ve={class:"flex pl-2 text-green-700 text-xs","data-testid":"invite-modal-invitation-url"},Ne={class:"flex text-xs text-gray-500 mt-2 justify-start ml-2"},ze={class:"flex flex-row justify-start mt-4 ml-2"},Ae={class:"flex flex-row justify-center items-center space-x-0.5"},De={class:"text-xs text-gray-600"},Pe={key:1,class:"flex flex-col pb-4"},Le={key:0,class:"flex flex-row items-center pl-2 pb-1 h-[1rem]"},qe={class:"text-xs ml-0.5 mt-0.5"},Oe={class:"border-1 py-3 px-4 rounded-md mt-1"},We={class:"flex flex-row space-x-4"},Ge={class:"flex flex-col w-3/4"},Ke={class:"ml-1 mb-1 text-xs text-gray-500"},He={class:"flex flex-col w-1/4"},Qe={class:"ml-1 mb-1 text-xs text-gray-500"},Xe={class:"flex flex-row h-full justify-start items-center"},Ye={class:"flex flex-row justify-end"},Je={key:0},Ze={key:1,class:"flex flex-row justify-center items-center space-x-1.5"},es={class:"flex"},ss={class:"flex flex-row justify-end gap-x-2 border-t-1 border-gray-100 pt-3"},Ns=J({__name:"UsersModal",props:{show:{type:Boolean},selectedUser:{}},emits:["closed","reload"],setup(c,{emit:F}){const C=F,{t:f}=Z(),{base:p}=ee(xe()),{isMobileMode:S}=se(),{$api:T,$e:x}=ve(),{copy:V}=he(),{dashboardUrl:N}=be(),t=g({emails:void 0,role:_.VIEWER,invitationToken:void 0}),M=g(),z=j.useForm,A=k(()=>({emails:[_e]})),{validateInfos:D}=z(t.value,A);te(()=>{var e;!t.value.emails&&((e=c.selectedUser)!=null&&e.email)&&(t.value.emails=c.selectedUser.email,t.value.role=c.selectedUser.roles)});const h=()=>{C("closed"),t.value={role:_.VIEWER}},P=async()=>{var e,d;if(x("a:user:invite",{role:t.value.role}),!!p.value.id){await((e=M.value)==null?void 0:e.validateFields());try{if((d=c.selectedUser)!=null&&d.id)await T.auth.baseUserUpdate(p.value.id,c.selectedUser.id,{roles:t.value.role,email:c.selectedUser.email,base_id:p.value.id,baseName:p.value.title}),h();else{const a=await T.auth.baseUserAdd(p.value.id,{roles:t.value.role,email:t.value.emails});t.value.invitationToken=a==null?void 0:a.invite_token}C("reload"),y.success(f("msg.success.userDetailsUpdated"))}catch(a){console.error(a),y.error(await ue(a))}}},b=k(()=>t.value.invitationToken?`${N.value}#/signup/${t.value.invitationToken}`:null),L=async()=>{if(b.value){try{await V(b.value),y.success(f("msg.success.shareableURLCopied"))}catch(e){y.error(e.message)}x("c:shared-base:copy-url")}},q=()=>{x("c:user:invite-more"),t.value.invitationToken=void 0,t.value.role=_.VIEWER,t.value.emails=void 0},R=g();return ye(k(()=>c.show),e=>{e.key==="Escape"&&h()},{immediate:!0}),oe(()=>c.show,async e=>{var d,a;e&&(await ae(),(a=(d=R.value)==null?void 0:d.$el)==null||a.focus())},{immediate:!0}),(e,d)=>{const a=pe,O=we,E=ge,W=ke,I=Ue,G=$e,K=Ce,H=j,Q=Te,X=fe;return n(),v(X,{centered:"",visible:e.show,onCancel:h},{default:i(()=>[s("div",Me,[s("div",Re,[o(S)?B("",!0):(n(),u("div",Ee,r(e.$t("activity.share")),1))]),s("div",Ie,[o(t).invitationToken?(n(),u("div",Be,[s("div",je,[(n(),v(w(o(U).account))),Fe]),l(O,{class:"mt-1",type:"success","show-icon":""},{message:i(()=>[s("div",Se,[s("div",Ve,r(o(b)),1),l(a,{type:"text",class:"!rounded-md -mt-0.5",onClick:L},{icon:i(()=>[(n(),v(w(o(U).copy),{class:"flex mx-auto text-green-700 h-[1rem]"}))]),_:1})])]),_:1}),s("div",Ne,r(e.$t("msg.info.userInviteNoSMTP"))+" "+r(o(t).invitationToken&&o(t).emails),1),s("div",ze,[l(a,{size:"small",outlined:"",onClick:q},{default:i(()=>[s("div",Ae,[l(E,{class:"flex mx-auto text-gray-600 h-[0.8rem]"}),s("div",De,r(e.$t("activity.inviteMore")),1)])]),_:1})])])):(n(),u("div",Pe,[e.selectedUser?(n(),u("div",Le,[(n(),v(w(o(U).account))),s("div",qe,r(e.selectedUser?e.$t("activity.editUser"):e.$t("activity.inviteTeam")),1)])):B("",!0),l(H,{ref_key:"formRef",ref:M,"validate-on-rule-change":!1,model:o(t),"validate-trigger":"onBlur",onFinish:P},{default:i(()=>[s("div",Oe,[s("div",We,[s("div",Ge,[l(I,le(o(D).emails,{"validate-trigger":"onBlur",name:"emails",rules:[{required:!0,message:o(f)("msg.plsInputEmail")}]}),{default:i(()=>[s("div",Ke,r(e.$t("datatype.Email"))+":",1),l(W,{ref_key:"emailField",ref:R,value:o(t).emails,"onUpdate:value":d[0]||(d[0]=m=>o(t).emails=m),size:"middle","validate-trigger":"onBlur",placeholder:e.$t("labels.email"),disabled:!!e.selectedUser},null,8,["value","placeholder","disabled"])]),_:1},16,["rules"])]),s("div",He,[l(I,{name:"role",rules:[{required:!0,message:o(f)("msg.roleRequired")}]},{default:i(()=>[s("div",Qe,r(e.$t("labels.selectUserRole")),1),l(K,{value:o(t).role,"onUpdate:value":d[1]||(d[1]=m=>o(t).role=m),size:"middle",class:"nc-user-roles !rounded-md","dropdown-class-name":"nc-dropdown-user-role"},{default:i(()=>[(n(!0),u(ie,null,re(o(_),(m,Y)=>(n(),v(G,{key:Y,value:m,class:"nc-role-option"},{default:i(()=>[s("div",Xe,[s("div",{class:"px-3 py-1 flex rounded-full text-xs",style:ne({backgroundColor:o(ce)[m]})},r(m),5)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["rules"])])]),s("div",Ye,[l(a,{type:"primary","html-type":"submit",class:"!rounded-md"},{default:i(()=>[e.selectedUser?(n(),u("div",Je,r(e.$t("general.save")),1)):(n(),u("div",Ze,[l(E,{class:"flex h-[0.8rem]"}),s("div",null,r(e.$t("activity.invite")),1)]))]),_:1})])])]),_:1},8,["model"])])),s("div",es,[l(Q)])]),s("div",ss,[l(a,{key:"back",class:"!rounded-md",onClick:e.cancel},{default:i(()=>[$(r(e.$t("general.cancel")),1)]),_:1},8,["onClick"]),l(a,{class:"!rounded-md"},{default:i(()=>[$("Manage base access")]),_:1}),l(a,{key:"submit",class:"!rounded-md",type:"primary",loading:e.loading},{default:i(()=>[$(r(e.$t("activity.share")),1)]),_:1},8,["loading"])])])]),_:1},8,["visible"])}}});export{Ns as default};
