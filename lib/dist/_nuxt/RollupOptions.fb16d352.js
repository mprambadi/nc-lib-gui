import Z from"./VirtualCellIcon.79739fcf.js";import{_ as H}from"./CellIcon.0a028b40.js";import{_ as Q}from"./Tooltip.vue.00c0d0fb.js";import{M as W}from"./index.9b87fcff.js";import{f as X,a5 as z,bb as G,r as S,bF as J,M as K,g as B,eZ as Y,eW as F,cZ as ee,i as te,H as oe,gX as le,o as s,c as g,a as r,b as c,w as u,O as n,U as M,V as O,P as _,d as T,t as p,Q as k,R as D,T as R,ae as V,n as ne}from"./entry.96205fa0.js";import{a as ae,b as ie}from"./bases.965a49bb.js";import{b as se}from"./EditOrAddProvider.vue.8b187915.js";import{S as ue,_ as re}from"./index.b5e393d6.js";import{_ as ce}from"./FormItem.9f1f85f2.js";import{_ as _e}from"./_plugin-vue_export-helper.c27b6911.js";import"./virtualCell.9142cfee.js";import"./cell.810c4fd3.js";import"./index.0c5b3837.js";import"./Icon.vue.6d0583a0.js";import"./Button.vue.02ce6d5b.js";import"./index.9e8f59f4.js";import"./debounce.1d5af9bf.js";import"./toNumber.ed208f2f.js";import"./isSymbol.d46b4957.js";import"./views.2c163cf7.js";import"./useSharedView.9e320acb.js";import"./validation.64563eeb.js";import"./index.886d43e1.js";import"./useSize.c98e621d.js";import"./identity.309e9ead.js";import"./_flatRest.ce557a88.js";import"./isPlainObject.631eb8fb.js";import"./_getPrototype.459a70cf.js";import"./FormItemContext.b19eb48c.js";import"./vuedraggable.umd.5a03c14e.js";import"./v3-infinite-loading.e5e5dc2d.js";import"./index.6c1d17b6.js";import"./Dropdown.1dedd322.js";import"./RightOutlined.3ce786f5.js";import"./index.1431a68b.js";import"./Input.3f1aaf0c.js";import"./antInputDirective.8ac36ea7.js";import"./SearchOutlined.c9794270.js";import"./TextArea.b81a19ed.js";import"./Password.803cc3dc.js";import"./index.0b4c0f1e.js";import"./Checkbox.cf2cdba0.js";import"./createForOfIteratorHelper.f2005dfe.js";import"./toArray.3561b70e.js";import"./isMobile.e2e89480.js";import"./useMemo.dbc63a5f.js";import"./useState.5a301439.js";import"./CheckOutlined.3b90c20d.js";import"./Col.b3c5d725.js";import"./responsiveObserve.358bcfe9.js";const me={class:"p-6 w-full flex flex-col border-2 mb-2 mt-4"},pe={class:"w-full flex flex-row space-x-2"},de={class:"flex gap-2 w-full justify-between truncate items-center"},fe={class:"inline-flex items-center truncate gap-2"},ve={class:"text-[0.65rem] flex-1 truncate text-gray-600 nc-relation-details"},ge={class:"uppercase"},ke={class:"truncate"},xe={class:"flex gap-2 truncate items-center"},be={class:"flex items-center flex-1 truncate font-semibold"},he={class:"truncate flex-1"},we={class:"flex gap-2 justify-between items-center"},ye=X({__name:"RollupOptions",props:{value:{}},emits:["update:value"],setup(I,{emit:N}){const o=z(I,"value",N),f=G(W,S()),{setAdditionalValidations:U,validateInfos:x,onDataTypeChange:b,isEdit:j}=se(),L=ae(),{tables:h}=J(L),{metas:$}=ie(),{t:i}=K();U({fk_relation_column_id:[{required:!0,message:i("general.required")}],fk_rollup_column_id:[{required:!0,message:i("general.required")}],rollup_function:[{required:!0,message:i("general.required")}]}),o.value.fk_relation_column_id||(o.value.fk_relation_column_id=null),o.value.fk_rollup_column_id||(o.value.fk_rollup_column_id=null),o.value.rollup_function||(o.value.rollup_function=null);const q=B(()=>!h.value||!h.value.length||!f.value||!f.value.columns?[]:f.value.columns.filter(e=>{var a;return Y(e)&&e.colOptions.type!=="bt"&&!e.system&&e.source_id===((a=f.value)==null?void 0:a.source_id)}).map(e=>({col:e.colOptions,column:e,...h.value.find(a=>{var m;return a.id===((m=e.colOptions)==null?void 0:m.fk_related_model_id)})}))),w=B(()=>{const t=q.value.find(e=>e.column.id===o.value.fk_relation_column_id);return t!=null&&t.id?$.value[t.id].columns.filter(e=>!F(e.uidt)&&(!ee(e)||e.pk)):[]});te(()=>{var t,e,a;j.value&&(o.value.fk_relation_column_id=(t=o.value.colOptions)==null?void 0:t.fk_relation_column_id,o.value.fk_rollup_column_id=(e=o.value.colOptions)==null?void 0:e.fk_rollup_column_id,o.value.rollup_function=(a=o.value.colOptions)==null?void 0:a.rollup_function)});const A=()=>{var t,e;o.value.fk_rollup_column_id=(e=(t=w.value)==null?void 0:t[0])==null?void 0:e.id,b()},E=t=>ne(F(t)?Z:H,{columnMeta:t}),v=S([]),P=[{text:i("datatype.Count"),value:"count"},{text:i("general.min"),value:"min"},{text:i("general.max"),value:"max"},{text:i("general.avg"),value:"avg"},{text:i("general.sum"),value:"sum"},{text:i("general.countDistinct"),value:"countDistinct"},{text:i("general.sumDistinct"),value:"sumDistinct"},{text:i("general.avgDistinct"),value:"avgDistinct"}];return oe(()=>o.value.fk_rollup_column_id,()=>{var e;const t=(e=w.value)==null?void 0:e.find(a=>a.id===o.value.fk_rollup_column_id);v.value=P.filter(a=>le(t==null?void 0:t.uidt).includes(a.value)),v.value.includes(o.value.rollup_function)||(o.value.rollup_function=v.value[0].value)}),(t,e)=>{const a=Q,m=ue,y=re,C=ce;return s(),g("div",me,[r("div",pe,[c(C,V({class:"flex w-1/2 pb-2",label:t.$t("labels.links")},n(x).fk_relation_column_id),{default:u(()=>[c(y,{value:n(o).fk_relation_column_id,"onUpdate:value":e[0]||(e[0]=l=>n(o).fk_relation_column_id=l),"dropdown-class-name":"!w-64 nc-dropdown-relation-table !rounded-md",onChange:A},{default:u(()=>[(s(!0),g(M,null,O(n(q),(l,d)=>(s(),_(m,{key:d,value:l.col.fk_column_id},{default:u(()=>[r("div",de,[c(a,{class:"font-semibold truncate min-w-1/2","show-on-truncate-only":""},{title:u(()=>[T(p(l.column.title),1)]),default:u(()=>[T(" "+p(l.column.title),1)]),_:2},1024),r("div",fe,[r("div",ve,[r("span",ge,p(l.col.type),1),r("span",ke,p(l.title||l.table_name),1)]),n(o).fk_relation_column_id===l.col.fk_column_id?(s(),_(k(("iconMap"in t?t.iconMap:n(D)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):R("",!0)])])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},16,["label"]),c(C,V({class:"flex w-1/2",label:t.$t("labels.childColumn")},n(x).fk_rollup_column_id),{default:u(()=>[c(y,{value:n(o).fk_rollup_column_id,"onUpdate:value":e[1]||(e[1]=l=>n(o).fk_rollup_column_id=l),name:"fk_rollup_column_id","dropdown-class-name":"nc-dropdown-relation-column !rounded-xl",onChange:n(b)},{default:u(()=>[(s(!0),g(M,null,O(n(w),(l,d)=>(s(),_(m,{key:d,value:l.id},{default:u(()=>[r("div",xe,[r("div",be,[(s(),_(k(E(l)),{"column-meta":l},null,8,["column-meta"])),r("div",he,p(l.title),1)]),n(o).fk_rollup_column_id===l.id?(s(),_(k(("iconMap"in t?t.iconMap:n(D)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):R("",!0)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange"])]),_:1},16,["label"])]),c(C,V({label:t.$t("labels.aggregateFunction")},n(x).rollup_function),{default:u(()=>[c(y,{value:n(o).rollup_function,"onUpdate:value":e[2]||(e[2]=l=>n(o).rollup_function=l),"dropdown-class-name":"nc-dropdown-rollup-function",class:"!mt-0.5",onChange:n(b)},{default:u(()=>[(s(!0),g(M,null,O(n(v),(l,d)=>(s(),_(m,{key:d,value:l.value},{default:u(()=>[r("div",we,[T(p(l.text)+" ",1),n(o).rollup_function===l.value?(s(),_(k(("iconMap"in t?t.iconMap:n(D)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):R("",!0)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange"])]),_:1},16,["label"])])}}});const wt=_e(ye,[["__scopeId","data-v-0b0aa824"]]);export{wt as default};
