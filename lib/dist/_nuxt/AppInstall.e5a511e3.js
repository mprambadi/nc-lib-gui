import{_ as R}from"./Button.vue.02ce6d5b.js";import{f as D,r as k,M as ee,i as te,O as t,o as l,c as n,b as f,a as i,S as se,T as S,t as U,w as m,U as h,V as g,d as V,P as p,Q as A,R as J,ae as le,gj as ae,a8 as oe,C as re,X as x,Y as L}from"./entry.96205fa0.js";import{S as ne}from"./index.9e8f59f4.js";import"./index.1431a68b.js";import{I as ie}from"./Input.3f1aaf0c.js";import{F as pe}from"./index.886d43e1.js";import{_ as ce}from"./Password.803cc3dc.js";import{_ as ue}from"./TextArea.b81a19ed.js";import{_ as de}from"./index.4a1cb0c9.js";import{_ as _e}from"./FormItem.9f1f85f2.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./debounce.1d5af9bf.js";import"./toNumber.ed208f2f.js";import"./isSymbol.d46b4957.js";import"./SearchOutlined.c9794270.js";import"./isPlainObject.631eb8fb.js";import"./_getPrototype.459a70cf.js";import"./antInputDirective.8ac36ea7.js";import"./FormItemContext.b19eb48c.js";import"./useSize.c98e621d.js";import"./identity.309e9ead.js";import"./_flatRest.ce557a88.js";import"./Col.b3c5d725.js";import"./responsiveObserve.358bcfe9.js";import"./toArray.3561b70e.js";const ye={key:0,class:"flex flex-row w-full justify-center items-center h-52"},fe={key:1,class:"flex flex-col"},me={class:"w-full relative"},ve={class:"flex flex-row justify-center pb-4 mb-2 border-b-1 w-full gap-x-1"},ke=["alt","src"],he={class:"font-semibold text-lg"},ge={class:"absolute -right-2 -top-0.5"},xe={key:0,class:"flex flex-row justify-center"},be={class:"text-center font-normal mb-2"},we={key:0,class:"text-red-600"},Ce={key:4,class:"absolute flex flex-col justify-start mt-2 -right-6 top-0"},Se=["colspan"],Ue={class:"flex flex-row space-x-4 justify-center mt-4"},Re=D({__name:"AppInstall",props:{id:{}},emits:["saved","close"],setup($,{emit:E}){const N=E,{$api:b}=re(),j=k(),{t:w}=ee(),a=k(null),r=k({}),C=k(!0),y=k(null),z={labelCol:{span:14,pull:4},wrapperCol:{span:20,pull:4}},Q=()=>r.value.push({}),X=async()=>{var o,u;y.value="save";try{await((o=j.value)==null?void 0:o.validateFields()),await b.plugin.update($.id,{input:JSON.stringify(r.value),active:!0}),N("saved"),x.success(((u=a.value)==null?void 0:u.formDetails.msgOnInstall)||w("msg.success.pluginSettingsSaved"))}catch(v){x.error(await L(v))}finally{y.value=null}},Y=async()=>{y.value="test";try{a.value&&(await b.plugin.test({input:JSON.stringify(r.value),title:a.value.title,category:a.value.category})?x.success(w("msg.success.pluginTested")):x.info(w("msg.info.invalidCredentials")))}catch(o){x.error(await L(o))}finally{y.value=null}},G=async o=>{switch(o){case"save":await X();break;case"test":await Y();break}},H=async()=>{try{C.value=!0;const o=await b.plugin.read($.id),u=JSON.parse(o.input_schema??"{}"),v=u.array?[{}]:{},_=typeof o.input=="string"?JSON.parse(o.input):v;"secure"in _&&typeof _.secure=="string"&&(_.secure=_.secure==="true"),a.value={...o,formDetails:u,parsedInput:_},r.value=a.value.parsedInput}catch(o){console.log(o)}finally{C.value=!1}},K=o=>r.value.splice(o,1);return te(async()=>{a.value||await H()}),(o,u)=>{var M;const v=ne,_=ae,q=oe,B=ce,F=ue,O=de,P=ie,I=_e,W=R,Z=pe;return t(C)?(l(),n("div",ye,[f(v,{size:"large"})])):(l(),n("div",fe,[i("div",me,[i("div",ve,[t(a).logo?(l(),n("div",{key:0,class:se(["mr-1 flex items-center justify-center",[t(a).title==="SES"?"p-2 bg-[#242f3e]":""]])},[i("img",{alt:t(a).title||"plugin",src:`/${t(a).logo}`,class:"h-6"},null,8,ke)],2)):S("",!0),i("span",he,U(t(a).formDetails.title),1)]),i("div",ge,[f(q,{type:"text",class:"!rounded-md mr-1",onClick:u[0]||(u[0]=e=>N("close"))},{icon:m(()=>[f(_,{class:"flex mx-auto"})]),_:1})])]),f(Z,le({ref_key:"formRef",ref:j},(M=t(a))!=null&&M.formDetails.array?{}:z,{model:t(r),class:"mx-4 mt-3"}),{default:m(()=>[t(a).formDetails.array?(l(),n("div",xe,[i("table",null,[i("thead",null,[i("tr",null,[(l(!0),n(h,null,g(t(a).formDetails.items,(e,c)=>(l(),n("th",{key:c},[i("div",be,[V(U(e.label)+" ",1),e.required?(l(),n("span",we,"*")):S("",!0)])]))),128))])]),i("tbody",null,[(l(!0),n(h,null,g(t(a).parsedInput,(e,c)=>(l(),n("tr",{key:c},[(l(!0),n(h,null,g(t(a).formDetails.items,(s,T)=>(l(),n("td",{key:T,class:"px-2"},[f(I,{class:"relative mb-3",name:[`${c}`,s.key],rules:[{required:s.required,message:`${s.label} is required`}]},{default:m(()=>[s.type==="Password"?(l(),p(B,{key:0,value:e[s.key],"onUpdate:value":d=>e[s.key]=d,placeholder:s.placeholder},null,8,["value","onUpdate:value","placeholder"])):s.type==="LongText"?(l(),p(F,{key:1,value:e[s.key],"onUpdate:value":d=>e[s.key]=d,placeholder:s.placeholder},null,8,["value","onUpdate:value","placeholder"])):s.type==="Checkbox"?(l(),p(O,{key:2,value:e[s.key],"onUpdate:value":d=>e[s.key]=d,placeholder:s.placeholder},null,8,["value","onUpdate:value","placeholder"])):(l(),p(P,{key:3,value:e[s.key],"onUpdate:value":d=>e[s.key]=d,placeholder:s.placeholder},null,8,["value","onUpdate:value","placeholder"])),c!==0&&T===t(a).formDetails.items.length-1?(l(),n("div",Ce,[(l(),p(A(t(J).delete),{class:"hover:text-red-400 cursor-pointer",onClick:d=>K(c)},null,8,["onClick"]))])):S("",!0)]),_:2},1032,["name","rules"])]))),128))]))),128))]),i("tr",null,[i("td",{colspan:t(a).formDetails.items.length,class:"text-center"},[f(q,{type:"default",class:"!bg-gray-100 rounded-md border-none mr-1",onClick:Q},{icon:m(()=>[(l(),p(A(t(J).plus),{class:"flex mx-auto"}))]),_:1})],8,Se)])])])):(l(!0),n(h,{key:1},g(t(a).formDetails.items,(e,c)=>(l(),p(I,{key:c,label:e.label,name:e.key,rules:[{required:e.required,message:`${e.label} is required`}]},{default:m(()=>[e.type==="Password"?(l(),p(B,{key:0,value:t(r)[e.key],"onUpdate:value":s=>t(r)[e.key]=s,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.type==="LongText"?(l(),p(F,{key:1,value:t(r)[e.key],"onUpdate:value":s=>t(r)[e.key]=s,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.type==="Checkbox"?(l(),p(O,{key:2,checked:t(r)[e.key],"onUpdate:checked":s=>t(r)[e.key]=s,placeholder:e.placeholder},null,8,["checked","onUpdate:checked","placeholder"])):(l(),p(P,{key:3,value:t(r)[e.key],"onUpdate:value":s=>t(r)[e.key]=s,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"]))]),_:2},1032,["label","name","rules"]))),128)),i("div",Ue,[(l(!0),n(h,null,g(t(a).formDetails.actions,(e,c)=>(l(),p(W,{key:c,class:"!px-5",loading:t(y)===e.key,type:e.key==="save"?"primary":"default",disabled:!!t(y),onClick:s=>G(e.key)},{default:m(()=>[V(U(e.label),1)]),_:2},1032,["loading","type","disabled","onClick"]))),128))])]),_:1},16,["model"])]))}}});export{Re as default};
