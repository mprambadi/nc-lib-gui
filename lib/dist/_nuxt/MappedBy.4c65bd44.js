import{a as G}from"./useMapViewDataStore.adf59320.js";import{o as l,c as b,a as o,f as L,bb as r,r as n,H as z,g as v,go as H,cG as R,c9 as Q,O as a,P as p,w as d,cb as g,t as m,b as _,W as w,T as h,au as W,d as Y,Q as q,R as J,a8 as K}from"./entry.96205fa0.js";import{M as X,A as Z,f as ee,b as te}from"./index.9b87fcff.js";import{a as oe}from"./useSmartsheetStore.7d51347e.js";import{u as ae}from"./useViewColumns.8927231f.js";import{D as se}from"./index.6c1d17b6.js";import{_ as ie}from"./index.c968c966.js";import{_ as ne}from"./index.b5e393d6.js";import"./useSharedView.9e320acb.js";import"./bases.965a49bb.js";import"./index.0c5b3837.js";import"./dataUtils.fb0a3616.js";import"./index.e034edbd.js";import"./views.2c163cf7.js";import"./Dropdown.1dedd322.js";import"./RightOutlined.3ce786f5.js";import"./toArray.3561b70e.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.dbc63a5f.js";import"./useState.5a301439.js";import"./CheckOutlined.3b90c20d.js";import"./SearchOutlined.c9794270.js";import"./FormItemContext.b19eb48c.js";const le={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},re=o("path",{fill:"currentColor",d:"M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2m0 2a8 8 0 0 1 8 8a8 8 0 0 1-8 8a8 8 0 0 1-8-8a8 8 0 0 1 8-8m-5 6l5 5l5-5z"},null,-1),ce=[re];function pe(y,u){return l(),b("svg",le,[...ce])}const de={name:"mdi-arrow-down-drop-circle-outline",render:pe},me={class:"nc-map-btn"},_e={class:"flex items-center gap-1"},ue={class:"text-capitalize !text-sm font-weight-normal"},fe={class:"font-bold"},ve={class:"font-bold"},ge={class:"nc-fields-list py-1"},we={class:"grouping-field"},ze=L({__name:"MappedBy",setup(y){const{eventBus:u}=oe(),M=r(X,n()),f=r(Z,n()),k=r(ee,n(!1)),C=r(te,n(!1)),{fields:D,loadViewColumns:x,metaColumnById:B}=ae(),{loadMapData:I,loadMapMeta:V,updateMapMeta:S,mapMetaData:A,geoDataFieldColumn:N}=G(),i=n(!1);z(()=>{var t;return(t=f.value)==null?void 0:t.id},async(t,e)=>{t!==e&&M.value&&await x()},{immediate:!0});const c=v({get:()=>A.value.fk_geo_data_col_id,set:async t=>{var e;t&&(await S({fk_geo_data_col_id:t}),await V(),await I(),((e=f.value)==null?void 0:e.view).fk_geo_data_col_id=t,u.emit(H.MAPPED_BY_COLUMN_CHANGE))}}),O=v(()=>{var t;return(t=D.value)==null?void 0:t.filter(e=>e.fk_column_id&&B.value[e.fk_column_id].uidt===R.GeoData).map(e=>({value:e.fk_column_id,label:e.title}))}),T=()=>{i.value=!1};return(t,e)=>{const j=de,F=K,P=ie,$=ne,E=se,U=Q("e");return a(C)?h("",!0):(l(),p(E,{key:0,visible:a(i),"onUpdate:visible":e[3]||(e[3]=s=>w(i)?i.value=s:null),trigger:["click"],class:"!xs:hidden"},{overlay:d(()=>[a(i)?(l(),b("div",{key:0,class:"p-3 min-w-[280px] bg-gray-50 shadow-lg nc-table-toolbar-menu max-h-[max(80vh,500px)] overflow-auto !border",onClick:e[2]||(e[2]=g(()=>{},["stop"]))},[o("div",null,[o("span",ve,m(t.$t("activity.map.chooseMappingField")),1),_(P,{class:"!my-2"})]),o("div",ge,[o("div",we,[_($,{value:a(c),"onUpdate:value":e[0]||(e[0]=s=>w(c)?c.value=s:null),class:"w-full nc-msp-grouping-field-select",options:a(O),placeholder:"Select a Mapping Field",onChange:T,onClick:e[1]||(e[1]=g(()=>{},["stop"]))},null,8,["value","options"])])])])):h("",!0)]),default:d(()=>[o("div",me,[W((l(),p(F,{class:"nc-map-stacked-by-menu-btn nc-toolbar-btn",disabled:a(k)},{default:d(()=>{var s;return[o("div",_e,[_(j),o("span",ue,[Y(m(t.$t("activity.map.mappedBy"))+" ",1),o("span",fe,m((s=a(N))==null?void 0:s.title),1)]),(l(),p(q(a(J).arrowDown),{class:"text-grey"}))])]}),_:1},8,["disabled"])),[[U,["c:map:change-grouping-field"]]])])]),_:1},8,["visible"]))}}});export{ze as default};
