import{_ as he}from"./Tooltip.vue.00c0d0fb.js";import{_ as xe}from"./Icon.vue.6d0583a0.js";import{f as ke,$ as Ce,bb as p,r as d,g as w,aM as Ie,N as Me,i as Se,H as ee,fV as te,X as Oe,Y as Ae,a6 as Ee,o as v,c as A,O as t,aK as E,U as le,V as ae,P as k,w as f,a as _,fo as C,S as I,b as R,d as N,t as h,n as Re,T as se,cb as $e,Q as Ve,R as je,W as Ke,C as Te,eR as ze}from"./entry.96205fa0.js";import{C as Be,i as Ne,E as De,m as Pe,c as Fe,b as He,r as qe,z as Le,l as Ue,j as Ge}from"./index.9b87fcff.js";import{b as Qe,a as We}from"./bases.965a49bb.js";import{u as oe}from"./index.a5de28c1.js";import{M as Xe}from"./close-circle.04e3f837.js";import{_ as Ye}from"./index.b7feb234.js";import{S as Je,_ as Ze}from"./index.b5e393d6.js";import{_ as et}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.0c5b3837.js";import"./toArray.3561b70e.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.dbc63a5f.js";import"./useState.5a301439.js";import"./CheckOutlined.3b90c20d.js";import"./SearchOutlined.c9794270.js";import"./FormItemContext.b19eb48c.js";const tt={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},lt={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},at={class:"flex gap-2 text-gray-500 items-center h-full"},st={class:"text-xs whitespace-normal"},ot=ke({__name:"MultiSelect",props:{modelValue:{},rowIndex:{},disableOptionCreation:{type:Boolean},location:{}},emits:["update:modelValue"],setup(x,{emit:ne}){const ie=ne,{isMobileMode:ce}=Ce(),i=p(Be),$=p(Ne),D=p(De,d(!1)),P=p(Pe,d(!1)),F=p(Fe,d(!1)),V=w(()=>P.value||D.value||F.value),H=p(He,d(!1)),re=p(qe,d(!1)),ue=p(Le,d(void 0)),de=p(Ue,d(!1)),j=d([]),M=d(),c=d(!1),K=d(!1),T=p(Ge,d(!1)),u=d(),{$api:fe}=Te(),{getMeta:pe}=Qe(),{isUIAllowed:q}=Ie(),{isPg:L,isMysql:U}=We(),S=Me([]),r=w(()=>{var e;if(i!=null&&i.value.colOptions){const l=i.value.colOptions?i.value.colOptions.options.filter(a=>a.title!=="")||[]:[];for(const a of l.filter(s=>s.order===null))a.title=(e=a.title)==null?void 0:e.replace(/^'/,"").replace(/'$/,"");return l.map(a=>({...a,value:a.title}))}return[]}),G=w(()=>(r.value??[]).every(e=>e.title!==u.value)),Q=w(()=>q("dataEdit")),m=w(()=>(Q.value||F.value)&&V.value),y=w({get:()=>{const e=j.value.reduce((l,a)=>{var n;const s=(n=r.value.find(b=>b.id===a)||r.value.find(b=>b.title===a))==null?void 0:n.title;return s&&l.push(s),l},[]);return S.length&&e.push(...S),e},set:e=>{if(G.value&&e.length&&e[e.length-1]===u.value)return ve();ie("update:modelValue",e.length===0?null:e.join(","))}}),W=w(()=>x.modelValue?Array.isArray(x.modelValue)?x.modelValue:U(i.value.source_id)?x.modelValue.toString().split(",").sort((e,l)=>{const a=r.value.find(n=>n.title===e),s=r.value.find(n=>n.title===l);return a&&s?a.order-s.order:0}):x.modelValue.toString().split(","):[]);Se(()=>{j.value=W.value.flatMap(e=>{const l=r.value.find(s=>s.title===e||s.title===(e==null?void 0:e.trim())),a=(l==null?void 0:l.id)||(l==null?void 0:l.title);return a?[a]:[]})}),ee(()=>x.modelValue,()=>{j.value=W.value.flatMap(e=>{const l=r.value.find(a=>a.title===e||a.title===(e==null?void 0:e.trim()));return l&&(l.id||l.title)?[l.id||l.title]:[]})}),ee(c,(e,l)=>{var a,s,n;e||(u.value=""),m.value&&e&&((n=(s=(a=M.value)==null?void 0:a.$el)==null?void 0:s.querySelector("input"))==null||n.focus())}),oe(P,e=>{var l;switch(e.key){case"Escape":c.value=!1;break;case"Enter":m.value&&V.value&&!c.value&&(c.value=!0);break;case" ":break;case"ArrowUp":case"ArrowDown":case"ArrowRight":case"ArrowLeft":case"Delete":break;default:if(!m.value){e.preventDefault();break}!(e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)&&((l=e.key)==null?void 0:l.length)===1&&!ze()&&(e.stopPropagation(),c.value=!0);break}}),oe(c,e=>{e.key==="Escape"&&(c.value=!1)});const O=d(0);async function ve(){var e,l;if(!u.value||H.value)return!1;try{S.push(u.value);const a=u==null?void 0:u.value;if(u.value="",O.value++,a&&!r.value.some(s=>s.title===a)){const s=[...r.value];s.push({title:a,value:a,color:te.light[(r.value.length+1)%te.light.length]}),i.value.colOptions={options:s.map(({value:b,...z})=>z)};const n={...i.value};n.cdf&&(L(i.value.source_id)&&(n.cdf=n.cdf.substring(n.cdf.indexOf("'")+1,n.cdf.lastIndexOf("'"))),!U(i.value.source_id)&&!L(i.value.source_id)&&(n.cdf=n.cdf.replace(/''/g,"'"))),await fe.dbTableColumn.update(((e=i.value)==null?void 0:e.fk_column_id)||((l=i.value)==null?void 0:l.id),n),O.value--,O.value||(await pe(i.value.fk_model_id,!0),y.value=[...y.value],S.splice(0,S.length))}else O.value--}catch(a){console.log(a),O.value--,Oe.error(await Ae(a))}}const me=()=>{var e,l,a;u.value=(a=(l=(e=M.value)==null?void 0:e.$el)==null?void 0:l.querySelector(".ant-select-selection-search-input"))==null?void 0:a.value},ge=(e,l)=>{var a,s;((a=e.target)!=null&&a.classList.contains("ant-tag-close-icon")||(s=e.target)!=null&&s.closest(".ant-tag-close-icon"))&&(e.stopPropagation(),l())},we=()=>{K.value||(c.value=m.value&&!c.value)};Ee(document,"click",e=>{var l;c.value&&M.value&&!M.value.$el.contains(e.target)&&!((l=document.querySelector(".nc-dropdown-multi-select-cell.active"))!=null&&l.contains(e.target))&&(D.value=!1,c.value=!1)},!0);const _e=w(()=>y.value.reduce((e,l)=>{const a=r.value.find(s=>s.value===l);return a&&e.push(a),e},[])),ye=e=>{if(e.key==="Tab"){c.value=!1;return}e.stopPropagation()},be=()=>{K.value=!0,setTimeout(()=>{K.value=!1},250),c.value=!0};return(e,l)=>{const a=he,s=Ye,n=xe,b=Je,z=Ze;return v(),A("div",{class:I(["nc-multi-select h-full w-full flex items-center",{"read-only":t($),"px-2":t(de)}]),onClick:we},[t(V)?(v(),k(z,{key:1,ref_key:"aselect",ref:M,value:t(y),"onUpdate:value":l[1]||(l[1]=o=>Ke(y)?y.value=o:null),mode:"multiple",class:I(["w-full overflow-hidden",{"caret-transparent":!t(Q)}]),placeholder:t(re)?e.$t("labels.optional"):"",bordered:!1,"clear-icon":"","show-search":!t(ce),"show-arrow":t(m)&&!t($),open:t(c)&&t(m),disabled:t($)||!t(m),"dropdown-class-name":`nc-dropdown-multi-select-cell !min-w-200px ${t(c)?"active":""}`,onSearch:me,onKeydown:ye,onFocus:be,onBlur:l[2]||(l[2]=o=>c.value=!1)},{suffixIcon:f(()=>[R(n,{icon:"arrowDown",class:"text-gray-700 nc-select-expand-btn"})]),tagRender:f(({value:o,onClose:X})=>{var Y,J;return[t(r).find(g=>g.title===o)?(v(),k(s,{key:0,class:"rounded-tag nc-selected-option",style:{display:"flex",alignItems:"center"},color:(Y=t(r).find(g=>g.title===o))==null?void 0:Y.color,closable:t(m)&&(t(y).length>1||!((J=t(i))!=null&&J.rqd)),"close-icon":t(Re)(t(Xe),{class:["ms-close-icon"]}),onClick:g=>ge(g,X),onClose:X},{default:f(()=>{var g,Z;return[_("span",{style:E({color:t(C).isReadable(((g=t(r).find(B=>B.title===o))==null?void 0:g.color)||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":t(C).mostReadable(((Z=t(r).find(B=>B.title===o))==null?void 0:Z.color)||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:I({"text-sm":t(T)})},h(o),7)]}),_:2},1032,["color","closable","close-icon","onClick","onClose"])):se("",!0)]}),default:f(()=>[(v(!0),A(le,null,ae(t(r),o=>(v(),k(b,{key:o.id||o.title,value:o.title,"data-testid":`select-option-${t(i).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:I(`nc-select-option-${t(i).title}-${o.title}`),onClick:l[0]||(l[0]=$e(()=>{},["stop"]))},{default:f(()=>[R(s,{class:"rounded-tag max-w-full",color:o.color},{default:f(()=>[_("span",{style:E({color:t(C).isReadable(o.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":t(C).mostReadable(o.color||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:I({"text-sm":t(T)})},[R(a,{class:"truncate max-w-full","show-on-truncate-only":""},{title:f(()=>[N(h(o.title),1)]),default:f(()=>[_("span",lt,h(o.title),1)]),_:2},1024)],6)]),_:2},1032,["color"])]),_:2},1032,["value","data-testid","class"]))),128)),t(u)&&t(G)&&!t(H)&&!e.disableOptionCreation&&t(q)("fieldEdit")?(v(),k(b,{key:t(u),value:t(u)},{default:f(()=>[_("div",at,[(v(),k(Ve(t(je).plusThick),{class:"min-w-4"})),_("div",st,[N(h(e.$t("msg.selectOption.createNewOptionNamed"))+" ",1),_("strong",null,h(t(u)),1)])])]),_:1},8,["value"])):se("",!0)]),_:1},8,["value","placeholder","show-search","show-arrow","open","disabled","class","dropdown-class-name"])):(v(),A("div",{key:0,class:"flex flex-wrap",style:E({display:"-webkit-box","max-width":"100%","-webkit-line-clamp":t(ue)||1,"-webkit-box-orient":"vertical",overflow:"hidden"})},[(v(!0),A(le,null,ae(t(_e),o=>(v(),k(s,{key:o.value,class:"rounded-tag max-w-full",color:o.color},{default:f(()=>[_("span",{style:E({color:t(C).isReadable(o.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":t(C).mostReadable(o.color||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:I({"text-sm":t(T)})},[R(a,{class:"truncate max-w-full","show-on-truncate-only":""},{title:f(()=>[N(h(o.title),1)]),default:f(()=>[_("span",tt,h(o.title),1)]),_:2},1024)],6)]),_:2},1032,["color"]))),128))],4))],2)}}});const Mt=et(ot,[["__scopeId","data-v-4e1c58bb"]]);export{Mt as default};
