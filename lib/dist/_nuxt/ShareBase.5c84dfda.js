import{o,c as m,a as c,f as H,M as K,r as M,bF as Q,g as W,i as X,t as i,b as t,w as a,O as n,W as Y,P as v,U as q,V as J,T as R,Q as w,R as x,X as u,Y as g,a8 as Z,ce as ee,cf as ae,af as se,C as te}from"./entry.96205fa0.js";import{a as oe}from"./bases.965a49bb.js";import{u as re}from"./useCopy.00050b95.js";import{u as le}from"./useDashboard.0f55d174.js";import{D as ne}from"./index.6c1d17b6.js";import{S as ce,_ as ie}from"./index.b5e393d6.js";import"./index.0c5b3837.js";import"./Dropdown.1dedd322.js";import"./RightOutlined.3ce786f5.js";import"./toArray.3561b70e.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.dbc63a5f.js";import"./useState.5a301439.js";import"./CheckOutlined.3b90c20d.js";import"./SearchOutlined.c9794270.js";import"./FormItemContext.b19eb48c.js";const de={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ue=c("path",{fill:"currentColor",d:"M8.12 9.29L12 13.17l3.88-3.88a.996.996 0 1 1 1.41 1.41l-4.59 4.59a.996.996 0 0 1-1.41 0L6.7 10.7a.996.996 0 0 1 0-1.41c.39-.38 1.03-.39 1.42 0"},null,-1),me=[ue];function pe(V,B){return o(),m("svg",de,[...me])}const _e={name:"ic-round-keyboard-arrow-down",render:pe},fe={class:"flex flex-col gap-2 w-full","data-testid":"nc-share-base-sub-modal"},ve={class:"flex text-xs text-gray-500 justify-start ml-1"},he={class:"flex flex-row justify-between mx-1"},be={class:"flex flex-row rounded-md items-center space-x-2 nc-disable-shared-base"},ye={key:0},we={key:1},xe={class:"flex flex-row"},ge={class:"w-full px-2 capitalize"},Be={key:0,class:"flex flex-row mt-2 bg-red-50 py-4 mx-1 px-2 items-center rounded-sm w-full justify-between"},ke={class:"flex text-xs overflow-x-hidden overflow-ellipsis text-gray-700 pl-2 nc-url"},$e={class:"flex border-l-1 pt-1 pl-1"},Ge=H({__name:"ShareBase",setup(V){const{t:B}=K(),{dashboardUrl:L}=le(),{$api:b,$e:f}=te(),s=M(null),k=M(!1),{base:d}=Q(oe()),{copy:$}=re(),p=W(()=>s.value&&s.value.uuid?`${L.value}#/base/${s.value.uuid}`:null),T=async()=>{try{if(!d.value.id)return;const e=await b.base.sharedBaseGet(d.value.id);s.value={uuid:e.uuid,url:e.url,role:e.roles}}catch(e){u.error(await g(e))}},C=async(e="viewer")=>{try{if(!d.value.id)return;const r=await b.base.sharedBaseUpdate(d.value.id,{roles:e});s.value=r??{},s.value.role=e}catch(r){u.error(await g(r))}f("a:shared-base:enable",{role:e})},E=async()=>{try{if(!d.value.id)return;await b.base.sharedBaseDisable(d.value.id),s.value=null}catch(e){u.error(await g(e))}f("a:shared-base:disable")},I=async()=>{var e,r;try{if(!d.value.id)return;const _=await b.base.sharedBaseCreate(d.value.id,{roles:((e=s.value)==null?void 0:e.role)||"viewer"})||{};s.value={..._,role:(r=s.value)==null?void 0:r.role}}catch(h){u.error(await g(h))}f("a:shared-base:recreate")},N=async()=>{if(p.value){try{await $(p.value),u.success(B("msg.success.shareableURLCopied"))}catch(e){u.error(e.message)}f("c:shared-base:copy-url")}},j=()=>{p.value&&(window.open(p.value,"_blank"),f("c:shared-base:open-url"))},F=async()=>{if(p.value){try{await $(`<iframe
class="nc-embed"
src="${p.value}?embed"
frameborder="0"
width="100%"
height="700"
style="background: transparent; border: 1px solid #ddd"></iframe>`),u.success(B("msg.success.embeddableHTMLCodeCopied"))}catch(e){u.error(e.message)}f("c:shared-base:copy-embed-frame")}};return X(()=>{s.value||T()}),(e,r)=>{var S,D;const h=_e,_=Z,z=ee,A=ae,O=ne,P=ce,G=ie,y=se;return o(),m("div",fe,[c("div",ve,i(e.$t("msg.info.generatePublicShareableReadonlyBase")),1),c("div",he,[t(O,{modelValue:n(k),"onUpdate:modelValue":r[1]||(r[1]=l=>Y(k)?k.value=l:null),class:"flex","overlay-class-name":"nc-dropdown-shared-base-toggle"},{overlay:a(()=>[t(A,null,{default:a(()=>[t(z,null,{default:a(()=>{var l;return[(l=n(s))!=null&&l.uuid?(o(),m("div",{key:0,class:"py-3",onClick:E},i(e.$t("activity.shareBase.disable")),1)):(o(),m("div",{key:1,class:"py-3",onClick:r[0]||(r[0]=U=>C("viewer"))},i(e.$t("activity.shareBase.enable")),1))]}),_:1})]),_:1})]),default:a(()=>[t(_,null,{default:a(()=>{var l;return[c("div",be,[(l=n(s))!=null&&l.uuid?(o(),m("div",ye,i(e.$t("activity.shareBase.enable")),1)):(o(),m("div",we,i(e.$t("activity.shareBase.disable")),1)),t(h,{class:"h-[1rem]"})])]}),_:1})]),_:1},8,["modelValue"]),(S=n(s))!=null&&S.uuid?(o(),v(G,{key:0,value:n(s).role,"onUpdate:value":r[2]||(r[2]=l=>n(s).role=l),class:"flex nc-shared-base-role","dropdown-class-name":"nc-dropdown-share-base-role"},{suffixIcon:a(()=>[c("div",xe,[t(h,{class:"text-black -mt-0.5 h-[1rem]"})])]),default:a(()=>[(o(!0),m(q,null,J(["editor","viewer"],(l,U)=>(o(),v(P,{key:U,value:l,"dropdown-class-name":"capitalize",onClick:Ce=>C(l)},{default:a(()=>[c("div",ge,i(l),1)]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["value"])):R("",!0)]),(D=n(s))!=null&&D.uuid?(o(),m("div",Be,[c("span",ke,i(n(p)),1),c("div",$e,[t(y,{placement:"bottom"},{title:a(()=>[c("span",null,i(e.$t("general.reload")),1)]),default:a(()=>[t(_,{type:"text",class:"!rounded-md mr-1 -mt-1.5 h-[1rem]",onClick:I},{icon:a(()=>[(o(),v(w(n(x).reload),{class:"flex mx-auto text-gray-600"}))]),_:1})]),_:1}),t(y,{placement:"bottom"},{title:a(()=>[c("span",null,i(e.$t("activity.copyUrl")),1)]),default:a(()=>[t(_,{type:"text",class:"!rounded-md mr-1 -mt-1.5 h-[1rem]",onClick:N},{icon:a(()=>[(o(),v(w(n(x).copy),{class:"flex mx-auto text-gray-600"}))]),_:1})]),_:1}),t(y,{placement:"bottom"},{title:a(()=>[c("span",null,i(e.$t("activity.openTab")),1)]),default:a(()=>[t(_,{type:"text",class:"!rounded-md mr-1 -mt-1.5 h-[1rem]",onClick:j},{icon:a(()=>[(o(),v(w(n(x).share),{class:"flex mx-auto text-gray-600"}))]),_:1})]),_:1}),t(y,{placement:"bottom"},{title:a(()=>[c("span",null,i(e.$t("activity.iFrame")),1)]),default:a(()=>[t(_,{type:"text",class:"!rounded-md mr-1 -mt-1.5 h-[1rem]",onClick:F},{icon:a(()=>[(o(),v(w(n(x).xml),{class:"flex mx-auto text-gray-600"}))]),_:1})]),_:1})])])):R("",!0)])}}});export{Ge as default};
