import{_ as be}from"./Icon.vue.5fdb2789.js";import{_ as we}from"./Tooltip.vue.971897f4.js";import{f as se,bu as ge,r as p,bb as C,g as P,cG as x,cZ as ne,fU as he,eZ as re,eX as ae,H as le,i as ie,c9 as ce,o,c as m,a as _,au as $,ey as xe,O as e,W as J,t as h,T,U as D,V as Y,S as j,b as R,w as c,d as F,bv as q,cb as w,$ as ke,gp as Se,P as i,Q as U,R as B,gC as Ce,a8 as $e}from"./entry.5958c07b.js";import{A as de,M as ue,f as Le,R as Oe,b as Te}from"./index.9b87fcff.js";import{u as me}from"./useViewColumns.f203dc14.js";import{u as pe}from"./useViewSorts.a16054fa.js";import{_ as Ie}from"./FieldListAutoCompleteDropdown.vue.cf11aa27.js";import{_ as Me}from"./Select.vue.8e3ebbe2.js";import{_ as Ve}from"./Button.vue.c3ca0e8f.js";import{_ as Ue}from"./Dropdown.vue.0d2ed10f.js";import{e as Be}from"./bases.e6c8e3c4.js";import{g as De}from"./sortUtils.80b4f692.js";import{i as Re}from"./index.025c8e21.js";import{u as Ne}from"./index.852e6a77.js";import{a as Ae}from"./useSmartsheetStore.f1a70558.js";import{S as Ee}from"./index.5c6e4286.js";import{_ as Pe}from"./_plugin-vue_export-helper.c27b6911.js";import"./VirtualCellIcon.aeca9423.js";import"./virtualCell.427fa223.js";import"./CellIcon.b1340151.js";import"./cell.165313cd.js";import"./index.e61e381a.js";import"./Icon.vue.129448d5.js";import"./index.55641318.js";import"./debounce.7c24f171.js";import"./toNumber.e09cd85a.js";import"./isSymbol.114fe557.js";import"./index.dc13a4d6.js";import"./Dropdown.041b2468.js";import"./RightOutlined.7161c742.js";import"./index.0feaca99.js";import"./views.4281cbf1.js";import"./useSharedView.e8f68616.js";import"./toArray.fd74ce6f.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.1dd071d8.js";import"./useState.b891c8bb.js";import"./CheckOutlined.1fe5f230.js";import"./SearchOutlined.a517903c.js";import"./FormItemContext.ddc65fa5.js";const je=["onKeydown"],Fe={class:"flex pb-3 px-4 border-b-1 border-gray-100"},ze=["placeholder"],Ge={class:"flex-col w-full max-h-100 max-w-76 nc-scrollbar-md !overflow-y-auto"},Ke={key:0,class:"flex text-gray-500 px-4 py-2.25"},Qe=["onClick"],He=se({__name:"CreateSort",props:{isParentOpen:{type:Boolean}},emits:["created"],setup(ee,{emit:z}){const G=ee,K=z,{isParentOpen:L}=ge(G),N=p(),k=p(""),n=p(-1),I=C(de,p()),A=C(ue,p()),{showSystemFields:Q,metaColumnById:M}=me(),{sorts:H}=pe(I),g=P(()=>{var l,y;return((y=(l=A.value)==null?void 0:l.columns)==null?void 0:y.filter(r=>{var u;return r.uidt===x.Links?!0:ne((u=M==null?void 0:M.value)==null?void 0:u[r.id])?he(r)?!1:Q.value:r.uidt===x.QrCode||r.uidt===x.Barcode||r.uidt===x.ID?!1:!(re(r)&&r.colOptions.type!==ae.BELONGS_TO)}).filter(r=>!H.value.find(u=>u.fk_column_id===r.id)).filter(r=>{var u;return(u=r.title)==null?void 0:u.toLowerCase().includes(k.value.toLowerCase())}))??[]}),d=l=>{K("created",l)};le(L,()=>{L.value&&setTimeout(()=>{var l;(l=N.value)==null||l.focus()},100)},{immediate:!0}),ie(()=>{k.value="",n.value=-1});const W=()=>{n.value=Math.min(n.value+1,g.value.length-1)},Z=()=>{n.value=Math.max(n.value-1,0)};return(l,y)=>{const r=be,u=we,b=ce("e");return o(),m("div",{class:"flex flex-col w-full pt-4 pb-2 min-w-64 nc-sort-create-modal",onKeydown:[q(w(W,["prevent"]),["arrow-down"]),q(w(Z,["prevent"]),["arrow-up"]),y[1]||(y[1]=q(w(f=>d(e(g)[e(n)]),["prevent"]),["enter"]))]},[_("div",Fe,[$(_("input",{ref_key:"inputRef",ref:N,"onUpdate:modelValue":y[0]||(y[0]=f=>J(k)?k.value=f:null),class:"w-full focus:outline-none",placeholder:l.$t("msg.selectFieldToSort")},null,8,ze),[[xe,e(k)]])]),_("div",Ge,[e(g).length?T("",!0):(o(),m("div",Ke,h(l.$t("general.empty")),1)),(o(!0),m(D,null,Y(e(g),(f,s)=>$((o(),m("div",{key:s,class:j(["flex flex-row h-10 items-center gap-x-1.5 px-2.5 rounded-md m-1.5 hover:bg-gray-100 cursor-pointer nc-sort-column-search-item",{"bg-gray-100":e(n)===s}]),onClick:t=>d(f)},[R(r,{column:f},null,8,["column"]),R(u,{class:"truncate","show-on-truncate-only":""},{title:c(()=>[F(h(f.title),1)]),default:c(()=>[F(h(f.title),1)]),_:2},1024)],10,Qe)),[[b,["c:sort:add:column:select"]]])),128))])],40,je)}}}),We={class:"flex items-center gap-2"},Ze={key:0,class:"text-capitalize !text-sm font-medium"},Xe={key:1,class:"bg-brand-50 text-brand-500 py-1 px-2 text-md rounded-md"},qe={class:"flex items-center justify-between gap-2"},Je={class:"truncate flex-1"},Ye={class:"flex gap-1 items-center"},et={class:"flex gap-1 items-center"},tt=se({__name:"SortListMenu",setup(ee){const z=C(ue,p()),G=C(de,p()),K=C(Le,p(!1)),L=C(Oe),N=C(Te,p(!1)),{eventBus:k}=Ae(),{sorts:n,saveOrUpdate:I,loadSorts:A,addSort:Q,deleteSort:M}=pe(G,()=>L==null?void 0:L.trigger()),{showSystemFields:H,metaColumnById:g}=me(),d=p(!1),{isMobileMode:W}=ke(),{getPlanLimit:Z}=Be();k.on(s=>{s===Se.SORT_RELOAD&&A()});const l=P(()=>{var s;return((s=z.value)==null?void 0:s.columns)||[]}),y=P(()=>l.value.reduce((s,t)=>(s[t.id]=t,s),{})),r=P(()=>{var s;return(s=l.value)==null?void 0:s.filter(t=>{var O;return t.uidt===x.Links?!0:ne((O=g==null?void 0:g.value)==null?void 0:O[t.id])?H.value:t.uidt===x.QrCode||t.uidt===x.Barcode||t.uidt===x.ID?!1:!(re(t)&&t.colOptions.type!==ae.BELONGS_TO)}).filter(t=>!n.value.find(O=>O.fk_column_id===t.id))}),u=s=>{var t;return s&&((t=y.value[s])==null?void 0:t.uidt)||""},b=p(!1);Ne(b);const f=s=>{Q(!0,s);const t=n.value[n.value.length-1];I(t,n.value.length-1),d.value=!1};return le(b,()=>{b.value||(d.value=!1)}),ie(()=>{A()}),(s,t)=>{const O=$e,te=He,fe=Ie,ve=Ee,_e=Me,X=Ve,oe=Ue,V=ce("e");return o(),i(oe,{visible:e(b),"onUpdate:visible":t[6]||(t[6]=S=>J(b)?b.value=S:null),trigger:["click"],class:"!xs:hidden","overlay-class-name":"nc-dropdown-sort-menu nc-toolbar-dropdown"},{overlay:c(()=>{var S;return[e(n).length?(o(),m("div",{key:1,class:j([{"min-w-102":e(n).length},"py-6 pl-6 nc-filter-list max-h-[max(80vh,30rem)]"]),"data-testid":"nc-sorts-menu"},[_("div",{class:j(["sort-grid max-h-120 nc-scrollbar-md",{"pb-3 pr-3.5":(S=e(n))==null?void 0:S.length,"!pb-0":!e(r).length}]),onClick:t[2]||(t[2]=w(()=>{},["stop"]))},[(o(!0),m(D,null,Y(e(n),(a,E)=>(o(),m(D,{key:E},[R(fe,{modelValue:a.fk_column_id,"onUpdate:modelValue":[v=>a.fk_column_id=v,v=>e(I)(a,E)],class:"flex caption nc-sort-field-select w-44 flex-grow",columns:e(l),"is-sort":"",onClick:t[0]||(t[0]=w(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","columns"]),R(_e,{value:a.direction,"onUpdate:value":v=>a.direction=v,class:"shrink grow-0 nc-sort-dir-select",label:s.$t("labels.operation"),"dropdown-class-name":"sort-dir-dropdown nc-dropdown-sort-dir",onClick:t[1]||(t[1]=w(()=>{},["stop"])),onSelect:v=>e(I)(a,E)},{default:c(()=>[(o(!0),m(D,null,Y(e(De)(u(a.fk_column_id)),(v,ye)=>$((o(),i(ve,{key:ye,value:v.value},{default:c(()=>[_("div",qe,[_("div",Je,h(v.text),1),a.direction===v.value?(o(),i(U(e(B).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):T("",!0)])]),_:2},1032,["value"])),[[V,["c:sort:operation:select"]]])),128))]),_:2},1032,["value","onUpdate:value","label","onSelect"]),$((o(),i(X,{type:"text",size:"small",class:"nc-sort-item-remove-btn !max-w-8",onClick:w(v=>e(M)(a,E),["stop"])},{default:c(()=>[(o(),i(U(e(B).deleteListItem)))]),_:2},1032,["onClick"])),[[V,["c:sort:delete"]]])],64))),128))],2),e(r).length?(o(),i(oe,{key:0,visible:e(d),"onUpdate:visible":t[5]||(t[5]=a=>J(d)?d.value=a:null),trigger:["click"],"overlay-class-name":"nc-toolbar-dropdown"},{overlay:c(()=>[R(te,{"is-parent-open":e(d),onCreated:f},null,8,["is-parent-open"])]),default:c(()=>[e(Re)&&!e(N)?(o(),m(D,{key:0},[e(n).length<e(Z)(e(Ce).SORT_LIMIT)?$((o(),i(X,{key:0,class:"!text-brand-500",type:"text",size:"small",onClick:t[3]||(t[3]=w(a=>d.value=!0,["stop"]))},{default:c(()=>[_("div",Ye,[(o(),i(U(e(B).plus))),F(h(s.$t("activity.addSort")),1)])]),_:1})),[[V,["c:sort:add"]]]):T("",!0)],64)):$((o(),i(X,{key:1,class:"!text-brand-500",type:"text",size:"small",onClick:t[4]||(t[4]=w(a=>d.value=!0,["stop"]))},{default:c(()=>[_("div",et,[(o(),i(U(e(B).plus))),F(h(s.$t("activity.addSort")),1)])]),_:1})),[[V,["c:sort:add"]]])]),_:1},8,["visible"])):T("",!0)],2)):(o(),i(te,{key:0,"is-parent-open":e(b),onCreated:f},null,8,["is-parent-open"]))]}),default:c(()=>{var S;return[_("div",{class:j({"nc-active-btn":(S=e(n))==null?void 0:S.length})},[$((o(),i(O,{class:"nc-sort-menu-btn nc-toolbar-btn",disabled:e(K)},{default:c(()=>{var a;return[_("div",We,[(o(),i(U(e(B).sort),{class:"h-4 w-4 text-inherit"})),e(W)?T("",!0):(o(),m("span",Ze,h(s.$t("activity.sort")),1)),(a=e(n))!=null&&a.length?(o(),m("span",Xe,h(e(n).length),1)):T("",!0)])]}),_:1},8,["disabled"])),[[V,["c:sort"]]])],2)]}),_:1},8,["visible"])}}});const zt=Pe(tt,[["__scopeId","data-v-ba082c45"]]);export{zt as default};
