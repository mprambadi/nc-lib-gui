import{_ as pe}from"./Tooltip.vue.00c0d0fb.js";import{_ as ve}from"./Icon.vue.6d0583a0.js";import{_ as _e}from"./UserIcon.7f59375b.js";import{f as we,$ as ye,bb as c,r as d,bF as be,g as w,aM as ge,H as P,i as he,bR as xe,a6 as ke,o as f,c as k,O as l,aK as A,U as K,V as W,P as j,w as r,a as C,fo as b,S as g,b as I,d as J,t as M,n as Ce,T as Q,cb as X,W as Ie,eR as Me}from"./entry.96205fa0.js";import{M as Se,C as Ve,i as Ee,E as Re,m as Ae,l as je,c as $e,r as Ue,z as ze,j as Ke,t as Be}from"./index.9b87fcff.js";import{u as Le}from"./bases.965a49bb.js";import{u as Y}from"./index.a5de28c1.js";import{M as Oe}from"./close-circle.04e3f837.js";import{_ as De}from"./index.b7feb234.js";import{S as Fe,_ as He}from"./index.b5e393d6.js";import{_ as qe}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.0c5b3837.js";import"./toArray.3561b70e.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.dbc63a5f.js";import"./useState.5a301439.js";import"./CheckOutlined.3b90c20d.js";import"./SearchOutlined.c9794270.js";import"./FormItemContext.b19eb48c.js";const Ne={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Te={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Ge=we({__name:"User",props:{modelValue:{},rowIndex:{},location:{},forceMulti:{type:Boolean}},emits:["update:modelValue"],setup(m,{emit:Z}){const B=Z,{isMobileMode:ee}=ye(),L=c(Se),S=c(Ve),$=c(Ee),O=c(Re,d(!1)),D=c(Ae,d(!1)),ae=c(je,d(!1)),le=Le(),{basesUser:se}=be(le),te=w(()=>L.value.base_id?se.value.get(L.value.base_id)||[]:[]),V=w(()=>D.value||O.value),oe=c($e,d(!1)),ne=c(Ue,d(!1)),ie=w(()=>{var e;return m.forceMulti||((e=S.value.meta)==null?void 0:e.is_multi)}),ce=c(ze,d(void 0)),y=d(),n=d(!1),U=c(Ke,d(!1)),F=d(),{isUIAllowed:re}=ge(),h=w(()=>{var s;const e=[];return e.push(...((s=te.value)==null?void 0:s.map(a=>({id:a.id,email:a.email,display_name:a.display_name,deleted:a.deleted})))||[]),e}),H=w(()=>re("dataEdit")),u=w(()=>(H.value||oe.value)&&V.value),x=w({get:()=>{let e=[];return typeof m.modelValue=="string"?e=m.modelValue.split(",").map(a=>a.trim()).reduce((a,t)=>{const i=h.value.find(v=>v.id===t||v.email===t);return i&&a.push({label:(i==null?void 0:i.display_name)||(i==null?void 0:i.email),value:i.id}),a},[]):e=m.modelValue?(Array.isArray(m.modelValue)?m.modelValue:[m.modelValue]).reduce((s,a)=>{const t=(a==null?void 0:a.display_name)||(a==null?void 0:a.email);return t&&s.push({label:t,value:a.id}),s},[]):[],e},set:e=>{const s=[];e&&e.length&&e.forEach(a=>{const t=h.value.find(i=>i.id===a);t&&s.push(t.id)}),ie.value?B("update:modelValue",e!=null&&e.length?s.join(","):null):(B("update:modelValue",e!=null&&e.length?s[s.length-1]:null),n.value=!1)}});P(n,(e,s)=>{var a,t,i,v,E,R;e||(F.value=""),u.value&&(e?(R=(E=(v=y.value)==null?void 0:v.$el)==null?void 0:E.querySelector("input"))==null||R.focus():(i=(t=(a=y.value)==null?void 0:a.$el)==null?void 0:t.querySelector("input"))==null||i.blur())}),P(V,(e,s)=>{e||(n.value=!1)}),Y(D,e=>{var s;switch(e.key){case"Escape":n.value=!1;break;case"Enter":u.value&&V.value&&!n.value&&(n.value=!0);break;case" ":break;case"ArrowUp":case"ArrowDown":case"ArrowRight":case"ArrowLeft":case"Delete":break;default:if(!u.value){e.preventDefault();break}!(e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)&&((s=e.key)==null?void 0:s.length)===1&&!Me()&&(e.stopPropagation(),n.value=!0);break}}),Y(n,e=>{e.key==="Escape"&&(n.value=!1)});const de=()=>{var e,s,a;F.value=(a=(s=(e=y.value)==null?void 0:e.$el)==null?void 0:s.querySelector(".ant-select-selection-search-input"))==null?void 0:a.value},ue=(e,s)=>{var a,t;((a=e.target)!=null&&a.classList.contains("ant-tag-close-icon")||(t=e.target)!=null&&t.closest(".ant-tag-close-icon"))&&(e.stopPropagation(),s())},p=c(Be,null),fe=()=>{p||(n.value=u.value&&!n.value)},q=()=>{n.value=u.value&&!n.value};he(()=>{p==null||p.on(q)}),xe(()=>{p==null||p.on(q)}),ke(document,"click",e=>{var s;n.value&&y.value&&!y.value.$el.contains(e.target)&&!((s=document.querySelector(".nc-dropdown-user-select-cell.active"))!=null&&s.contains(e.target))&&(O.value=!1,n.value=!1)},!0);const me=(e,s)=>{const a=h.value.find(i=>i.id===s.value),t=(a==null?void 0:a.display_name)||(a==null?void 0:a.email);if(t)return t.toLowerCase().includes(e.toLowerCase())};return(e,s)=>{const a=pe,t=De,i=ve,v=_e,E=Fe,R=He;return f(),k("div",{class:g(["nc-user-select h-full w-full flex items-center",{"read-only":l($),"px-2":l(ae)}]),onClick:fe},[l(V)?(f(),j(R,{key:1,ref_key:"aselect",ref:y,value:l(x),"onUpdate:value":s[1]||(s[1]=o=>Ie(x)?x.value=o:null),mode:"multiple",class:g(["w-full overflow-hidden",{"caret-transparent":!l(H)}]),placeholder:l(ne)?e.$t("labels.optional"):"",bordered:!1,"clear-icon":"","show-search":!l(ee),"show-arrow":l(u)&&!l($),open:l(n)&&l(u),disabled:l($)||!l(u),"dropdown-class-name":`nc-dropdown-user-select-cell !min-w-200px ${l(n)?"active":""}`,"filter-option":me,onSearch:de,onKeydown:s[2]||(s[2]=X(()=>{},["stop"]))},{suffixIcon:r(()=>[I(i,{icon:"arrowDown",class:"text-gray-700 nc-select-expand-btn"})]),tagRender:r(({label:o,value:_,onClose:N})=>{var T,G;return[l(h).find(z=>z.id===_)?(f(),j(t,{key:0,class:"rounded-tag nc-selected-option",style:{display:"flex",alignItems:"center"},color:"'#ccc'",closable:l(u)&&((((T=l(x))==null?void 0:T.length)??0)>1||!((G=l(S))!=null&&G.rqd)),"close-icon":l(Ce)(l(Oe),{class:["ms-close-icon"]}),onClick:z=>ue(z,N),onClose:N},{default:r(()=>[C("span",{style:A({color:l(b).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":l(b).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:g({"text-sm":l(U)})},M(o),7)]),_:2},1032,["closable","close-icon","onClick","onClose"])):Q("",!0)]}),default:r(()=>[(f(!0),k(K,null,W(l(h),o=>(f(),k(K,{key:o.id||o.email},[o.deleted?Q("",!0):(f(),j(E,{key:0,value:o.id,"data-testid":`select-option-${l(S).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:g(`nc-select-option-${l(S).title}-${o.email}`),onClick:s[0]||(s[0]=X(()=>{},["stop"]))},{default:r(()=>[I(t,{class:"rounded-tag max-w-full !pl-0",color:"'#ccc'"},{default:r(()=>[C("span",{style:A({color:l(b).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":l(b).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:g(["flex items-center gap-2",{"text-sm":l(U)}])},[I(v,{size:"medium",email:o.email},null,8,["email"]),I(a,{class:"truncate max-w-full","show-on-truncate-only":""},{title:r(()=>{var _;return[J(M((_=o.display_name)!=null&&_.length?o.display_name:o.email),1)]}),default:r(()=>{var _;return[C("span",Te,M((_=o.display_name)!=null&&_.length?o.display_name:o.email),1)]}),_:2},1024)],6)]),_:2},1024)]),_:2},1032,["value","data-testid","class"]))],64))),128))]),_:1},8,["value","placeholder","show-search","show-arrow","open","disabled","class","dropdown-class-name"])):(f(),k("div",{key:0,class:"flex flex-wrap",style:A({display:"-webkit-box","max-width":"100%","-webkit-line-clamp":l(ce)||1,"-webkit-box-orient":"vertical",overflow:"hidden"})},[(f(!0),k(K,null,W(l(x),o=>(f(),j(t,{key:o.value,class:"rounded-tag max-w-full",color:"'#ccc'"},{default:r(()=>[C("span",{style:A({color:l(b).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":l(b).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:g({"text-sm":l(U)})},[I(a,{class:"truncate max-w-full","show-on-truncate-only":""},{title:r(()=>[J(M(o.label),1)]),default:r(()=>[C("span",Ne,M(o.label),1)]),_:2},1024)],6)]),_:2},1024))),128))],4))],2)}}});const pa=qe(Ge,[["__scopeId","data-v-197fc682"]]);export{pa as default};
