import{_ as I}from"./View.08f59341.js";import{f as V,r as v,bF as W,$ as j,g as B,i as L,c9 as M,o as h,c as b,a as u,t as k,au as $,b as _,O as s,W as P,T as S,X as i,Y as l,C as F}from"./entry.96205fa0.js";import{a as O,e as X}from"./bases.965a49bb.js";import{u as Y}from"./useDashboard.0f55d174.js";import{_ as q}from"./index.4a1cb0c9.js";import"./Tooltip.vue.00c0d0fb.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./useSmartsheetStore.7d51347e.js";import"./views.2c163cf7.js";import"./useSharedView.9e320acb.js";import"./index.9b87fcff.js";import"./index.e034edbd.js";import"./index.5b05c4cf.js";import"./Password.803cc3dc.js";import"./Input.3f1aaf0c.js";import"./antInputDirective.8ac36ea7.js";import"./FormItemContext.b19eb48c.js";import"./index.b5e393d6.js";import"./toArray.3561b70e.js";import"./isMobile.e2e89480.js";import"./useMemo.dbc63a5f.js";import"./useState.5a301439.js";import"./CheckOutlined.3b90c20d.js";import"./SearchOutlined.c9794270.js";import"./ProjectIcon.384805e6.js";import"./Icon.vue.6d0583a0.js";import"./Button.vue.02ce6d5b.js";import"./index.9e8f59f4.js";import"./debounce.1d5af9bf.js";import"./toNumber.ed208f2f.js";import"./isSymbol.d46b4957.js";import"./useCopy.00050b95.js";import"./share.e4643132.js";import"./v3-infinite-loading.e5e5dc2d.js";import"./index.b32e91d7.js";import"./useBreakpoint.2e009418.js";import"./responsiveObserve.358bcfe9.js";import"./useSize.c98e621d.js";import"./eagerComputed.5bad0f6f.js";import"./index.55d21d38.js";import"./index.0c5b3837.js";const z={class:"flex flex-col py-2 px-3 gap-2 w-full","data-testid":"nc-share-base-sub-modal"},H={class:"flex flex-col w-full p-3 border-1 border-gray-100 rounded-md"},J={class:"flex flex-row w-full justify-between"},K={class:"text-gray-900 font-medium"},Q={key:0,class:"flex flex-col w-full mt-3 border-t-1 pt-3 border-gray-100"},Z={key:0,class:"flex flex-row justify-between mt-3 bg-gray-50 px-3 py-2 rounded-md"},ee={class:"text-black"},Fe=V({__name:"ShareBase",setup(ae){const{dashboardUrl:U}=Y(),{$api:d,$e:g}=F(),a=v(null),{base:r}=W(O()),{getBaseUrl:C,appInfo:w}=j(),R=X(),p=B(()=>{var o;if(!a.value||!a.value.uuid)return"";const e=C(R.activeWorkspaceId);let t=U.value;return e&&(t=`${e}${(o=w.value)==null?void 0:o.dashboardPath}`),encodeURI(`${t}#/base/${a.value.uuid}`)}),D=async()=>{try{if(!r.value.id)return;const e=await d.base.sharedBaseGet(r.value.id);a.value={uuid:e.uuid,url:e.url,role:e.roles}}catch(e){i.error(await l(e))}},m=async(e="viewer")=>{try{if(!r.value.id)return;const t=await d.base.sharedBaseUpdate(r.value.id,{roles:e});a.value=t??{},a.value.role=e,r.value.uuid=t.uuid}catch(t){i.error(await l(t))}g("a:shared-base:enable",{role:e})},T=async()=>{try{if(!r.value.id)return;await d.base.sharedBaseDisable(r.value.id),a.value=null,r.value.uuid=void 0}catch(e){i.error(await l(e))}g("a:shared-base:disable")};L(()=>{a.value||D()});const f=B(()=>{var e;return!!((e=a.value)!=null&&e.uuid)}),n=v(!1),c=v(!1),N=async()=>{if(!n.value){n.value=!0;try{f.value?await T():await m()}catch(e){i.error(await l(e))}finally{n.value=!1}}},A=async()=>{if(a.value&&!c.value){c.value=!0;try{a.value.role==="viewer"?await m("editor"):await m("viewer")}catch(e){i.error(await l(e))}finally{c.value=!1}}};return(e,t)=>{var x;const o=q,E=I,y=M("e");return h(),b("div",z,[u("div",H,[u("div",J,[u("div",K,k(e.$t("activity.enablePublicAccess")),1),$(_(o,{checked:s(f),loading:s(n),class:"ml-2",onClick:N},null,8,["checked","loading"]),[[y,["c:share:base:enable:toggle"]]])]),s(f)?(h(),b("div",Q,[_(E,{url:s(p),"onUpdate:url":t[0]||(t[0]=G=>P(p)?p.value=G:null)},null,8,["url"]),s(w).ee?S("",!0):(h(),b("div",Z,[u("div",ee,k(e.$t("activity.editingAccess")),1),$(_(o,{loading:s(c),checked:((x=s(a))==null?void 0:x.role)==="editor",class:"ml-2",onClick:A},null,8,["loading","checked"]),[[y,["c:share:base:role:toggle"]]])]))])):S("",!0)])])}}});export{Fe as default};
