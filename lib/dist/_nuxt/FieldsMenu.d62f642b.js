import xe from"./VirtualCellIcon.79739fcf.js";import{_ as ke}from"./CellIcon.0a028b40.js";import{_ as Ie}from"./Icon.vue.6d0583a0.js";import{_ as Ce}from"./Tooltip.vue.00c0d0fb.js";import{_ as Ae}from"./Switch.vue.6465418b.js";import{_ as Le}from"./Button.vue.02ce6d5b.js";import{_ as Ne}from"./Dropdown.vue.93f98e1e.js";import{A as Fe,h as $e,R as Ve,F as Se,f as Re,b as Be}from"./index.9b87fcff.js";import{f as De,bb as I,r as O,$ as Ee,go as re,H as Ue,g as C,eN as d,cG as Ge,c9 as Me,o as i,P as w,w as u,a as p,cb as B,O as t,c as _,b as g,W as T,T as y,t as m,dy as je,Q as Y,R as de,au as K,d as h,S as ce,U as ue,n as Oe,eW as Te,a8 as Ye,p as Ke,e as Pe,C as ze}from"./entry.96205fa0.js";import{u as He}from"./index.e38f94a1.js";import{a as Qe}from"./useSmartsheetStore.7d51347e.js";import{f as We}from"./bases.965a49bb.js";import{u as qe}from"./useViewColumns.8927231f.js";import{D as Je}from"./vuedraggable.umd.5a03c14e.js";import"./index.1431a68b.js";import{I as Xe}from"./Input.3f1aaf0c.js";import{_ as Ze}from"./index.b5e393d6.js";import{_ as et}from"./_plugin-vue_export-helper.c27b6911.js";import"./virtualCell.9142cfee.js";import"./cell.810c4fd3.js";import"./index.4a1cb0c9.js";import"./FormItemContext.b19eb48c.js";import"./index.9e8f59f4.js";import"./debounce.1d5af9bf.js";import"./toNumber.ed208f2f.js";import"./isSymbol.d46b4957.js";import"./index.6c1d17b6.js";import"./Dropdown.1dedd322.js";import"./RightOutlined.3ce786f5.js";import"./views.2c163cf7.js";import"./useSharedView.9e320acb.js";import"./index.e034edbd.js";import"./index.0c5b3837.js";import"./SearchOutlined.c9794270.js";import"./isPlainObject.631eb8fb.js";import"./_getPrototype.459a70cf.js";import"./TextArea.b81a19ed.js";import"./antInputDirective.8ac36ea7.js";import"./Password.803cc3dc.js";import"./toArray.3561b70e.js";import"./isMobile.e2e89480.js";import"./useMemo.dbc63a5f.js";import"./useState.5a301439.js";import"./CheckOutlined.3b90c20d.js";const tt=""+new URL("search.5f0c9bbf.svg",import.meta.url).href,P=D=>(Ke("data-v-9ef4e85c"),D=D(),Pe(),D),ot={class:"flex items-center gap-2"},st={key:2,class:"text-capitalize text-sm font-medium"},at={key:3,class:"bg-brand-50 text-brand-500 py-1 px-2 text-md rounded-md"},lt={key:0,class:"flex flex-col gap-y-2 pr-4 mb-6"},it=P(()=>p("div",{class:"flex text-sm select-none"},"Select cover image field",-1)),nt=P(()=>p("img",{src:tt,class:"h-3.5 w-3.5 mr-1"},null,-1)),rt={key:1,class:"pr-4"},dt=P(()=>p("div",{class:"pt-0.25 w-full bg-gray-50"},null,-1)),ct=[dt],ut={class:"flex flex-col my-1.5 nc-scrollbar-md max-h-[47.5vh] pr-3"},mt={class:"nc-fields-list"},pt={key:0,class:"px-0.5 py-2 text-gray-500"},ft=["data-testid"],vt=["onClick"],_t=P(()=>p("div",{class:"flex-1"},null,-1)),wt=["data-testid"],yt={class:"flex pr-4 mt-1 gap-2"},gt=De({__name:"FieldsMenu",setup(D){const s=I(Fe,O()),z=I($e,void 0),H=I(Ve,void 0),oe=I(Se),{isMobileMode:me}=Ee(),pe=I(Re,O(!1)),se=I(Be,O(!1)),{$api:ae,$e:fe}=ze(),{showSystemFields:E,sortedAndFilteredFields:ve,fields:n,filteredFieldList:f,filterQuery:v,showAll:Q,hideAll:W,saveOrUpdate:_e,metaColumnById:U,loadViewColumns:q,toggleFieldVisibility:we}=qe(),{eventBus:ye}=Qe(),{addUndo:A,defineViewScope:L}=We();ye.on(e=>{(e===re.FIELD_RELOAD||e===re.MAPPED_BY_COLUMN_CHANGE)&&q()}),Ue(ve,e=>{oe&&(oe.value=e||[])},{immediate:!0});const J=C(()=>{var e,o;return(o=(e=f.value)==null?void 0:e.filter(a=>!a.show))==null?void 0:o.length}),G=C(()=>{var o,a,r;if(((o=s.value)==null?void 0:o.type)!==d.GRID)return null;const e=(a=Object.values(U.value))==null?void 0:a.find(c=>c==null?void 0:c.pv);return(r=f.value)==null?void 0:r.find(c=>c.fk_column_id===(e==null?void 0:e.id))}),X=async(e,o=!1)=>{n.value&&(o||A({undo:{fn:()=>{if(!n.value)return;const a=n.value[e.moved.newIndex];n.value[e.moved.newIndex]=n.value[e.moved.oldIndex],n.value[e.moved.oldIndex]=a,X({moved:{newIndex:e.moved.oldIndex,oldIndex:e.moved.newIndex}},!0)},args:[]},redo:{fn:()=>{if(!n.value)return;const a=n.value[e.moved.oldIndex];n.value[e.moved.oldIndex]=n.value[e.moved.newIndex],n.value[e.moved.newIndex]=a,X(e,!0)},args:[]},scope:L({view:s.value})}),!(n.value.length<2)&&(await Promise.all(n.value.map(async(a,r)=>{a.order!==r+1&&(a.order=r+1,await _e(a,r,!0))})),await q(),H==null||H.trigger(),fe("a:fields:reorder")))},le=C(()=>{var o;const e=((o=n.value)==null?void 0:o.filter(a=>a.fk_column_id&&U.value[a.fk_column_id].uidt===Ge.Attachment).map(a=>({value:a.fk_column_id,label:a.title})))??[];return[{value:null,label:"No Image"},...e]}),Z=async e=>{var o,a,r,c,b,x,F,$;(((o=s.value)==null?void 0:o.type)===d.GALLERY||((a=s.value)==null?void 0:a.type)===d.KANBAN)&&((r=s.value)!=null&&r.id)&&((c=s.value)!=null&&c.view)&&(((b=s.value)==null?void 0:b.type)===d.GALLERY?(await ae.dbView.galleryUpdate((x=s.value)==null?void 0:x.id,{fk_cover_image_col_id:e}),s.value.view.fk_cover_image_col_id=e):((F=s.value)==null?void 0:F.type)===d.KANBAN&&(await ae.dbView.kanbanUpdate(($=s.value)==null?void 0:$.id,{fk_cover_image_col_id:e}),s.value.view.fk_cover_image_col_id=e),z==null||z.trigger())},N=C({get:()=>{var o,a,r,c,b;const e=(((o=s.value)==null?void 0:o.type)===d.GALLERY||((a=s.value)==null?void 0:a.type)===d.KANBAN)&&((r=s.value)!=null&&r.view)?((c=s.value)==null?void 0:c.view).fk_cover_image_col_id:void 0;return(b=le.value)!=null&&b.find(x=>x.value===e)?e:null},set:async e=>{e!==N.value&&(A({undo:{fn:await Z,args:[N.value]},redo:{fn:await Z,args:[e]},scope:L({view:s.value})}),await Z(e))}}),ge=()=>{A({undo:{fn:async()=>{await W()},args:[]},redo:{fn:async()=>{await Q()},args:[]},scope:L({view:s.value})}),Q()},he=()=>{A({undo:{fn:async()=>{await Q()},args:[]},redo:{fn:async()=>{await W()},args:[]},scope:L({view:s.value})}),W()},ee=C({get:()=>{var e;return(e=f.value)==null?void 0:e.every(o=>o.show)},set:async e=>{e?await ge():await he()}}),ie=e=>Oe(Te(e)?xe:ke,{columnMeta:e}),M=O(!1),te=C({get:()=>E.value,set:e=>{A({undo:{fn:o=>{E.value=!o},args:[e]},redo:{fn:o=>{E.value=o},args:[e]},scope:L({view:s.value})}),E.value=e}});return He(M),(e,o)=>{const a=Ie,r=Ye,c=Ze,b=Xe,x=Ce,F=Ae,$=Le,be=Ne,j=Me("e");return i(),w(be,{visible:t(M),"onUpdate:visible":o[11]||(o[11]=k=>T(M)?M.value=k:null),trigger:["click"],"overlay-class-name":"nc-dropdown-fields-menu nc-toolbar-dropdown",class:"!xs:hidden"},{overlay:u(()=>{var k,V,S,R;return[p("div",{class:"p-4 pr-0 bg-white w-90 rounded-2xl nc-table-toolbar-menu","data-testid":"nc-fields-menu",onClick:o[10]||(o[10]=B(()=>{},["stop"]))},[!t(v)&&!t(se)&&(((k=t(s))==null?void 0:k.type)===t(d).GALLERY||((V=t(s))==null?void 0:V.type)===t(d).KANBAN)?(i(),_("div",lt,[it,g(c,{value:t(N),"onUpdate:value":o[0]||(o[0]=l=>T(N)?N.value=l:null),class:"w-full",options:t(le),"dropdown-class-name":"nc-dropdown-cover-image",onClick:o[1]||(o[1]=B(()=>{},["stop"]))},{suffixIcon:u(()=>[g(a,{icon:"arrowDown",class:"text-gray-700"})]),_:1},8,["value","options"])])):y("",!0),p("div",{class:"pr-4",onClick:o[3]||(o[3]=B(()=>{},["stop"]))},[g(b,{value:t(v),"onUpdate:value":o[2]||(o[2]=l=>T(v)?v.value=l:null),placeholder:e.$t("placeholder.searchFields"),class:"!rounded-lg"},{prefix:u(()=>[nt]),_:1},8,["value","placeholder"])]),t(v)?y("",!0):(i(),_("div",rt,ct)),p("div",ut,[p("div",mt,[(S=t(n))!=null&&S.filter(l=>l.title.toLowerCase().includes(t(v).toLowerCase())).length?y("",!0):(i(),_("div",pt,m(e.$t("title.noFieldsFound")),1)),g(t(Je),{modelValue:t(n),"onUpdate:modelValue":o[6]||(o[6]=l=>T(n)?n.value=l:null),"item-key":"id",onChange:o[7]||(o[7]=l=>X(l))},je({item:u(({element:l})=>[t(f).filter(ne=>ne!==t(G)&&ne.title.toLowerCase().includes(t(v).toLowerCase())).includes(l)?(i(),_("div",{key:l.id,class:"px-2 py-2 flex flex-row items-center first:border-t-1 border-b-1 border-x-1 first:rounded-t-lg last:rounded-b-lg border-gray-200","data-testid":`nc-fields-menu-${l.title}`,onClick:o[4]||(o[4]=B(()=>{},["stop"]))},[(i(),w(Y(t(de).drag),{class:"cursor-move !h-3.75 text-gray-600 mr-1"})),K((i(),_("div",{class:"flex flex-row items-center w-full truncate cursor-pointer ml-1",onClick:()=>{l.show=!l.show,t(we)(l.show,l)}},[(i(),w(Y(ie(t(U)[l.fk_column_id])))),g(x,{"show-on-truncate-only":"",class:"flex-1 px-1 truncate"},{title:u(()=>[h(m(l.title),1)]),default:u(()=>[h(m(l.title),1)]),_:2},1024),K(g(F,{checked:l.show,disabled:l.isViewEssentialField},null,8,["checked","disabled"]),[[j,["a:fields:show-hide"]]])],8,vt)),[[j,["a:fields:show-hide"]]]),_t],8,ft)):y("",!0)]),_:2},[((R=t(s))==null?void 0:R.type)===t(d).GRID?{name:"header",fn:u(()=>[t(G)&&t(f)[0].title.toLowerCase().includes(t(v).toLowerCase())?(i(),_("div",{key:`pv-${t(G).id}`,class:ce(["pl-7.4 pr-2 py-2 flex flex-row items-center border-1 border-gray-200",{"rounded-t-lg":t(f).length>1,"rounded-lg":t(f).length===1}]),"data-testid":`nc-fields-menu-${t(G).title}`,onClick:o[5]||(o[5]=B(()=>{},["stop"]))},[(i(),w(Y(ie(t(U)[t(f)[0].fk_column_id])))),g(x,{"show-on-truncate-only":"",class:"px-1 flex-1 truncate"},{title:u(()=>[h(m(t(f)[0].title),1)]),default:u(()=>[h(m(t(f)[0].title),1)]),_:1}),K(g(F,{checked:!0,disabled:!0},null,512),[[j,["a:fields:show-hide"]]])],10,wt)):y("",!0)]),key:"0"}:void 0]),1032,["modelValue"])])]),p("div",yt,[t(v)?y("",!0):(i(),w($,{key:0,type:"ghost",size:"sm",class:"nc-fields-show-all-fields !text-gray-500 !w-1/2",onClick:o[8]||(o[8]=l=>ee.value=!t(ee))},{default:u(()=>[h(m(t(ee)?e.$t("title.hideAll"):e.$t("general.showAll"))+" "+m(e.$t("objects.fields").toLowerCase()),1)]),_:1})),!t(se)&&!t(v)?(i(),w($,{key:1,type:"ghost",size:"sm",class:"nc-fields-show-system-fields !text-gray-500 !w-1/2",onClick:o[9]||(o[9]=l=>te.value=!t(te))},{default:u(()=>[h(m(t(te)?e.$t("title.hideSystemFields"):e.$t("activity.showSystemFields")),1)]),_:1})):y("",!0)])])]}),default:u(()=>[p("div",{class:ce({"nc-active-btn":t(J)})},[K((i(),w(r,{class:"nc-fields-menu-btn nc-toolbar-btn",disabled:t(pe)},{default:u(()=>{var k,V,S,R;return[p("div",ot,[((k=t(s))==null?void 0:k.type)===t(d).KANBAN||((V=t(s))==null?void 0:V.type)===t(d).GALLERY?(i(),w(a,{key:0,icon:"creditCard",class:"h-4 w-4"})):(i(),w(Y(t(de).fields),{key:1,class:"h-4 w-4"})),t(me)?y("",!0):(i(),_("span",st,[((S=t(s))==null?void 0:S.type)===t(d).KANBAN||((R=t(s))==null?void 0:R.type)===t(d).GALLERY?(i(),_(ue,{key:0},[h(m(e.$t("title.editCards")),1)],64)):(i(),_(ue,{key:1},[h(m(e.$t("objects.fields")),1)],64))])),t(J)?(i(),_("span",at,m(t(J)),1)):y("",!0)])]}),_:1},8,["disabled"])),[[j,["c:fields"]]])],2)]),_:1},8,["visible"])}}});const uo=et(gt,[["__scopeId","data-v-9ef4e85c"]]);export{uo as default};
