var kn=Object.defineProperty;var Rn=(d,w,r)=>w in d?kn(d,w,{enumerable:!0,configurable:!0,writable:!0,value:r}):d[w]=r;var bo=(d,w,r)=>(Rn(d,typeof w!="symbol"?w+"":w,r),r);import{f as Ft,r as b,ba as je,o as n,c as R,a9 as Cn,O as e,bA as Vt,cG as x,X as ye,cp as Fe,M as po,$ as Sa,N as xo,g as pe,a6 as mt,gl as ut,bz as io,gh as ma,eR as uo,cP as Sn,eX as Dn,Y as Mn,gm as $n,eW as st,cZ as Xt,gn as Da,go as So,a as h,bF as zt,db as Ln,gp as Dt,fZ as Ma,a5 as Mo,aF as ko,bb as Me,c8 as En,gq as An,aM as Vn,cg as zn,gg as wa,fU as va,H as Qt,i as $a,l as $o,ad as ro,c9 as ga,aK as Be,T as W,S as ve,au as we,cE as Ut,b as ee,w as N,P as C,Q as St,R as Lt,d as De,t as U,eZ as Do,U as Re,V as it,W as wt,cb as Et,dy as Nn,fV as ha,f9 as Fn,fy as Pn,eN as Bn,a0 as tt,a1 as ot,a7 as lo,f_ as co,cc as In,p as La,e as Ea,C as On,fo as so,gr as jt,cx as _a,u as Gn,cn as Hn,d4 as ya}from"./entry.5958c07b.js";import{_ as Tn,a as Wn}from"./index.caa4cb22.js";import{t as Yn,s as Kn,M as Lo,A as Eo,F as Aa,i as Va,f as Un,b as jn,u as za,R as fo,O as qn,v as Na,J as Xn,w as Qn,x as Jn,c as Zn,y as er,q as tr,z as or,B as ar}from"./index.9b87fcff.js";import{e as At,a as nr}from"./dataUtils.3f874ca1.js";import{a as Ao}from"./useSmartsheetStore.f1a70558.js";import{a as rr,u as lr}from"./useViewData.1858eb56.js";import{u as sr}from"./useViewGroupBy.a2eec87c.js";import{a as ir,_ as ur}from"./Button.vue.c3ca0e8f.js";import{_ as cr}from"./Icon.vue.129448d5.js";import{_ as dr,a as pr}from"./Menu.vue.6c65c050.js";import{u as fr,_ as mr}from"./EditOrAddProvider.vue.31035ffc.js";import{_ as wr}from"./Divider.7b1fba82.js";import{_ as vr}from"./Dropdown.vue.0d2ed10f.js";import{p as Nt,b as Fa,a as gr,f as Pa}from"./bases.e6c8e3c4.js";import{u as hr}from"./config.c8203633.js";import{c as ba,d as xa,e as ka}from"./virtualCell.427fa223.js";import{i as Ro}from"./index.025c8e21.js";import{u as _r}from"./useCopy.0241e728.js";import{u as Ba}from"./useViewColumns.f203dc14.js";import{u as mo}from"./views.4281cbf1.js";import{_ as yr}from"./chevron-right.ec8c7e51.js";import{u as br}from"./sidebar.f5d81718.js";import{S as xr}from"./index.36af7517.js";import{C as kr}from"./index.5e1434a7.js";import{D as Rr,_ as Cr}from"./index.dc13a4d6.js";import{S as Sr}from"./index.55641318.js";import{_ as Ia}from"./_plugin-vue_export-helper.c27b6911.js";import{_ as Dr,C as Mr}from"./index.0c7dde5a.js";import{_ as $r}from"./index.27219acd.js";import"./DivDataCell.7c09732c.js";import"./Tooltip.vue.971897f4.js";import"./UserIcon.74e37fbe.js";import"./index.e61e381a.js";import"./useKanbanViewStore.9f7f1dc5.js";import"./deepCompare.d32ec333.js";import"./useSharedView.e8f68616.js";import"./useSmartsheetRowStore.5b92cc1b.js";import"./iconify.e2b5aaa4.js";import"./index.ae235b22.js";import"./Input.dca3a2bc.js";import"./antInputDirective.8ac36ea7.js";import"./FormItemContext.ddc65fa5.js";import"./SearchOutlined.a517903c.js";import"./isPlainObject.ccda79fe.js";import"./_getPrototype.c1f3bae2.js";import"./TextArea.9074ff05.js";import"./Password.f52125e7.js";import"./Modal.vue.0f13e4cb.js";import"./DeleteModal.vue.0320a9db.js";import"./Modal.vue.ee5af191.js";import"./useDashboard.7eae7d45.js";import"./index.c35df397.js";import"./Input.8209df88.js";import"./Element.a1e4f356.js";import"./validation.2de04583.js";import"./index.0feaca99.js";import"./index.b06c8b67.js";import"./FormItem.0bbf90a3.js";import"./identity.34c7640e.js";import"./isSymbol.114fe557.js";import"./Col.a97e3e76.js";import"./responsiveObserve.0baefba6.js";import"./toArray.fd74ce6f.js";import"./toNumber.e09cd85a.js";import"./useSize.fad35fe8.js";import"./_flatRest.39582a58.js";import"./debounce.7c24f171.js";import"./vuedraggable.umd.00f5fccc.js";import"./v3-infinite-loading.660bd977.js";import"./cell.165313cd.js";import"./index.5c6e4286.js";import"./isMobile.e2e89480.js";import"./useMemo.1dd071d8.js";import"./useState.b891c8bb.js";import"./CheckOutlined.1fe5f230.js";import"./index.07078df6.js";import"./Image.c63a7a56.js";import"./Checkbox.2e7b0035.js";import"./createForOfIteratorHelper.33de41ba.js";import"./Dropdown.041b2468.js";import"./RightOutlined.7161c742.js";const Lr=Ft({__name:"TableDataCell",setup(d,{expose:w}){const r=b(),V=Vt();return je(Yn,V),je(Kn,r),w({el:r}),(s,X)=>(n(),R("td",{ref_key:"el",ref:r,class:"select-none",onClick:X[0]||(X[0]=Y=>e(V).trigger(Y))},[Cn(s.$slots,"default")],512))}});class Ra{constructor(w=null,r=null){bo(this,"_start");bo(this,"_end");this._start=w,this._end=r??this._start}isEmpty(){return this._start==null||this._end==null}isSingleCell(){var w,r,V,s;return!this.isEmpty()&&((w=this._start)==null?void 0:w.col)===((r=this._end)==null?void 0:r.col)&&((V=this._start)==null?void 0:V.row)===((s=this._end)==null?void 0:s.row)}isSingleRow(){var w,r;return!this.isEmpty()&&((w=this._start)==null?void 0:w.row)===((r=this._end)==null?void 0:r.row)}isCellInRange(w){return!this.isEmpty()&&w.row>=this.start.row&&w.row<=this.end.row&&w.col>=this.start.col&&w.col<=this.end.col}isRowInRange(w){return!this.isEmpty()&&w>=this.start.row&&w<=this.end.row}isColInRange(w){return!this.isEmpty()&&w>=this.start.col&&w<=this.end.col}get start(){var w,r,V,s;return{row:Math.min(((w=this._start)==null?void 0:w.row)??NaN,((r=this._end)==null?void 0:r.row)??NaN),col:Math.min(((V=this._start)==null?void 0:V.col)??NaN,((s=this._end)==null?void 0:s.col)??NaN)}}get end(){var w,r,V,s;return{row:Math.max(((w=this._start)==null?void 0:w.row)??NaN,((r=this._end)==null?void 0:r.row)??NaN),col:Math.max(((V=this._start)==null?void 0:V.col)??NaN,((s=this._end)==null?void 0:s.col)??NaN)}}startRange(w){this._start=w,this._end=w}endRange(w){this._end=w}clear(){this._start=null,this._end=null}}function qt(d,w=!1,r=!1){var D;const{to:V,value:s,column:X}=d,Y=w?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ";if(s==="")return null;switch(V){case x.SingleLineText:case x.LongText:return s.match(/^".*"$/)?s.slice(1,-1):s;case x.Number:{const _=Number(s);if(isNaN(_)){if(r)return null;throw new TypeError(`Cannot convert '${s}' to number`)}return _}case x.Rating:{const _=Number(s??0);if(isNaN(_)){if(r)return null;throw new TypeError(`Cannot convert '${s}' to rating`)}return _}case x.Checkbox:if(typeof s=="boolean")return s;if(typeof s=="string"){const _=s.trim().toLowerCase();if(_==="true"||_==="1")return!0;if(_==="false"||_==="0"||_==="")return!1}return null;case x.Date:{const _=Fe(s);if(!_.isValid()){if(r)return null;throw new Error("Not a valid date")}return _.format("YYYY-MM-DD")}case x.DateTime:{const _=Fe(s);if(!_.isValid()){if(r)return null;throw new Error("Not a valid datetime value")}return _.utc().format("YYYY-MM-DD HH:mm:ssZ")}case x.Time:{let _=Fe(s);if(_.isValid()||(_=Fe(s,"HH:mm:ss")),_.isValid()||(_=Fe(`1999-01-01 ${s}`)),!_.isValid()){if(r)return null;throw new Error("Not a valid time value")}return _.format(Y)}case x.Year:{if(/^\d+$/.test(s))return+s;const _=Fe(s);if(_.isValid())return _.format("YYYY");if(r)return null;throw new Error("Not a valid year value")}case x.Attachment:{let _;try{_=Nt(s),_=Array.isArray(_)?_:[_]}catch{if(r)return null;throw new Error("Invalid attachment data")}if(_.some(y=>y&&!(y.url||y.data||y.path)))return null;const E={...{...d.appInfo.ee&&{maxNumberOfAttachments:Math.max(1,+d.appInfo.ncMaxAttachmentsAllowed||50)||50,maxAttachmentSize:Math.max(1,+d.appInfo.ncMaxAttachmentsAllowed||20)||20,supportedAttachmentMimeTypes:["*"]}},...Nt(X==null?void 0:X.meta)},K=[];for(const y of _){if(d.appInfo.ee){if(_.length>E.maxNumberOfAttachments){ye.error(`You can only upload at most ${E.maxNumberOfAttachments} file${E.maxNumberOfAttachments>1?"s":""} to this cell.`);return}if(y.size>E.maxAttachmentSize*1024*1024){ye.error(`The size of ${y.name} exceeds the maximum file size ${E.maxAttachmentSize} MB.`);continue}if(!E.supportedAttachmentMimeTypes.includes("*")&&!E.supportedAttachmentMimeTypes.includes(y.type)&&!E.supportedAttachmentMimeTypes.includes(y.type.split("/")[0])){ye.error(`${y.name} has the mime type ${y.type} which is not allowed in this column.`);continue}}K.push(y)}return JSON.stringify(K)}case x.SingleSelect:case x.MultiSelect:{if(s==="")return null;const _=(((D=X.colOptions)==null?void 0:D.options)||[]).map(K=>K.title),E=s.split(",").filter(K=>_.includes(K));return E.length===0?null:E.join(",")}case x.User:case x.CreatedBy:case x.LastModifiedBy:{let _;try{try{_=typeof s=="string"?JSON.parse(s):s}catch{_=s}}catch{if(r)return null;throw new Error("Invalid user data")}return _||s}case x.LinkToAnotherRecord:case x.Lookup:case x.Rollup:case x.Formula:case x.QrCode:{if(r)return;throw new Error(`Unsupported conversion for ${V}`)}default:return s}}const Co=0;function Er(d,w,r,V,s,X,Y,D,_,f,E,K,y,de){const Z=b(d),{t:xe}=po(),{copy:Ie}=_r(),{getMeta:G}=Fa(),{appInfo:j}=Sa(),{isMysql:te,isPg:B}=gr(),A=b(V),P=b(!1),m=b(!1),a=xo(new Ra),M=xo(new Ra),l=xo({row:null,col:null}),oe=pe(()=>{var i;return(i=e(w))==null?void 0:i.length}),$e=pe(()=>!(l.row===null||l.col===null||isNaN(l.row)||isNaN(l.col)));function ie(i,u){l.row===i&&l.col===u||(A.value=!1,l.row=i,l.col=u)}function Le(i){const u=F(i),p=ae(i);return`${u} ${p}`}function F(i){var u;return((u=Nt(i==null?void 0:i.meta))==null?void 0:u.date_format)??Da[0]}function ae(i){var u;return((u=Nt(i==null?void 0:i.meta))==null?void 0:u.time_format)??So[0]}const Ee=(i,u)=>{var ue;let p=u.title&&i.row[u.title]||"";if(u.uidt===x.Checkbox&&(p=!!p),[x.User,x.CreatedBy,x.LastModifiedBy].includes(u.uidt)&&p&&(p=Array.isArray(p)?p:[p].map(S=>S.email).join(", ")),typeof p=="object"?p=JSON.stringify(p):p=p.toString(),u.uidt===x.Formula&&(p=p.replace(/\b(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}[+-]\d{2}:\d{2})\b/g,S=>Fe(S).utc().local().format("YYYY-MM-DD HH:mm"))),[x.DateTime,x.CreatedTime,x.LastModifiedTime].includes(u.uidt)){p=p.replace(/["']/g,"");const S=te(u.source_id);let k=Fe(p);if(k.isValid()||(k=Fe(p,S?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")),p=k.format(Le(u)),!Fe(p).isValid())return""}if(u.uidt===x.Date){const S=(ue=u.meta)==null?void 0:ue.date_format;S&&$n(S)?p=Fe(p,S).format(S):p=Fe(p,"YYYY-MM-DD").format(S)}if(u.uidt===x.Time){p=p.replace(/["']/g,"");const S=te(u.source_id),k=B(u.source_id);let H=Fe(p);if(H.isValid()||(H=Fe(p,S?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")),H.isValid()||(H=S||k?Fe(p,"HH:mm:ss"):Fe(p)),!H.isValid())return"";p=H.format(ae(u))}return u.uidt===x.LongText&&(p=`"${p.replace(/"/g,'\\"')}"`),p},ct=(i,u)=>{let p="<table>",ue="";const S=[];return i.forEach((k,H)=>{let Q="<tr>";const Ce=[];u.forEach((ce,I)=>{const O=Ee(k,ce);Q+=`<td>${O}</td>`,ue=`${ue}${O}${u.length-1!==I?"	":""}`,Ce.push(O)}),p+=`${Q}</tr>`,i.length-1!==H&&(ue=`${ue}
`),S.push(Ce)}),p+="</table>",{html:p,text:ue,json:S}},vt=async(i,u)=>{const{html:p,text:ue}=ct(i,u),S=new Blob([p],{type:"text/html"}),k=new Blob([ue],{type:"text/plain"});return navigator.clipboard.write([new ClipboardItem({[S.type]:S,[k.type]:k})])};async function xt(i){try{if(a.start!==null&&a.end!==null&&!a.isSingleCell()){const u=e(r).slice(a.start.row,a.end.row+1),p=e(w).slice(a.start.col,a.end.col+1);await vt(u,p),ye.success(xe("msg.info.copiedToClipboard"))}else{const u=(i==null?void 0:i.row)??l.row,p=(i==null?void 0:i.col)??l.col;if(u!=null&&p!=null){const ue=e(r)[u],S=e(w)[p],k=Ee(ue,S);await Ie(k),ye.success(xe("msg.info.copiedToClipboard"))}}}catch{ye.error(xe("msg.error.copyToClipboardError"))}}function qe(i,u){return l.col===u&&l.row===i?!0:a.isCellInRange({row:i,col:u})}function at(i,u){return M._start===null||M._end===null||a.isCellInRange({row:i,col:u})?!1:M.isCellInRange({row:i,col:u})}const gt=(i,u,p=!1)=>!i||!u?(p&&ye.info("Please select a cell to paste"),!1):st(u)||Xt(u)?(p&&ye.info(xe("msg.info.pasteNotSupported")),!1):u.ai?(p&&ye.info(xe("msg.info.autoIncFieldNotEditable")),!1):u.pk&&!i.rowMeta.new?(p&&ye.info(xe("msg.info.editingPKnotSupported")),!1):!0;function Oe(i,u,p){if(m.value){const ue=e(r)[u];if(!a._start||!a._end||ue.rowMeta.new)return;M.endRange({row:u,col:a._end.col}),f==null||f(u,p);return}P.value&&(a.endRange({row:u,col:p}),f==null||f(u,p),i.preventDefault())}function Mt(i,u,p){if(!(((i==null?void 0:i.button)!==Co||(i==null?void 0:i.button)===Co&&i.ctrlKey)&&qe(u,p))){if(A.value||(P.value=!0),X.value=!1,i.preventDefault(),i.shiftKey){(l.col===null||l.row===null)&&a.startRange({row:u,col:p}),a.endRange({row:u,col:p});return}a.startRange({row:u,col:p}),(l.row!==u||l.col!==p)&&(l.row=null,l.col=null)}}const Pt=(i,u,p)=>{(!i.shiftKey||l.col===null||l.row===null)&&ie(u,p),f==null||f(u,p)},Xe=i=>{var u;if(m.value){if(m.value=!1,M._start===null||M._end===null)return;if(a._start!==null&&a._end!==null){const p={row:a._start.row,col:a._start.col},ue=e(r).slice(a.start.row,a.end.row+1),S=e(w).slice(a.start.col,a.end.col+1),k=ct(ue,S).json,H=M._start.row<=M._end.row?1:-1;let Q=H===1?0:k.length-1;const Ce=[],ce=[];for(let I=M._start.row;H===1?I<=M._end.row:I>=M._end.row;I+=H){if(qe(I,a.start.col))continue;const O=e(r)[I];let ge=0;for(let ke=M.start.col;ke<=M.end.col;ke++){const fe=e(w)[ke];if(!gt(O,fe)){ge++;continue}ce.push(fe.title);const He=qt({value:k[Q][ge],to:fe.uidt,column:fe,appInfo:e(j)},te((u=Z.value)==null?void 0:u.source_id),!0);He!==void 0&&(O.row[fe.title]=He,Ce.push(O)),ge++}H===1?Q=Q<k.length-1?Q+1:0:Q=Q>=1?Q-1:k.length-1}y==null||y(Ce,ce).then(()=>{M._start===null||M._end===null||(a.startRange(p),a.endRange(M._end),ie(p.row,p.col),M.clear())})}else M.clear();return}P.value&&(P.value=!1,setTimeout(()=>{a._start&&(l.row!==a._start.row||l.col!==a._start.col)&&ie(a._start.row,a._start.col)},0))},Bt=async i=>{var p,ue,S,k,H,Q,Ce,ce,I,O,ge,ke,fe,He,Qe,Ne,Te,ne,Ae,Je,dt,nt,Jt,Ht,Zt,eo,to,oo,Ze,kt,Rt,Tt;if(await(E==null?void 0:E(i)))return!0;if(ut()||!$e.value||l.row===null||l.col===null)return;const u=io()?i.metaKey:i.ctrlKey;switch(i.key){case"Tab":i.preventDefault(),a.clear(),i.shiftKey?l.col>0?(l.col--,A.value=!1):l.row>0&&(l.row--,l.col=e(oe.value)-1,A.value=!1):l.col<e(oe.value)-1?(l.col++,A.value=!1):l.row<e(r).length-1&&(l.row++,l.col=0,A.value=!1),f==null||f();break;case"Enter":i.preventDefault(),a.clear(),_(e(r)[l.row],e(w)[l.col]);break;case"Delete":case"Backspace":i.preventDefault(),a.isSingleCell()?(a.clear(),await Y(l)):await D();break;case"ArrowRight":i.preventDefault(),i.shiftKey?u?(A.value=!1,a.endRange({row:((p=a._end)==null?void 0:p.row)??l.row,col:e(oe.value)-1}),f==null||f((ue=a._end)==null?void 0:ue.row,(S=a._end)==null?void 0:S.col)):(((k=a._end)==null?void 0:k.col)??l.col)<e(oe.value)-1&&(A.value=!1,a.endRange({row:((H=a._end)==null?void 0:H.row)??l.row,col:(((Q=a._end)==null?void 0:Q.col)??l.col)+1}),f==null||f((Ce=a._end)==null?void 0:Ce.row,(ce=a._end)==null?void 0:ce.col)):(a.clear(),l.col<e(oe.value)-1&&(l.col++,a.startRange({row:l.row,col:l.col}),f==null||f(),A.value=!1));break;case"ArrowLeft":i.preventDefault(),i.shiftKey?u?(A.value=!1,a.endRange({row:((I=a._end)==null?void 0:I.row)??l.row,col:0}),f==null||f((O=a._end)==null?void 0:O.row,(ge=a._end)==null?void 0:ge.col)):(((ke=a._end)==null?void 0:ke.col)??l.col)>0&&(A.value=!1,a.endRange({row:((fe=a._end)==null?void 0:fe.row)??l.row,col:(((He=a._end)==null?void 0:He.col)??l.col)-1}),f==null||f((Qe=a._end)==null?void 0:Qe.row,(Ne=a._end)==null?void 0:Ne.col)):(a.clear(),l.col>0&&(l.col--,a.startRange({row:l.row,col:l.col}),f==null||f(),A.value=!1));break;case"ArrowUp":i.preventDefault(),i.shiftKey?u?(A.value=!1,a.endRange({row:0,col:((Te=a._end)==null?void 0:Te.col)??l.col}),f==null||f((ne=a._end)==null?void 0:ne.row,(Ae=a._end)==null?void 0:Ae.col)):(((Je=a._end)==null?void 0:Je.row)??l.row)>0&&(A.value=!1,a.endRange({row:(((dt=a._end)==null?void 0:dt.row)??l.row)-1,col:((nt=a._end)==null?void 0:nt.col)??l.col}),f==null||f((Jt=a._end)==null?void 0:Jt.row,(Ht=a._end)==null?void 0:Ht.col)):(a.clear(),l.row>0&&(l.row--,a.startRange({row:l.row,col:l.col}),f==null||f(),A.value=!1));break;case"ArrowDown":i.preventDefault(),i.shiftKey?u?(A.value=!1,a.endRange({row:e(r).length-1,col:((Zt=a._end)==null?void 0:Zt.col)??l.col}),f==null||f((eo=a._end)==null?void 0:eo.row,(to=a._end)==null?void 0:to.col)):(((oo=a._end)==null?void 0:oo.row)??l.row)<e(r).length-1&&(A.value=!1,a.endRange({row:(((Ze=a._end)==null?void 0:Ze.row)??l.row)+1,col:((kt=a._end)==null?void 0:kt.col)??l.col}),f==null||f((Rt=a._end)==null?void 0:Rt.row,(Tt=a._end)==null?void 0:Tt.col)):(a.clear(),l.row<e(r).length-1&&(l.row++,a.startRange({row:l.row,col:l.col}),f==null||f(),A.value=!1));break;default:{const We=e(r)[l.row],Pe=e(w)[l.col];if((!e(A)||!ma(Pe))&&!uo()&&(io()?i.metaKey:i.ctrlKey))switch(i.keyCode){case 67:await xt();break;case 65:a.startRange({row:0,col:0}),a.endRange({row:e(r).length-1,col:e(oe.value)-1});break}if(i.key==="Escape"&&(a.clear(),l.col=null,l.row=null),e(A)||i.ctrlKey||i.altKey||i.metaKey)return!0;if(i.key.length===1){if(!e(s)&&!We.rowMeta.new)return ye.info(xe("msg.info.updateNotAllowedWithoutPK"));ma(Pe)&&_(We,Pe)&&Pe.title&&(Pe.uidt===x.LongText?We.row[Pe.title]==="<br />"?We.row[Pe.title]=i.key:We.row[Pe.title]=We.row[Pe.title]?We.row[Pe.title]+i.key:i.key:We.row[Pe.title]="")}}break}},It=()=>a.clear(),Ot=a.clear.bind(a),Ge=async i=>{var p,ue,S,k,H,Q,Ce,ce;if(uo()||ut()||!$e.value||e(A)||l.row===null||l.row===void 0||l.col===null||l.col===void 0)return;i.preventDefault();const u=((p=i.clipboardData)==null?void 0:p.getData("text/plain"))||"";try{if(u!=null&&u.includes(`
`)||u!=null&&u.includes("	")){const I=Sn.parse(u,{delimiter:"	",escapeChar:"\\"});if(I.errors.length>0)throw new Error(I.errors[0].message);const O=I.data,ge=Math.max(O.length,a.end.row-a.start.row+1),ke=ge,fe=O[0].length,He=e(w).slice(l.col,l.col+fe),Qe=e(r).slice(l.row,l.row+ge),Ne=[];let Te=0;for(let ne=0;ne<ke;ne++){const Ae=Qe[ne];if(!Ae||Ae.rowMeta.new)break;Te++;for(let Je=0;Je<fe;Je++){const dt=He[Je];if(!gt(Ae,dt))continue;Ne.push(dt.title);const nt=qt({value:O[ne%O.length][Je],to:dt.uidt,column:dt,appInfo:e(j)},te((ue=Z.value)==null?void 0:ue.source_id),!0);nt!==void 0&&(Ae.row[dt.title]=nt)}}await(y==null?void 0:y(Qe,Ne)),Te>0&&(a.startRange({row:l.row,col:l.col}),a.endRange({row:l.row+Te-1,col:l.col+fe-1}))}else if(a.isSingleCell()){const I=e(r)[l.row],O=e(w)[l.col];if(O.uidt===x.LinkToAnotherRecord&&((S=O.colOptions)==null?void 0:S.type)===Dn.BELONGS_TO){const ke=JSON.parse(u);I.row[O.title]=qt({value:ke,to:O.uidt,column:O,appInfo:e(j)},te((k=Z.value)==null?void 0:k.source_id));const fe=(Q=(H=Z.value)==null?void 0:H.columns)==null?void 0:Q.find(Qe=>{var Ne;return Qe.id===((Ne=O.colOptions)==null?void 0:Ne.fk_child_column_id)}),He=await G(O.colOptions.fk_related_model_id);return fe?(I.row[fe.title]=At(ke,He.columns),await(K==null?void 0:K({...l,updatedColumnTitle:fe.title}))):void 0}if(!gt(I,O,!0))return;const ge=qt({value:u,to:O.uidt,column:O,appInfo:e(j)},te((Ce=Z.value)==null?void 0:Ce.source_id));ge!==void 0&&(I.row[O.title]=ge),await(K==null?void 0:K(l))}else{const I=a.start,O=a.end,ge=Math.min(I.row,O.row),ke=Math.max(I.row,O.row),fe=Math.min(I.col,O.col),He=Math.max(I.col,O.col),Qe=e(w).slice(fe,He+1),Ne=e(r).slice(ge,ke+1),Te=[];for(const ne of Ne)if(!(!ne||ne.rowMeta.new))for(const Ae of Qe){if(!Ae.title||!gt(ne,Ae))continue;Te.push(Ae.title);const Je=qt({value:u,to:Ae.uidt,column:Ae,appInfo:e(j)},te((ce=Z.value)==null?void 0:ce.source_id),!0);Je!==void 0&&(ne.row[Ae.title]=Je)}await(y==null?void 0:y(Ne,Te))}}catch(I){console.error(I),ye.error(await Mn(I))}};function Gt(i){var u,p;(i==null?void 0:i.button)===Co&&(m.value=!0,a._start&&a._end&&(M.startRange({row:(u=a._start)==null?void 0:u.row,col:a._start.col}),M.endRange({row:(p=a._end)==null?void 0:p.row,col:a._end.col})),i.preventDefault())}return mt(document,"keydown",Bt),mt(document,"mouseup",Xe),mt(document,"paste",Ge),mt(de,"mousedown",Gt),{isCellActive:$e,handleMouseDown:Mt,handleMouseOver:Oe,clearSelectedRange:Ot,copyValue:xt,isCellSelected:qe,activeCell:l,handleCellClick:Pt,resetSelectedRange:It,selectedRange:a,makeActive:ie,isCellInFillRange:at,isMouseDown:P,isFillMode:m}}const Ar=()=>{const{t:d}=po();return{paste:async()=>{try{if(!navigator.clipboard)throw new Error(d("msg.error.pasteFromClipboardError"));const r=await navigator.clipboard.readText(),V=new Event("paste",{bubbles:!1,cancelable:!0});return Object.defineProperty(V,"clipboardData",{value:{getData:()=>r||""}}),document.dispatchEvent(V),!0}catch{return ye.error(d("msg.error.pasteFromClipboardError")),!1}}}},Vr={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},zr=h("path",{fill:"currentColor",d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-6 4.1L14.1 6l1.4 1.4L16.9 6L18 7.1l-1.4 1.4L18 9.9L16.9 11l-1.4-1.4l-1.4 1.4L13 9.9l1.4-1.4zm-6.8.6h5v1.5h-5zm5.3 8.3h-2v2H8v-2H6v-1.5h2v-2h1.5v2h2zm6.5 1.2h-5v-1.5h5zm0-2.4h-5v-1.5h5z"},null,-1),Nr=[zr];function Fr(d,w){return n(),R("svg",Vr,[...Nr])}const Pr={name:"mdi-calculator-variant",render:Fr},Br={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ir=h("path",{fill:"currentColor",d:"M2 12a9 9 0 0 0 9 9c2.39 0 4.68-.94 6.4-2.6l-1.5-1.5A6.706 6.706 0 0 1 11 19c-6.24 0-9.36-7.54-4.95-11.95C10.46 2.64 18 5.77 18 12h-3l4 4h.1l3.9-4h-3a9 9 0 0 0-18 0"},null,-1),Or=[Ir];function Gr(d,w){return n(),R("svg",Br,[...Or])}const Hr={name:"mdi-reload",render:Gr},Tr={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Wr=h("path",{fill:"currentColor",d:"M11 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2V2zm-7 8v4h7v-4zm0 6v4h7v-4zM4 4v4h7V4zm11 7h3V8h2v3h3v2h-3v3h-2v-3h-3z"},null,-1),Yr=[Wr];function Kr(d,w){return n(),R("svg",Tr,[...Yr])}const Ur={name:"mdi-table-column-plus-after",render:Kr},jr=({fields:d,tableBodyEl:w,gridWrapper:r})=>{const{eventBus:V}=Ao(),{addUndo:s,defineViewScope:X}=Pa(),{activeView:Y}=zt(mo()),{gridViewCols:D,updateGridViewColumn:_}=Ba(),{leftSidebarWidth:f}=zt(br()),{width:E}=Ln(),K=b(null),y=b(null),de=b(null),Z=async(G,j)=>{const te=D.value[G],B=D.value[j],A=d.value.findIndex($e=>$e.id===j),P=A<d.value.length-1?d.value[A+1]:null,m=P?D.value[P.id]:null,a=d.value[d.value.length-1],M=D.value[a.id];if(m===null||M===null)return;const l=m?B.order+(m.order-B.order)/2:M.order+1,oe=te.order;te.order=l,s({undo:{fn:async()=>{d.value&&(te.order=oe,await _(G,{order:oe}),V.emit(Dt.FIELD_RELOAD))},args:[]},redo:{fn:async()=>{d.value&&(te.order=l,await _(G,{order:l}),V.emit(Dt.FIELD_RELOAD))},args:[]},scope:X({view:Y.value})}),await _(G,{order:l},!0),V.emit(Dt.FIELD_RELOAD)};return{onDrag:G=>{if(G.preventDefault(),!G.dataTransfer||!K.value||!y.value)return;if(G.clientX===0){y.value.style.left="0px",y.value.style.height="0px",Z(K.value.id,de.value),K.value=null,de.value=null;return}const j=y.value.getBoundingClientRect().top,B=document.elementsFromPoint(G.clientX,j).find(m=>m.classList.contains("nc-grid-column-header"));B&&(de.value=(B==null?void 0:B.getAttribute("data-col"))??null);const A=G.clientX-f.value;A>=0&&(y.value.style.left=`${A.toString()}px`);const P=parseFloat(getComputedStyle(document.documentElement).fontSize);A<f.value+1*P?setTimeout(()=>{r.value.scrollLeft-=2.5},250):E.value-A-f.value<15*P&&setTimeout(()=>{r.value.scrollLeft+=2.5},250)},onDragStart:(G,j)=>{var m;if(!j.dataTransfer)return;const te=document.querySelector('[data-testid="drag-icon-placeholder"]');j.dataTransfer.dropEffect="none",j.dataTransfer.effectAllowed="none",j.dataTransfer.setDragImage(te,10,10),j.dataTransfer.clearData(),j.dataTransfer.setData("text/plain",G),K.value=d.value.find(a=>a.id===G)??null;const B=parseFloat(getComputedStyle(document.documentElement).fontSize),A=((m=w.value)==null?void 0:m.getBoundingClientRect().height)??6.1*B;y.value.style.height=`${A}px`;const P=j.clientX-f.value;P>=0&&y.value&&(y.value.style.left=`${P.toString()}px`)},draggedCol:K,dragColPlaceholderDomRef:y,toBeDroppedColId:de}},qr=({changePage:d,paginationDataRef:w})=>{const{isViewDataLoading:r}=zt(mo()),V=()=>Math.ceil(w.value.totalRows/w.value.pageSize),s=async f=>{r.value=!0;try{await(d==null?void 0:d(f)),r.value=!1}catch(E){if(Ma.isCancel(E))return;r.value=!1}};return{onLeft:async f=>{if(ut()||!f.altKey)return;f.preventDefault();const E=w.value.page-1;E<1||await s(E)},onRight:async f=>{if(ut()||!f.altKey)return;f.preventDefault();const E=w.value.page+1;E>V()||await s(E)},onUp:async f=>{ut()||f.altKey&&(f.preventDefault(),await s(V()))},onDown:async f=>{if(ut()||!f.altKey)return;f.preventDefault(),await s(1)}}},Xr=qr,Qr=tt(()=>ot(()=>import("./VirtualCell.276a28e0.js"),["./VirtualCell.276a28e0.js","./entry.5958c07b.js","./entry.bdecbb78.css","./Tooltip.vue.971897f4.js","./Tooltip.b86f91a1.css","./EditOrAddProvider.vue.31035ffc.js","./Icon.vue.129448d5.js","./Button.vue.c3ca0e8f.js","./index.55641318.js","./debounce.7c24f171.js","./toNumber.e09cd85a.js","./isSymbol.114fe557.js","./_plugin-vue_export-helper.c27b6911.js","./Button.ff10bcb0.css","./index.9b87fcff.js","./views.4281cbf1.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./useSharedView.e8f68616.js","./validation.2de04583.js","./index.b06c8b67.js","./FormItem.0bbf90a3.js","./identity.34c7640e.js","./_getPrototype.c1f3bae2.js","./Col.a97e3e76.js","./responsiveObserve.0baefba6.js","./toArray.fd74ce6f.js","./FormItemContext.ddc65fa5.js","./useSize.fad35fe8.js","./_flatRest.39582a58.js","./isPlainObject.ccda79fe.js","./vuedraggable.umd.00f5fccc.js","./v3-infinite-loading.660bd977.js","./index.dc13a4d6.js","./Dropdown.041b2468.js","./RightOutlined.7161c742.js","./index.ae235b22.js","./Input.dca3a2bc.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.a517903c.js","./TextArea.9074ff05.js","./Password.f52125e7.js","./cell.165313cd.js","./index.5e1434a7.js","./Checkbox.2e7b0035.js","./createForOfIteratorHelper.33de41ba.js","./index.5c6e4286.js","./isMobile.e2e89480.js","./useMemo.1dd071d8.js","./useState.b891c8bb.js","./CheckOutlined.1fe5f230.js","./EditOrAddProvider.9247d0ff.css","./virtualCell.427fa223.js","./VirtualCell.ff98befc.css"],import.meta.url).then(d=>d.default||d)),Jr=tt(()=>ot(()=>import("./Cell.0991f33c.js"),["./Cell.0991f33c.js","./entry.5958c07b.js","./entry.bdecbb78.css","./CellIcon.b1340151.js","./index.9b87fcff.js","./cell.165313cd.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./Tooltip.vue.971897f4.js","./Tooltip.b86f91a1.css","./EditOrAddProvider.vue.31035ffc.js","./Icon.vue.129448d5.js","./Button.vue.c3ca0e8f.js","./index.55641318.js","./debounce.7c24f171.js","./toNumber.e09cd85a.js","./isSymbol.114fe557.js","./_plugin-vue_export-helper.c27b6911.js","./Button.ff10bcb0.css","./views.4281cbf1.js","./useSharedView.e8f68616.js","./validation.2de04583.js","./index.b06c8b67.js","./FormItem.0bbf90a3.js","./identity.34c7640e.js","./_getPrototype.c1f3bae2.js","./Col.a97e3e76.js","./responsiveObserve.0baefba6.js","./toArray.fd74ce6f.js","./FormItemContext.ddc65fa5.js","./useSize.fad35fe8.js","./_flatRest.39582a58.js","./isPlainObject.ccda79fe.js","./vuedraggable.umd.00f5fccc.js","./v3-infinite-loading.660bd977.js","./index.dc13a4d6.js","./Dropdown.041b2468.js","./RightOutlined.7161c742.js","./index.ae235b22.js","./Input.dca3a2bc.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.a517903c.js","./TextArea.9074ff05.js","./Password.f52125e7.js","./index.5e1434a7.js","./Checkbox.2e7b0035.js","./createForOfIteratorHelper.33de41ba.js","./index.5c6e4286.js","./isMobile.e2e89480.js","./useMemo.1dd071d8.js","./useState.b891c8bb.js","./CheckOutlined.1fe5f230.js","./EditOrAddProvider.9247d0ff.css","./Cell.14116970.css"],import.meta.url).then(d=>d.default||d)),Zr=tt(()=>ot(()=>import("./VirtualCell.3d02a7f6.js"),["./VirtualCell.3d02a7f6.js","./entry.5958c07b.js","./entry.bdecbb78.css","./index.9b87fcff.js","./virtualCell.427fa223.js","./cell.165313cd.js"],import.meta.url).then(d=>d.default||d)),el=tt(()=>ot(()=>import("./Cell.2a47fcd0.js"),["./Cell.2a47fcd0.js","./entry.5958c07b.js","./entry.bdecbb78.css","./index.9b87fcff.js","./cell.165313cd.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./useSmartsheetRowStore.5b92cc1b.js","./deepCompare.d32ec333.js","./dataUtils.3f874ca1.js","./virtualCell.427fa223.js","./index.e61e381a.js","./_plugin-vue_export-helper.c27b6911.js","./Cell.f27da8af.css"],import.meta.url).then(d=>d.default||d)),tl=tt(()=>ot(()=>import("./Row.3bf51c0f.js"),["./Row.3bf51c0f.js","./index.9b87fcff.js","./useSmartsheetRowStore.5b92cc1b.js","./entry.5958c07b.js","./entry.bdecbb78.css","./deepCompare.d32ec333.js","./dataUtils.3f874ca1.js","./virtualCell.427fa223.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./index.e61e381a.js","./useSmartsheetStore.f1a70558.js","./views.4281cbf1.js","./useSharedView.e8f68616.js"],import.meta.url).then(d=>d.default||d)),ol=tt(()=>ot(()=>import("./Pagination.cfda58a8.js"),["./Pagination.cfda58a8.js","./Pagination.c0f166a7.js","./Icon.vue.129448d5.js","./entry.5958c07b.js","./entry.bdecbb78.css","./Button.vue.c3ca0e8f.js","./index.55641318.js","./debounce.7c24f171.js","./toNumber.e09cd85a.js","./isSymbol.114fe557.js","./_plugin-vue_export-helper.c27b6911.js","./Button.ff10bcb0.css","./Tooltip.vue.971897f4.js","./Tooltip.b86f91a1.css","./index.5c6e4286.js","./toArray.fd74ce6f.js","./antInputDirective.8ac36ea7.js","./isMobile.e2e89480.js","./useMemo.1dd071d8.js","./useState.b891c8bb.js","./CheckOutlined.1fe5f230.js","./SearchOutlined.a517903c.js","./FormItemContext.ddc65fa5.js","./Pagination.fabf8b70.css","./views.4281cbf1.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./useSharedView.e8f68616.js","./index.9b87fcff.js","./sidebar.f5d81718.js","./index.025c8e21.js","./index.36af7517.js","./Element.a1e4f356.js","./Input.8209df88.js","./Image.c63a7a56.js","./index.ae235b22.js","./Input.dca3a2bc.js","./isPlainObject.ccda79fe.js","./_getPrototype.c1f3bae2.js","./TextArea.9074ff05.js","./Password.f52125e7.js","./Pagination.9422c247.css"],import.meta.url).then(d=>d.default||d)),Vo=d=>(La("data-v-86cd3084"),d=d(),Ea(),d),al=Vo(()=>h("div",{"data-testid":"drag-icon-placeholder",class:"absolute w-1 h-1 pointer-events-none opacity-0"},null,-1)),nl={class:"flex items-center justify-center absolute l-0 t-0 w-full h-full z-10 pb-10 pointer-events-none"},rl={class:"flex flex-col justify-center gap-2"},ll=["innerHTML"],sl={key:0},il={class:"nc-grid-header"},ul={class:"w-full h-full flex pl-5 pr-1 items-center","data-testid":"nc-check-all"},cl=Vo(()=>h("span",{class:"flex-1"},null,-1)),dl={key:1,class:"text-gray-500"},pl=["data-col","data-title","onXcstartresizing","onXcresize","onXcresizing","onClick"],fl=["draggable","onDragstart"],ml={class:"absolute top-0 left-0 h-10.25 border-b-1 border-r-1 border-gray-200 nc-grid-add-edit-column group"},wl={class:"h-full w-[60px] flex items-center justify-center"},vl={class:"flex flex-row items-center py-3"},gl={class:"text-xs pl-2"},hl=["onClick"],_l={class:"text-xs pl-2"},yl={class:"text-red-500 text-xs pl-2"},bl={class:"text-xs pl-2"},xl={class:"flex flex-row items-center py-3"},kl={class:"text-xs pl-2"},Rl=["onClick"],Cl={class:"text-xs pl-2"},Sl={class:"text-xs pl-2"},Dl=["data-testid"],Ml=["data-testid"],$l={class:"items-center flex gap-1 min-w-[60px]"},Ll=Vo(()=>h("span",{class:"flex-1"},null,-1)),El=["data-testid"],Al=["onClick"],Vl={key:2,class:"cursor-pointer flex items-center border-1 border-gray-100 active:ring rounded p-1 hover:bg-gray-50"},zl={key:0,class:"w-full"},Nl={class:"h-10.5 border-b-1 border-gray-100 bg-white group-hover:bg-gray-50 absolute left-0 bottom-0 px-2 sticky z-40 w-full flex items-center text-gray-500"},Fl=["colspan"],Pl={class:"flex gap-2 items-center"},Bl={class:"flex gap-2 items-center"},Il={class:"flex gap-2 items-center"},Ol={class:"flex gap-2 items-center"},Gl={class:"flex gap-2 items-center"},Hl={class:"flex gap-2 items-center"},Tl={class:"flex gap-2 items-center"},Wl={class:"flex gap-2 items-center"},Yl={class:"flex gap-2 items-center"},Kl={key:0,class:"flex ml-1"},Ul={"data-testid":"nc-pagination-add-record",class:"flex items-center px-2 text-gray-600 hover:text-black"},jl={class:"relative overflow-visible min-h-17 w-10"},ql={class:"flex flex-row items-center justify-between w-full"},Xl={class:"flex flex-row items-center justify-start gap-x-3"},Ql={class:"flex flex-row text-xs text-gray-400 ml-7.25"},Jl={class:"flex flex-row items-center justify-between w-full"},Zl={class:"flex flex-row items-center justify-start gap-x-2.5"},es={class:"flex flex-row text-xs text-gray-400 ml-7.05"},Ca=!1,ts=Ft({__name:"Table",props:{data:{},paginationData:{},loadData:{type:Function},changePage:{type:Function},callAddEmptyRow:{type:Function},deleteRow:{type:Function},updateOrSaveRow:{type:Function},selectedAllRecords:{type:Boolean},deleteRangeOfRows:{type:Function},rowHeight:{},expandForm:{type:Function},deleteSelectedRows:{type:Function},removeRowIfNew:{type:Function},bulkUpdateRows:{type:Function},headerOnly:{type:Boolean},hideHeader:{type:Boolean},pagination:{},disableSkeleton:{type:Boolean}},emits:["update:selectedAllRecords","bulkUpdateDlg","toggleOptimisedQuery"],setup(d,{expose:w,emit:r}){const V=d,s=r,X=Mo(V,"selectedAllRecords",s),Y=ko(V,"paginationData"),D=ko(V,"data"),_=ko(V,"pagination"),{loadData:f,changePage:E,callAddEmptyRow:K,updateOrSaveRow:y,deleteRow:de,expandForm:Z,deleteSelectedRows:xe,deleteRangeOfRows:Ie,removeRowIfNew:G,bulkUpdateRows:j,headerOnly:te,hideHeader:B,disableSkeleton:A}=V,P=Me(Lo,b()),m=Me(Eo,b()),a=Me(Aa,b([])),M=Me(Va,b(!1)),l=Me(Un,b(!1)),oe=Me(jn,b(!1)),$e=Me(za,b(!1)),ie=En(),Le=Me(fo,Vt()),F=Me(qn,Vt()),{isMobileMode:ae}=Sa(),Ee=Me(Na,b()),{isPkAvail:ct,isSqlView:vt,eventBus:xt}=Ao(),{isViewDataLoading:qe,isPaginationLoading:at}=zt(mo()),{$e:gt}=On(),{t:Oe}=po(),{getMeta:Mt}=Fa(),{addUndo:Pt,clone:Xe,defineViewScope:Bt}=Pa(),{isViewColumnsLoading:It,updateGridViewColumn:Ot,gridViewCols:Ge,resizingColOldWith:Gt}=Ba(),{isExpandedFormCommentMode:i}=zt(hr()),{predictingNextColumn:u,predictedNextColumn:p,predictingNextFormulas:ue,predictedNextFormulas:S,predictNextColumn:k,predictNextFormulas:H}=fr().table,Q=async()=>{await k(P)},Ce=async()=>{await H(P)},{paste:ce}=Ar(),I=b(),O=b(null),ge=b(),ke=b(),fe=b(),He=b(),Qe=An(ge),Ne=pe(()=>It.value||!P.value),{isUIAllowed:Te}=Vn(),ne=pe(()=>Te("dataEdit")),Ae=pe(()=>!M.value&&!l.value&&Te("fieldAdd")&&!vt.value),{onDrag:Je,onDragStart:dt,draggedCol:nt,dragColPlaceholderDomRef:Jt,toBeDroppedColId:Ht}=jr({fields:a,tableBodyEl:fe,gridWrapper:ge}),{onLeft:Zt,onRight:eo,onUp:to,onDown:oo}=Xr({paginationDataRef:Y,changePage:E}),Ze=b(!1),kt=b(!1),Rt=b(!1),Tt=b(!1),We=b(),Pe=b(!1),pt=b(!0),wo=b(!1),vo=b(null),Se=b(!1),No=b(!1),bt=pe({get:()=>No.value,set:t=>{No.value=t}}),Wt=b(!1),he=b(null),Fo=(t,o)=>{vt.value||(t.preventDefault(),o&&(he.value=o))},Po=b(!1);je(Xn,Po);async function Bo(t,o=!1){var T;if(!t||!ne.value||!Do(a.value[t.col])&&st(a.value[t.col]))return;if(((T=a.value[t.col])==null?void 0:T.uidt)===x.Links)return ye.info(Oe("msg.linkColumnClearNotSupportedYet"));const c=D.value[t.row],L=a.value[t.col];if(st(L)){Pt({undo:{fn:async($,le,se,be)=>{var _e,q,et,Ke;if(((_e=Y.value)==null?void 0:_e.pageSize)===be.pageSize){((q=Y.value)==null?void 0:q.page)!==be.page&&await(E==null?void 0:E(be.page));const $t=At(se.row,(et=P.value)==null?void 0:et.columns),_t=D.value[$.row],lt=a.value[$.col];if(lt.title&&$t===At(_t.row,(Ke=P.value)==null?void 0:Ke.columns)&&lt.id===le.id)_t.row[lt.title]=se.row[lt.title],I.value&&(await I.value[$.row].addLTARRef(_t.row[lt.title],lt),await I.value[$.row].syncLTARRefs(_t.row)),g.col=$.col,g.row=$.row,me==null||me();else throw new Error(Oe("msg.recordCouldNotBeFound"))}else throw new Error(Oe("msg.pageSizeChanged"))},args:[Xe(t),Xe(L),Xe(c),Xe(Y.value)]},redo:{fn:async($,le,se,be)=>{var _e,q,et,Ke;if(((_e=Y.value)==null?void 0:_e.pageSize)===be.pageSize){((q=Y.value)==null?void 0:q.page)!==be.page&&await(E==null?void 0:E(be.page));const $t=At(se.row,(et=P.value)==null?void 0:et.columns),_t=D.value[$.row],lt=a.value[$.col];if($t===At(_t.row,(Ke=P.value)==null?void 0:Ke.columns)&&lt.id===le.id)I.value&&await I.value[$.row].clearLTARCell(lt),g.col=$.col,g.row=$.row,me==null||me();else throw new Error(Oe("msg.recordCouldNotBeFound"))}else throw new Error(Oe("msg.pageSizeChanged"))},args:[Xe(t),Xe(L),Xe(c),Xe(Y.value)]},scope:Bt({view:m.value})}),I.value&&await I.value[t.row].clearLTARCell(L);return}if(L.title)switch(L.uidt){case x.Checkbox:c.row[L.title]=!1;break;case x.Rating:c.row[L.title]=0;break;default:c.row[L.title]=null;break}o||await(y==null?void 0:y(c,L.title))}function Io(t,o){if(!(!ne.value||Se.value||Ca||M.value||Xt(o))){if(!ct.value&&!t.rowMeta.new){ye.info(Oe("msg.info.updateNotAllowedWithoutPK"));return}if(o.ai){ye.info(Oe("msg.info.autoIncFieldNotEditable"));return}if(o.pk&&!t.rowMeta.new){ye.info(Oe("msg.info.editingPKnotSupported"));return}if(![x.SingleSelect,x.MultiSelect].includes(o.uidt))return Se.value=!0}}const ao=pe(()=>!Ca&&ne.value&&!vt.value&&!oe.value),Oo=pe(()=>{var t;return(t=a.value)==null?void 0:t.length}),Ga=pe(()=>{const t=[];return te!==!0?Ee.value||t.push("nc-scrollbar-x-lg !overflow-auto"):t.push("overflow-visible"),qe.value&&t.push("!overflow-hidden"),t.join(" ")}),Go=pe(()=>{var o;let t=((o=a.value)==null?void 0:o.length)??40;return t=t||40,Array.from({length:t+1}).map(()=>({}))}),Ha=pe(()=>Array.from({length:40}).map(()=>({}))),no=pe(()=>A!==!0&&(qe.value||at.value||Ne.value)||!P.value);function Ta(t){var o,c;(c=(o=ke.value)==null?void 0:o.querySelector("th:last-child"))==null||c.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{Ze.value=!0,We.value=t},500)}const Ho=(t=!1)=>{vo.value=null,Ze.value=!1,We.value={},t&&setTimeout(()=>{var c,L;const o=((c=ke.value)==null?void 0:c.querySelector(".nc-grid-add-edit-column"))??((L=ke.value)==null?void 0:L.querySelector("th:last-child"));o&&o.scrollIntoView({behavior:"smooth"})},200)};async function To(){const t=Ct(D.value.length,!0);t&&(Z==null||Z(t,void 0,!0))}const Wa=()=>{F.trigger()},Ya=()=>{pt.value=!0,Ct()},go=()=>{pt.value=!1,Wa()},Wo=(t,o,c)=>{var et,Ke;const L=t.getBoundingClientRect(),T=o.getBoundingClientRect(),$=15,le=((et=o.querySelector("thead th:nth-child(1)"))==null?void 0:et.getBoundingClientRect().width)??0,se=((Ke=o.querySelector("thead th:nth-child(2)"))==null?void 0:Ke.getBoundingClientRect().width)??0,be=le+se,_e={top:L.top-T.top,right:L.right-T.right,bottom:L.bottom-T.bottom,left:L.left-T.left-be},q={top:0,left:0};return q.left=_e.right+((c==null?void 0:c.right)||0)>0?o.scrollLeft+_e.right+((c==null?void 0:c.right)||0)+$:_e.left-((c==null?void 0:c.left)||0)<0?o.scrollLeft+_e.left-((c==null?void 0:c.left)||0)-$:o.scrollLeft,q.top=_e.bottom+((c==null?void 0:c.bottom)||0)>0?o.scrollTop+_e.bottom+((c==null?void 0:c.bottom)||0)+$:_e.top-((c==null?void 0:c.top)||0)<0?o.scrollTop+_e.top-((c==null?void 0:c.top)||0)-$:o.scrollTop,q},{isCellSelected:Yo,activeCell:g,handleMouseDown:Ka,handleMouseOver:Ua,handleCellClick:ja,clearSelectedRange:rt,copyValue:qa,isCellActive:Ko,resetSelectedRange:Xa,makeActive:Uo,selectedRange:re,isCellInFillRange:Qa,isFillMode:Ja}=Er(P,a,D,Se,ct,bt,Bo,Xo,Io,me,t=>{var T;if(document.querySelector(".nc-picker-datetime.active,.nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active,.nc-picker-date.active,.nc-picker-year.active,.nc-picker-time.active"))return t.preventDefault(),!0;if(ut())return;if(uo())return!0;const c=io()?t.metaKey:t.ctrlKey,L=t.altKey;if(t.key===" "){const $=ut();if(Ko.value&&!Se.value&&ne.value&&g.row!==null&&!$){t.preventDefault();const le=D.value[g.row];return Z==null||Z(le),!0}}else if(t.key==="Escape"){if(Se.value)return Se.value=!1,!0}else if(t.key==="Enter"){if(t.shiftKey)return!0;if(Se.value)return Se.value=!1,!0}if(c){if(!Ko.value||t.shiftKey)return;switch(t.key){case"ArrowUp":return t.preventDefault(),rt(),g.row=0,g.col=g.col??0,me==null||me(),Se.value=!1,!0;case"ArrowDown":return t.preventDefault(),rt(),g.row=D.value.length-1,g.col=g.col??0,me==null||me(),Se.value=!1,!0;case"ArrowRight":return t.preventDefault(),rt(),g.row=g.row??0,g.col=((T=a.value)==null?void 0:T.length)-1,me==null||me(),Se.value=!1,!0;case"ArrowLeft":return t.preventDefault(),rt(),g.row=g.row??0,g.col=0,me==null||me(),Se.value=!1,!0}}if(L)switch(t.keyCode){case 82:{ao.value&&(gt("c:shortcut",{key:"ALT + R"}),Ct(),g.row=D.value.length-1,g.col=0,Xa(),lo(()=>{var $;($=document.querySelector("td.cell.active"))==null||$.scrollIntoView({behavior:"smooth"})}));break}case 67:{Ae.value&&(gt("c:shortcut",{key:"ALT + C"}),Ze.value=!0);break}}},async t=>{const o=D.value[t.row],c=t.col!==void 0?a.value[t.col]:null;!o||!c||!t.updatedColumnTitle&&st(c)||(D.value[t.row].rowMeta.isUpdatedFromCopyNPaste={...D.value[t.row].rowMeta.isUpdatedFromCopyNPaste,[t.updatedColumnTitle||c.title]:!0},await(y==null?void 0:y(o,t.updatedColumnTitle||c.title)))},j,He);function jo(t){rt(),Uo(t??D.value.length-1,0),re.startRange({row:g.row,col:g.col}),me==null||me()}async function Za(t){await(y==null?void 0:y(t))}function Ct(t,o=!1){const c=K==null?void 0:K(t);return!o&&c&&Za(c),lo().then(()=>{jo(t??D.value.length-1)}),c}const en=t=>{try{de==null||de(t),re.isRowInRange(t)&&rt(),g.row===t&&(g.row=null,g.col=null)}catch(o){ye.error(o.message)}},tn=t=>{try{i.value=!0;const o=D.value[t];Z&&Z(o),g.row=null,g.col=null,re.clear()}catch(o){ye.error(o.message)}},on=()=>{Ie==null||Ie(re).then(()=>{rt(),g.row=null,g.col=null})},an=t=>{const o=a.value.findIndex(c=>c.id===t);o!==-1&&(Uo(0,o),re.startRange({row:0,col:o}),re.endRange({row:D.value.length-1,col:o}))};zn(fe,t=>{if(Pe.value||bt.value||g.row===null||g.col===null||ut())return;const c=a.value[g.col];if(Se.value&&(st(c)||c.uidt===x.JSON)||Ja.value)return;const L=document.querySelector(".nc-picker-datetime.active,.nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active,.nc-dropdown-user-select-cell.active,.nc-picker-date.active,.nc-picker-year.active,.nc-picker-time.active");t.target&&L&&(L===t.target||L!=null&&L.contains(t.target))||uo()||(rt(),g.row=null,g.col=null)});const qo=t=>{if(!(g.row===null||g.col===null)){switch(Se.value=!1,rt(),t){case co.NEXT:g.row<D.value.length-1||Ct(),g.row++;break;case co.PREV:g.row>0&&g.row--;break}lo(()=>{me()})}};async function Xo(){if(!ne.value)return;const t=re.start,o=re.end,c=Math.min(t.row,o.row),L=Math.max(t.row,o.row),T=Math.min(t.col,o.col),$=Math.max(t.col,o.col),le=a.value.slice(T,$+1),se=D.value.slice(c,L+1),be=[];for(const _e of se)for(const q of le)!_e||!q||!q.title||st(q)||(_e.row[q.title]=null,be.push(q.title));await(j==null?void 0:j(se,be))}const ht=pe(()=>Ee.value||ge.value);function me(t,o){var c,L;if(t=t??g.row,o=o??g.col,t!==null&&o!==null){const T=(c=fe.value)==null?void 0:c.querySelectorAll("tr"),$=(L=T==null?void 0:T[t])==null?void 0:L.querySelectorAll("td"),le=$==null?void 0:$[o===0?0:o+1];if(!le||!ht.value)return;const{height:se}=ke.value.getBoundingClientRect(),be=Wo(le,ht.value,{top:se||40,bottom:9,right:9});if(o===0&&(be.left=0),T&&t===T.length-2){const _e=T[T.length-1]||T[T.length-2],q=Wo(_e,ht.value,{top:se||40,bottom:9,right:9});ht.value.scrollTo({top:q.top,left:$&&o===$.length-2?ht.value.scrollWidth:be.left,behavior:"smooth"});return}if($&&o===$.length-2){ht.value.scrollTo({top:be.top,left:ht.value.scrollWidth,behavior:"smooth"});return}ht.value.scrollTo({top:be.top,left:be.left,behavior:"smooth"})}}const ho=async(t={})=>{var c,L,T;let o=-1;for(const $ of t.data||D.value){if(o++,$.rowMeta.new){const le=(L=(c=I.value)==null?void 0:c[o])==null?void 0:L.syncLTARRefs,se=await(y==null?void 0:y($,"",{},t));await(le==null?void 0:le(se,t)),$.rowMeta.changed=!1;continue}if($.rowMeta.changed){$.rowMeta.changed=!1;for(const le of((T=t.metaValue||P.value)==null?void 0:T.columns)??[])st(le)||le.uidt===x.Attachment||le.title in $.row&&$.row[le.title]!==$.oldRow[le.title]&&await(y==null?void 0:y($,le.title,{},t))}}},nn=(t,o)=>{t&&Ot(t,{width:o.detail})},rn=(t,o)=>{t&&(Ge.value[t].width=`${o.detail}`)},ln=(t,o)=>{t&&(Gt.value=o.detail)},Qo=(t,o,c)=>{We.value={title:t,uidt:o,colOptions:c},Rt.value=!1},Jo=b(),Zo=b(),_o=()=>{lo(()=>{const t=document.querySelector(".last-cell");if(t){const o=t.getBoundingClientRect();if(!o||!ge.value)return;Jo.value=o.top+o.height-Qe.top.value+ge.value.scrollTop,Zo.value=o.left+o.width-Qe.left.value+ge.value.scrollLeft}})},sn=pe(()=>{var t,o;return!M.value&&!Se.value&&(!re.isEmpty()||g.row!==null&&g.col!==null)&&!((o=(t=D.value[(isNaN(re.end.row)?g.row:re.end.row)??-1])==null?void 0:t.rowMeta)!=null&&o.new)&&g.col!==null&&!(ba(a.value[g.col])||xa(a.value[g.col])||ka(a.value[g.col])||wa(a.value[g.col])||va(a.value[g.col]))});Qt([()=>re.end.row,()=>re.end.col,()=>g.row,()=>g.col],([t,o,c,L],[T,$,le,se])=>{(t!==T||o!==$||c!==le||L!==se)&&_o()}),$a(()=>{const t=new ResizeObserver(()=>{var o;_o(),g.row!==null&&!((o=D.value)!=null&&o[g.row])&&(rt(),g.row=null,g.col=null)});O.value&&t.observe(O.value)}),xt.on(async(t,o)=>{t===Dt.FIELD_ADD&&(vo.value=o,Ze.value=!0),t===Dt.CLEAR_NEW_ROW&&(rt(),g.row=null,g.col=null,G==null||G(o))});async function ea(t){var o,c,L;if(qe.value=!0,(o=p.value)!=null&&o.length){const T=(L=(c=P.value)==null?void 0:c.columns)==null?void 0:L.map($=>$.title);p.value=p.value.filter($=>!(T!=null&&T.includes($.title)))}await ho(),await(f==null?void 0:f()),qe.value=!1}mt(ht,"scroll",()=>{_o()}),mt(document,"mousedown",t=>{var o,c;(t.offsetX>((o=t.target)==null?void 0:o.clientWidth)||t.offsetY>((c=t.target)==null?void 0:c.clientHeight))&&(Pe.value=!0)}),mt(document,"mouseup",()=>{setTimeout(()=>{Pe.value=!1},100)}),mt(document,"keydown",async t=>{const o=ut();t.key==="Alt"&&!o&&(kt.value=!0)}),mt(document,"keyup",async t=>{const o=ut();t.key==="Alt"&&!o&&(kt.value=!1,Tt.value=!1)}),mt(document,"keydown",async t=>{const o=io()?t.metaKey:t.ctrlKey;if(t.altKey&&!t.shiftKey&&!o)switch(t.keyCode){case 78:{ao.value&&Ct();break}}}),$o(async()=>{const t=m.value,o=D.value;t&&Mt(t.fk_model_id,!1,!0).then(c=>{const L=c;L&&ho({metaValue:L,viewMetaValue:t,data:o})}),Le==null||Le.off(ea),F==null||F.off(To)}),Le==null||Le.on(ea),F==null||F.on(To),Qt(bt,()=>{bt.value?Wt.value=!1:(Wt.value=!0,he.value=null)}),Qt(()=>ie.params.viewId,()=>{qe.value=!0}),Qt(m,async(t,o)=>{try{if(t&&t.id!==(o==null?void 0:o.id)&&(t.fk_model_id===ie.params.viewId||oe.value)){if(wo.value=!0,o!=null&&o.id){const c=await Mt(o.fk_model_id,!1,!0);c&&await ho({viewMetaValue:o,metaValue:c,data:D.value})}qe.value=!0;try{await(f==null?void 0:f())}catch(c){Ma.isCancel(c)||(console.log(c),ye.error(Oe("msg.errorLoadingData")))}finally{qe.value=!1}}}catch(c){console.log(c)}finally{wo.value=!1}},{immediate:!0}),je(Qn,Tt),w({scrollToRow:jo,openColumnCreate:Ta});const yo=(t,o)=>{Z&&Z(t,o),g.row=null,g.col=null,re.clear()},un=(t,o,c)=>{const L=D.value[o];if(ae.value)return yo(L,a.value[c]);ja(t,o,c)},cn=pe(()=>{var t,o,c,L;if(at.value)return(t=Y.value)!=null&&t.totalRows&&((o=Y.value)!=null&&o.pageSize)?`Loading page<br/>${Y.value.page} of ${Math.ceil(((c=Y.value)==null?void 0:c.totalRows)/((L=Y.value)==null?void 0:L.pageSize))}`:Oe("general.loading")});return ro("ArrowLeft",Zt),ro("ArrowRight",eo),ro("ArrowUp",to),ro("ArrowDown",oo),(t,o)=>{var oa,aa,na,ra,la,sa;const c=ir,L=xr,T=kr,$=Qr,le=Jr,se=cr,be=Ur,_e=yr,q=dr,et=Hr,Ke=pr,$t=In,_t=Pr,lt=mr,dn=Rr,pn=Sr,fn=Zr,mn=el,wn=Lr,vn=tl,ta=wr,gn=Tn,hn=vr,_n=ur,yn=Cr,bn=ol,xn=ga("xc-ver-resize"),Ve=ga("e");return n(),R("div",{class:ve(["flex flex-col",`${e(te)!==!0?"h-full w-full":""}`])},[al,h("div",{ref_key:"dragColPlaceholderDomRef",ref:Jt,class:ve([{"hidden w-0 !h-0 left-0 !max-h-0 !max-w-0":!e(nt)},"absolute flex items-center z-40 top-0 h-full bg-gray-50 pointer-events-none opacity-60"])},[e(nt)?(n(),R("div",{key:0,style:Be({"min-width":((oa=e(Ge)[e(nt).id])==null?void 0:oa.width)||"200px","max-width":((aa=e(Ge)[e(nt).id])==null?void 0:aa.width)||"200px",width:((na=e(Ge)[e(nt).id])==null?void 0:na.width)||"200px"}),class:"border-r-1 border-l-1 border-gray-200 h-full"},null,4)):W("",!0)],2),h("div",{ref_key:"gridWrapper",ref:ge,class:ve(["nc-grid-wrapper min-h-0 flex-1 relative",e(Ga)])},[we(h("div",nl,[h("div",rl,[ee(c,{size:"xlarge"}),h("span",{class:"text-center",innerHTML:e(cn)},null,8,ll)])],512),[[Ut,e(at)]]),ee(hn,{visible:e(bt),"onUpdate:visible":o[22]||(o[22]=v=>wt(bt)?bt.value=v:null),trigger:e(vt)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:N(()=>[ee(Ke,{class:"!rounded !py-0",onClick:o[21]||(o[21]=v=>bt.value=!1)},{default:N(()=>[e(Ro)&&!e(Wt)&&!e(he)&&t.data.some(v=>v.rowMeta.selected)?(n(),C(q,{key:0,onClick:o[15]||(o[15]=v=>s("bulkUpdateDlg"))},{default:N(()=>[we((n(),R("div",Pl,[(n(),C(St(e(Lt).edit))),De(" "+U(t.$t("title.updateSelectedRows")),1)])),[[Ve,["a:row:update-bulk"]]])]),_:1})):W("",!0),!e(Wt)&&!e(he)&&t.data.some(v=>v.rowMeta.selected)?(n(),C(q,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50","data-testid":"nc-delete-row",onClick:e(xe)},{default:N(()=>[we((n(),R("div",Bl,[(n(),C(St(e(Lt).delete))),De(U(t.$t("activity.deleteSelectedRow")),1)])),[[Ve,["a:row:delete-bulk"]]])]),_:1},8,["onClick"])):W("",!0),e(he)?(n(),C(q,{key:2,class:"nc-base-menu-item","data-testid":"context-menu-item-copy",onClick:o[16]||(o[16]=v=>e(qa)(e(he)))},{default:N(()=>[we((n(),R("div",Il,[ee(se,{icon:"copy"}),De(U(t.$t("general.copy")),1)])),[[Ve,["a:row:copy"]]])]),_:1})):W("",!0),e(he)&&e(ne)?(n(),C(q,{key:3,class:"nc-base-menu-item","data-testid":"context-menu-item-paste",disabled:e(Xt)(e(a)[e(he).col]),onClick:e(ce)},{default:N(()=>[we((n(),R("div",Ol,[ee(se,{icon:"paste"}),De(U(t.$t("general.paste")),1)])),[[Ve,["a:row:paste"]]])]),_:1},8,["disabled","onClick"])):W("",!0),e(he)&&e(ne)&&e(re).isSingleCell()&&(e(Do)(e(a)[e(he).col])||!e(st)(e(a)[e(he).col]))?(n(),C(q,{key:4,class:"nc-base-menu-item",disabled:e(Xt)(e(a)[e(he).col]),"data-testid":"context-menu-item-clear",onClick:o[17]||(o[17]=v=>Bo(e(he)))},{default:N(()=>[we((n(),R("div",Gl,[ee(se,{icon:"close"}),De(" "+U(t.$t("general.clear")),1)])),[[Ve,["a:row:clear"]]])]),_:1},8,["disabled"])):e(he)&&e(ne)?(n(),C(q,{key:5,class:"nc-base-menu-item",disabled:e(Xt)(e(a)[e(he).col]),"data-testid":"context-menu-item-clear",onClick:o[18]||(o[18]=v=>Xo())},{default:N(()=>[we((n(),R("div",Hl,[ee(se,{icon:"closeBox",class:"text-gray-500"}),De(" "+U(t.$t("general.clear")),1)])),[[Ve,["a:row:clear-range"]]])]),_:1},8,["disabled"])):W("",!0),e(he)&&e(re).isSingleCell()&&e(Te)("commentEdit")&&!e(ae)?(n(),R(Re,{key:6},[ee(ta),ee(q,{class:"nc-base-menu-item",onClick:o[19]||(o[19]=v=>tn(e(he).row))},{default:N(()=>[we((n(),R("div",Tl,[ee(gn,{class:"h-4 w-4"}),De(" "+U(t.$t("general.comment")),1)])),[[Ve,["a:row:comment"]]])]),_:1})],64)):W("",!0),e(ne)?(n(),R(Re,{key:7},[!e(Wt)&&!e(he)&&t.data.some(v=>v.rowMeta.selected)?W("",!0):(n(),C(ta,{key:0})),e(he)&&(e(re).isSingleCell()||e(re).isSingleRow())?(n(),C(q,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50",onClick:o[20]||(o[20]=v=>en(e(he).row))},{default:N(()=>[we((n(),R("div",Wl,[ee(se,{icon:"delete"}),De(U(t.$t("activity.deleteRow")),1)])),[[Ve,["a:row:delete"]]])]),_:1})):e(he)&&e(Ie)?(n(),C(q,{key:2,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50",onClick:on},{default:N(()=>[we((n(),R("div",Yl,[ee(se,{icon:"delete",class:"text-gray-500 text-red-600"}),De(U(t.$t("activity.deleteRows")),1)])),[[Ve,["a:row:delete"]]])]),_:1})):W("",!0)],64)):W("",!0)]),_:1})]),default:N(()=>[h("div",{class:ve(["table-overlay",{"nc-grid-skeleton-loader":e(no)}])},[h("table",{ref_key:"smartTable",ref:O,class:ve(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white relative",{mobile:e(ae),desktop:!e(ae),"pr-60 pb-12":!e(te)}]),onContextmenu:Fo},[we(h("thead",{ref_key:"tableHeadEl",ref:ke},[e(Ne)?(n(),R("tr",sl,[(n(!0),R(Re,null,it(e(Go),(v,z)=>(n(),R("td",{key:z,class:ve(["!bg-gray-50 h-full border-b-1 border-r-1",{"min-w-50":z!==0,"min-w-21.25":z===0}])},[ee(L,{active:!0,title:!0,paragraph:!1,class:ve(["ml-2 -mt-2",{"max-w-32":z!==0,"max-w-5 !ml-3.5":z===0}])},null,8,["class"])],2))),128))])):W("",!0),we(h("tr",il,[h("th",{class:"w-[85px] min-w-[85px]","data-testid":"grid-id-column",onDblclick:()=>{}},[h("div",ul,[e(M)?(n(),R("div",dl,"#")):(n(),R(Re,{key:0},[h("div",{class:ve(["nc-no-label text-gray-500",{hidden:e(X)}])},"#",2),h("div",{class:ve([{hidden:!e(X),flex:e(X)},"nc-check-all w-full items-center"])},[ee(T,{checked:e(X),"onUpdate:checked":o[0]||(o[0]=v=>wt(X)?X.value=v:null)},null,8,["checked"]),cl],2)],64))])],32),(n(!0),R(Re,null,it(e(a),(v,z)=>{var ft,yt,Yt;return we((n(),R("th",{key:v.title,"data-col":v.id,"data-title":v.title,style:Be({"min-width":((ft=e(Ge)[v.id])==null?void 0:ft.width)||"200px","max-width":((yt=e(Ge)[v.id])==null?void 0:yt.width)||"200px",width:((Yt=e(Ge)[v.id])==null?void 0:Yt.width)||"200px"}),class:ve(["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(Ht)===v.id}]),onXcstartresizing:Ue=>ln(v.id,Ue),onXcresize:Ue=>nn(v.id,Ue),onXcresizing:Ue=>rn(v.id,Ue),onClick:Ue=>an(v.id)},[h("div",{class:"w-full h-full flex items-center",draggable:e(ae)||z===0||e(M)||!e(ne)?"false":"true",onDragstart:Et(Ue=>e(dt)(v.id,Ue),["stop"]),onDrag:o[1]||(o[1]=Et(Ue=>e(Je)(Ue),["stop"]))},[e(st)(v)?(n(),C($,{key:0,column:v,"hide-menu":e(M)||e(ae)},null,8,["column","hide-menu"])):(n(),C(le,{key:1,column:v,"hide-menu":e(M)||e(ae)},null,8,["column","hide-menu"]))],40,fl)],46,pl)),[[xn]])}),128)),e(Ae)?we((n(),R("th",{key:0,class:"cursor-pointer !border-0 relative !xs:hidden",style:{borderWidth:"0px !important"},onClick:o[9]||(o[9]=Et(v=>Ze.value=!0,["stop"]))},[h("div",ml,[ee(dn,{visible:e(Ze),"onUpdate:visible":o[7]||(o[7]=v=>wt(Ze)?Ze.value=v:null),trigger:["click"],"overlay-class-name":"nc-dropdown-grid-add-column",onVisibleChange:o[8]||(o[8]=v=>Rt.value=e(kt))},Nn({default:N(()=>[h("div",wl,[e(Ro)&&(e(kt)||e(Rt))?(n(),C(se,{key:0,icon:"magic",class:"text-sm text-orange-400"})):W("",!0),(n(),C(St(e(Lt).plus),{class:"text-base nc-column-add text-gray-500 !group-hover:text-black"}))])]),_:2},[e(Ro)&&e(Rt)?{name:"overlay",fn:N(()=>[ee(Ke,null,{default:N(()=>{var v;return[(v=e(p))!=null&&v.length?(n(),C($t,{key:"predict-column"},{title:N(()=>[h("div",vl,[ee(be,{class:"flex h-[1rem] text-gray-500"}),h("div",gl,U(t.$t("activity.predictColumns")),1),ee(_e,{class:"text-gray-500 ml-2"})])]),expandIcon:N(()=>[]),default:N(()=>[ee(Ke,null,{default:N(()=>[(n(!0),R(Re,null,it(e(p),z=>(n(),C(q,{key:`predict-${z.title}-${z.type}`},{default:N(()=>[h("div",{class:"flex flex-row items-center py-3",onClick:ft=>Qo(z.title,z.type)},[h("div",_l,U(z.title),1)],8,hl)]),_:2},1024))),128)),ee(q,null,{default:N(()=>[h("div",{class:"flex flex-row items-center py-3",onClick:Q},[h("div",yl,[ee(et),De(" Generate Again ")])])]),_:1})]),_:1})]),_:1})):(n(),C(q,{key:1},{default:N(()=>[h("div",{class:"flex flex-row items-center py-3",onClick:Q},[e(u)?(n(),C(et,{key:0,class:"animate-infinite animate-spin"})):(n(),C(be,{key:1,class:"flex h-[1rem] text-gray-500"})),h("div",bl,U(t.$t("activity.predictColumns")),1)])]),_:1})),e(S)?(n(),C($t,{key:"predict-formula"},{title:N(()=>[h("div",xl,[ee(_t,{class:"flex h-[1rem] text-gray-500"}),h("div",kl,U(t.$t("activity.predictFormulas")),1),ee(_e,{class:"text-gray-500 ml-2"})])]),expandIcon:N(()=>[]),default:N(()=>[ee(Ke,null,{default:N(()=>[(n(!0),R(Re,null,it(e(S),z=>(n(),C(q,{key:`predict-${z.title}-formula`},{default:N(()=>[h("div",{class:"flex flex-row items-center py-3",onClick:ft=>Qo(z.title,"Formula",{formula_raw:z.formula})},[h("div",Cl,U(z.title),1)],8,Rl)]),_:2},1024))),128))]),_:1})]),_:1})):(n(),C(q,{key:3},{default:N(()=>[h("div",{class:"flex flex-row items-center py-3",onClick:Ce},[e(ue)?(n(),C(et,{key:0,class:"animate-infinite animate-spin"})):(n(),C(_t,{key:1,class:"flex h-[1rem] text-gray-500"})),h("div",Sl,U(t.$t("activity.predictFormulas")),1)])]),_:1}))]}),_:1})]),key:"0"}:{name:"overlay",fn:N(()=>[e(Ze)?(n(),C(lt,{key:0,preload:e(We),"column-position":e(vo),class:ve({hidden:e(Po)}),onSubmit:o[2]||(o[2]=v=>Ho(!0)),onCancel:o[3]||(o[3]=v=>Ho()),onClick:o[4]||(o[4]=Et(()=>{},["stop"])),onKeydown:o[5]||(o[5]=Et(()=>{},["stop"])),onMounted:o[6]||(o[6]=v=>We.value=void 0)},null,8,["preload","column-position","class"])):W("",!0)]),key:"1"}]),1032,["visible"])])])),[[Ve,["c:column:add"]]]):W("",!0)],512),[[Ut,!e(Ne)]])],512),[[Ut,e(B)!==!0]]),e(te)!==!0?(n(),R("tbody",{key:0,ref_key:"tableBodyEl",ref:fe},[e(no)?(n(!0),R(Re,{key:0},it(e(Ha),(v,z)=>(n(),R("tr",{key:z},[(n(!0),R(Re,null,it(e(Go),(ft,yt)=>(n(),R("td",{key:yt,class:ve(["border-b-1 border-r-1",{"min-w-50":yt!==0,"min-w-21.25":yt===0}])},null,2))),128))]))),128)):W("",!0),(n(!0),R(Re,null,it(e(D),(v,z)=>(n(),C(vn,{ref_for:!0,ref_key:"rowRefs",ref:I,key:z,row:v},{default:N(({state:ft})=>{var yt,Yt,Ue,ia;return[we(h("tr",{class:"nc-grid-row !xs:h-14",style:Be({height:t.rowHeight?`${t.rowHeight*1.8}rem`:"1.8rem"}),"data-testid":`grid-row-${z}`},[h("td",{key:"row-index",class:"caption nc-grid-cell pl-5 pr-1","data-testid":`cell-Id-${z}`,onContextmenu:o[10]||(o[10]=J=>he.value=null)},[h("div",$l,[h("div",{class:ve(["nc-row-no sm:min-w-4 text-xs text-gray-500",{toggle:!e(M),hidden:v.rowMeta.selected}])},U(((((yt=e(Y))==null?void 0:yt.page)??1)-1)*(((Yt=e(Y))==null?void 0:Yt.pageSize)??25)+z+1),3),e(M)?W("",!0):(n(),R("div",{key:0,class:ve([{hidden:!v.rowMeta.selected,flex:v.rowMeta.selected},"nc-row-expand-and-checkbox"])},[ee(T,{checked:v.rowMeta.selected,"onUpdate:checked":J=>v.rowMeta.selected=J},null,8,["checked","onUpdate:checked"])],2)),Ll,e(Te)("expandedForm")?(n(),R("div",{key:1,class:ve(["nc-expand",{"nc-comment":(Ue=v.rowMeta)==null?void 0:Ue.commentCount}]),"data-testid":`nc-expand-${z}`},[v.rowMeta.saving?(n(),C(pn,{key:0,class:"!flex items-center","data-testid":`row-save-spinner-${z}`},null,8,["data-testid"])):W("",!0),(ia=v.rowMeta)!=null&&ia.commentCount&&e(Z)?we((n(),R("span",{key:1,class:"py-1 px-3 rounded-full text-xs cursor-pointer select-none transform hover:scale-110",style:Be({backgroundColor:e(ha).light[v.rowMeta.commentCount%e(ha).light.length]}),onClick:J=>yo(v,ft)},[De(U(v.rowMeta.commentCount),1)],12,Al)),[[Ve,["c:expanded-form:open"]]]):v.rowMeta.saving?W("",!0):(n(),R("div",Vl,[e(Z)?we((n(),C(St(e(Lt).expand),{key:0,class:"select-none transform hover:text-black hover:scale-120 nc-row-expand",onClick:J=>yo(v,ft)},null,8,["onClick"])),[[Ve,["c:row-expand:open"]]]):W("",!0)]))],10,El)):W("",!0)])],40,Ml),(n(!0),R(Re,null,it(e(a),(J,Ye)=>{var ua,ca,da,pa,fa;return n(),C(wn,{key:J.id,class:ve(["cell relative nc-grid-cell cursor-pointer",{active:e(Yo)(z,Ye),"active-cell":e(g).row===z&&e(g).col===Ye||((ua=e(re)._start)==null?void 0:ua.row)===z&&((ca=e(re)._start)==null?void 0:ca.col)===Ye,"last-cell":z===(isNaN(e(re).end.row)?e(g).row:e(re).end.row)&&Ye===(isNaN(e(re).end.col)?e(g).col:e(re).end.col),"nc-required-cell":e(Fn)(J,v.row)&&!e(oe),"align-middle":!t.rowHeight||t.rowHeight===1,"align-top":t.rowHeight&&t.rowHeight!==1,filling:e(Qa)(z,Ye),readonly:(("isLookup"in t?t.isLookup:e(ba))(J)||("isRollup"in t?t.isRollup:e(xa))(J)||("isFormula"in t?t.isFormula:e(ka))(J)||e(wa)(J)||e(va)(J))&&e(ne)&&e(Yo)(z,Ye),"!border-r-blue-400 !border-r-3":e(Ht)===J.id}]),style:Be({"min-width":((da=e(Ge)[J.id])==null?void 0:da.width)||"200px","max-width":((pa=e(Ge)[J.id])==null?void 0:pa.width)||"200px",width:((fa=e(Ge)[J.id])==null?void 0:fa.width)||"200px"}),"data-testid":`cell-${J.title}-${z}`,"data-key":`data-key-${z}-${J.id}`,"data-col":J.id,"data-title":J.title,"data-row-index":z,"data-col-index":Ye,onMousedown:ze=>e(Ka)(ze,z,Ye),onMouseover:ze=>e(Ua)(ze,z,Ye),onClick:ze=>un(ze,z,Ye),onDblclick:ze=>Io(v,J),onContextmenu:ze=>Fo(ze,{row:z,col:Ye})},{default:N(()=>[e(wo)?W("",!0):(n(),R("div",zl,[e(st)(J)&&J.title?(n(),C(fn,{key:0,modelValue:v.row[J.title],"onUpdate:modelValue":ze=>v.row[J.title]=ze,column:J,active:e(g).col===Ye&&e(g).row===z,row:v,"read-only":!e(ne),onNavigate:qo,onSave:ze=>{var Kt;return(Kt=e(y))==null?void 0:Kt(v,"",ft)}},null,8,["modelValue","onUpdate:modelValue","column","active","row","read-only","onSave"])):J.title?(n(),C(mn,{key:1,modelValue:v.row[J.title],"onUpdate:modelValue":ze=>v.row[J.title]=ze,column:J,"edit-enabled":!!e(ne)&&!!e(Se)&&e(g).col===Ye&&e(g).row===z,"row-index":z,active:e(g).col===Ye&&e(g).row===z,"read-only":!e(ne),"onUpdate:editEnabled":o[11]||(o[11]=ze=>Se.value=ze),onSave:ze=>{var Kt;return(Kt=e(y))==null?void 0:Kt(v,J.title,ft)},onNavigate:qo,onCancel:o[12]||(o[12]=ze=>Se.value=!1)},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):W("",!0)]))]),_:2},1032,["class","style","data-testid","data-key","data-col","data-title","data-row-index","data-col-index","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])}),128))],12,Dl),[[Ut,!e(no)]])]}),_:2},1032,["row"]))),128)),e(ao)&&!e($e)?we((n(),R("tr",{key:1,class:ve(["text-left nc-grid-add-new-cell cursor-pointer group relative z-3 xs:hidden",{"!border-r-2 !border-r-gray-100":e(Oo)===1}]),onMouseup:o[13]||(o[13]=Et(()=>{},["stop"])),onClick:o[14]||(o[14]=v=>Ct())},[h("div",Nl,[e(Ne)?W("",!0):(n(),C(St(e(Lt).plus),{key:0,class:"text-pint-500 text-base ml-2 mt-0 text-gray-600 group-hover:text-black"}))]),h("td",{class:"!border-gray-100",colspan:e(Oo)},null,8,Fl)],34)),[[Ve,["c:row:add:grid-bottom"]]]):W("",!0)],512)):W("",!0)],34),we(h("div",{ref_key:"fillHandle",ref:He,class:ve(["nc-fill-handle",!e(re).isEmpty()&&e(re).end.col!==0||e(re).isEmpty()&&e(g).col!==0?"z-3":"z-4"]),style:Be({top:`${e(Jo)}px`,left:`${e(Zo)}px`,cursor:"crosshair"})},null,6),[[Ut,e(sn)]])],2)]),_:1},8,["visible","trigger"])],2),e(te)!==!0?(n(),C(bn,{key:e(ae),"pagination-data":e(Y),"onUpdate:paginationData":o[25]||(o[25]=v=>wt(Y)?Y.value=v:null),"show-api-timing":!e($e),"align-count-on-right":"","align-left":e($e),"change-page":e(E),"hide-sidebars":((ra=e(_))==null?void 0:ra.hideSidebars)===!0,"fixed-size":(la=e(_))==null?void 0:la.fixedSize,"extra-style":(sa=e(_))==null?void 0:sa.extraStyle},{"add-record":N(()=>[e(ao)&&!e(no)&&!e(at)?(n(),R("div",Kl,[e(ae)?we((n(),C(_n,{key:0,class:"nc-grid-add-new-row",type:"secondary",onClick:o[23]||(o[23]=v=>go())},{default:N(()=>[De(U(t.$t("activity.newRecord")),1)]),_:1})),[[Ve,[e(pt)?"c:row:add:grid":"c:row:add:form"]]]):we((n(),C(yn,{key:1,class:"nc-grid-add-new-row",placement:"top",onClick:o[24]||(o[24]=v=>e(pt)?Ct():go())},{overlay:N(()=>{var v;return[h("div",jl,[h("div",{class:ve(["absolute -top-19 flex flex-col min-h-34.5 w-70 p-1.5 bg-white rounded-lg border-1 border-gray-200 justify-start overflow-hidden",{"-left-44":!e(pt),"-left-32":e(pt)}]),style:{"box-shadow":"0px 4px 6px -2px rgba(0, 0, 0, 0.06), 0px -12px 16px -4px rgba(0, 0, 0, 0.1)"}},[we((n(),R("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-grid group",onClick:Ya},[h("div",ql,[h("div",Xl,[(n(),C(St((v=("viewIcons"in t?t.viewIcons:e(Pn))[e(Bn).GRID])==null?void 0:v.icon),{class:"nc-view-icon text-inherit"})),De(" "+U(t.$t("activity.newRecord"))+" - "+U(t.$t("objects.viewType.grid")),1)]),e(pt)?(n(),C(se,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):W("",!0)]),h("div",Ql,U(t.$t("labels.addRowGrid")),1)])),[[Ve,["c:row:add:grid"]]]),we((n(),R("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-form group",onClick:go},[h("div",Jl,[h("div",Zl,[ee(se,{class:"h-4.5 w-4.5",icon:"article"}),De(" "+U(t.$t("activity.newRecord"))+" - "+U(t.$t("objects.viewType.form")),1)]),e(pt)?W("",!0):(n(),C(se,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]),h("div",es,U(t.$t("labels.addRowForm")),1)])),[[Ve,["c:row:add:form"]]])],2)])]}),icon:N(()=>[(n(),C(St(e(Lt).arrowUp),{class:"text-gray-600 h-4 w-4"}))]),default:N(()=>[h("div",Ul,[h("span",null,[e(pt)?(n(),R(Re,{key:0},[De(U(t.$t("activity.newRecord")),1)],64)):(n(),R(Re,{key:1},[De(U(t.$t("activity.newRecord"))+" - "+U(t.$t("objects.viewType.form")),1)],64))])])]),_:1})),[[Ve,[e(pt)?"c:row:add:grid:toggle":"c:row:add:form:toggle"]]])])):W("",!0)]),_:1},8,["pagination-data","show-api-timing","align-left","change-page","hide-sidebars","fixed-size","extra-style"])):W("",!0)],2)}}});const zo=Ia(ts,[["__scopeId","data-v-86cd3084"]]),os=Ft({__name:"GroupByTable",props:{group:{},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},redistributeRows:{type:Function},depth:{},maxDepth:{},rowHeight:{},expandForm:{type:Function},paginationFixedSize:{},paginationHideSidebars:{type:Boolean},scrollLeft:{},viewWidth:{},scrollable:{}},emits:["update:paginationData"],setup(d,{emit:w}){const r=d,s=Mo(r,"group",w),X=Me(Lo,b()),Y=Me(Eo,b()),D=Me(fo,Vt());function _(B,A,P=X.value){if(B.nested||!B.rows)return;A=A??B.rows.length;const m=B.nestedIn.reduce((a,M)=>(M.key!=="__nc_null__"&&!Do(M.column_uidt)&&![x.Rollup,x.Lookup,x.Formula,x.Barcode,x.QrCode].includes(M.column_uidt)&&(a[M.title]=M.key),a),{});return B.rows.splice(A,0,{row:{...nr(P==null?void 0:P.columns),...m},oldRow:{},rowMeta:{new:!0}}),B.rows[A]}const f=pe(()=>!s.value.nested&&s.value.rows?s.value.rows:[]),{deleteRow:E,deleteSelectedRows:K,deleteRangeOfRows:y,updateOrSaveRow:de,bulkUpdateRows:Z,selectedAllRecords:xe,removeRowIfNew:Ie}=rr({meta:X,viewMeta:Y,formattedData:f,paginationData:b(s.value.paginationData),callbacks:{changePage:B=>r.loadGroupPage(s.value,B),loadData:()=>r.loadGroupData(s.value,!0),globalCallback:()=>{var B;return(B=r.redistributeRows)==null?void 0:B.call(r)}}}),G=async()=>{await r.loadGroupData(s.value,!0)};$o(async()=>{D==null||D.off(G)}),D==null||D.on(G),je(za,b(!0));const j=pe(()=>{if(r.scrollLeft&&r.viewWidth&&r.scrollable){const B=r.scrollable.scrollWidth;return r.scrollLeft+r.viewWidth>B?B-r.viewWidth:Math.max(Math.min(B-r.viewWidth,(r.scrollLeft??0)-24),0)}return 0}),te=pe(()=>({fixedSize:r.paginationFixedSize?r.paginationFixedSize-2:void 0,hideSidebars:r.paginationHideSidebars,extraStyle:`margin-left: ${j.value}px;`}));return(B,A)=>e(s).rows?(n(),C(zo,{key:0,"selected-all-records":e(xe),"onUpdate:selectedAllRecords":A[0]||(A[0]=P=>wt(xe)?xe.value=P:null),class:"nc-group-table",data:e(s).rows,"pagination-data":e(s).paginationData,"load-data":async()=>{},"change-page":P=>r.loadGroupPage(e(s),P),"call-add-empty-row":P=>_(e(s),P),"expand-form":r.expandForm,"row-height":B.rowHeight,"delete-row":e(E),"delete-selected-rows":e(K),"delete-range-of-rows":e(y),"update-or-save-row":e(de),"remove-row-if-new":e(Ie),"bulk-update-rows":e(Z),"hide-header":!0,pagination:e(te),"disable-skeleton":!0},null,8,["selected-all-records","data","pagination-data","load-data","change-page","call-add-empty-row","expand-form","row-height","delete-row","delete-selected-rows","delete-range-of-rows","update-or-save-row","remove-row-if-new","bulk-update-rows","pagination"])):W("",!0)}}),as=tt(()=>ot(()=>import("./VirtualCell.3d02a7f6.js"),["./VirtualCell.3d02a7f6.js","./entry.5958c07b.js","./entry.bdecbb78.css","./index.9b87fcff.js","./virtualCell.427fa223.js","./cell.165313cd.js"],import.meta.url).then(d=>d.default||d)),ns=tt(()=>ot(()=>import("./Cell.2a47fcd0.js"),["./Cell.2a47fcd0.js","./entry.5958c07b.js","./entry.bdecbb78.css","./index.9b87fcff.js","./cell.165313cd.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./useSmartsheetRowStore.5b92cc1b.js","./deepCompare.d32ec333.js","./dataUtils.3f874ca1.js","./virtualCell.427fa223.js","./index.e61e381a.js","./_plugin-vue_export-helper.c27b6911.js","./Cell.f27da8af.css"],import.meta.url).then(d=>d.default||d)),rs=tt(()=>ot(()=>import("./Row.3bf51c0f.js"),["./Row.3bf51c0f.js","./index.9b87fcff.js","./useSmartsheetRowStore.5b92cc1b.js","./entry.5958c07b.js","./entry.bdecbb78.css","./deepCompare.d32ec333.js","./dataUtils.3f874ca1.js","./virtualCell.427fa223.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./index.e61e381a.js","./useSmartsheetStore.f1a70558.js","./views.4281cbf1.js","./useSharedView.e8f68616.js"],import.meta.url).then(d=>d.default||d)),ls={class:"pointer-events-none"},ss=Ft({__name:"GroupByLabel",props:{column:{},modelValue:{}},setup(d){return je(Va,b(!0)),je(Jn,b(!0)),(w,r)=>{const V=as,s=ns,X=rs;return n(),R("div",ls,[ee(X,{row:{row:{[w.column.title]:w.modelValue},rowMeta:{}}},{default:N(()=>[e(st)(w.column)?(n(),C(V,{key:0,"model-value":w.modelValue,class:"!text-gray-600",column:w.column,"read-only":!0},null,8,["model-value","column"])):(n(),C(s,{key:1,"model-value":w.modelValue,class:"!text-gray-600",column:w.column,"edit-enabled":!1,"read-only":!0},null,8,["model-value","column"]))]),_:1},8,["row"])])}}}),is=tt(()=>ot(()=>import("./Pagination.cfda58a8.js"),["./Pagination.cfda58a8.js","./Pagination.c0f166a7.js","./Icon.vue.129448d5.js","./entry.5958c07b.js","./entry.bdecbb78.css","./Button.vue.c3ca0e8f.js","./index.55641318.js","./debounce.7c24f171.js","./toNumber.e09cd85a.js","./isSymbol.114fe557.js","./_plugin-vue_export-helper.c27b6911.js","./Button.ff10bcb0.css","./Tooltip.vue.971897f4.js","./Tooltip.b86f91a1.css","./index.5c6e4286.js","./toArray.fd74ce6f.js","./antInputDirective.8ac36ea7.js","./isMobile.e2e89480.js","./useMemo.1dd071d8.js","./useState.b891c8bb.js","./CheckOutlined.1fe5f230.js","./SearchOutlined.a517903c.js","./FormItemContext.ddc65fa5.js","./Pagination.fabf8b70.css","./views.4281cbf1.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./useSharedView.e8f68616.js","./index.9b87fcff.js","./sidebar.f5d81718.js","./index.025c8e21.js","./index.36af7517.js","./Element.a1e4f356.js","./Input.8209df88.js","./Image.c63a7a56.js","./index.ae235b22.js","./Input.dca3a2bc.js","./isPlainObject.ccda79fe.js","./_getPrototype.c1f3bae2.js","./TextArea.9074ff05.js","./Password.f52125e7.js","./Pagination.9422c247.css"],import.meta.url).then(d=>d.default||d)),us=d=>(La("data-v-0eb1164d"),d=d(),Ea(),d),cs={class:"flex flex-col h-full w-full"},ds={key:0,class:"flex sticky top-0 z-5"},ps={class:"flex !sticky left-[15px]"},fs={class:"flex items-center"},ms={role:"img","aria-label":"right",class:"anticon anticon-right ant-collapse-arrow"},ws=us(()=>h("path",{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"},null,-1)),vs=[ws],gs={class:"flex items-center"},hs={class:"flex flex-col"},_s={class:"flex gap-2"},ys={class:"text-xs nc-group-column-title"},bs={class:"text-xs text-gray-400 nc-group-row-count"},xs={class:"flex mt-1"},ks={key:1,class:"flex min-w-[100px] flex-wrap"},Rs={key:1,class:"text-gray-400"},Cs=Ft({__name:"GroupBy",props:{group:{},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},redistributeRows:{type:Function},viewWidth:{},scrollLeft:{},fullPage:{type:Boolean},depth:{},maxDepth:{},rowHeight:{},expandForm:{type:Function}},emits:["update:paginationData"],setup(d,{emit:w}){const r=d,s=Mo(r,"group",w),{isViewDataLoading:X,isPaginationLoading:Y}=zt(mo()),D=Me(fo,Vt()),_=r.depth??0,f=b(),E=b(),K=b(),y=pe(()=>{var m;return r.fullPage??(((m=K.value)==null?void 0:m.offsetWidth)??0)>(r.viewWidth??0)}),de=b(),Z=pe(()=>de.value?Array.isArray(de.value)?de.value.map(m=>m.replace("group-panel-","")):[de.value.replace("group-panel-","")]:[]),xe=b([]),Ie=m=>{var a,M;if(m=Array.isArray(m)?m:[m],m.length>0&&s.value.children&&!xe.value.includes(m[m.length-1])){const l=m[m.length-1].replace("group-panel-",""),oe=s.value.children[l];oe&&(oe.nested?(a=oe.children)!=null&&a.length||r.loadGroups({},oe):(M=oe.rows)!=null&&M.length||r.loadGroupData(oe))}xe.value=m},G=()=>{s.value.nested?r.loadGroups({},s.value):r.loadGroupData(s.value,!0)};$o(async()=>{D==null||D.off(G)}),D==null||D.on(G),Qt([()=>s.value.key],async(m,a)=>{m!==a&&(X.value=!0,Y.value=!0,s.value.nested?await r.loadGroups({},s.value):await r.loadGroupData(s.value,!0),X.value=!1,Y.value=!1)},{immediate:!0}),s.value.root===!0&&je(Na,f);const j=b(),te=pe(()=>{if(s.value.root===!0)return j.value??0;if(r.scrollLeft&&r.viewWidth&&E.value){const m=E.value.scrollWidth+12+12;return r.scrollLeft+r.viewWidth>m?m-r.viewWidth:Math.max(Math.min(m-r.viewWidth,(r.scrollLeft??0)-12),0)}return 0}),B=m=>{s.value.root&&(j.value=m.target.scrollLeft)},A=m=>{var M,l,oe,$e,ie,Le,F,ae,Ee;let a=m.key.toString();if(a&&((M=m.column)==null?void 0:M.uidt)===x.Lookup||((l=m.column)==null?void 0:l.uidt)===x.LinkToAnotherRecord)try{a=JSON.parse(a)}catch{return a.split("___")}if(a&&((oe=m.column)==null?void 0:oe.uidt)===x.DateTime)return[_a(a,`${((ie=Nt(($e=m.column)==null?void 0:$e.meta))==null?void 0:ie.date_format)??Da[0]} ${((F=Nt((Le=m.column)==null?void 0:Le.meta))==null?void 0:F.time_format)??So[0]}`)];if(a&&((ae=m.column)==null?void 0:ae.uidt)===x.Time)return[_a(a,So[0],!1)];if(a&&[x.User,x.CreatedBy,x.LastModifiedBy].includes((Ee=m.column)==null?void 0:Ee.uidt))try{return[JSON.parse(a)]}catch{return null}return[a]},P=m=>[x.Lookup,x.Attachment,x.Barcode,x.QrCode,x.Links,x.User,x.DateTime,x.CreatedTime,x.LastModifiedTime,x.CreatedBy,x.LastModifiedBy].includes(m==null?void 0:m.uidt);return(m,a)=>{const M=$r,l=Dr,oe=Mr,$e=is;return n(),R("div",cs,[h("div",{ref_key:"wrapper",ref:f,class:"flex flex-col h-full w-full scrollbar-thin-dull overflow-auto",style:Be(`${!e(s).root&&e(s).nested?"padding-left: 12px; padding-right: 12px;":""}`),onScroll:B},[h("div",{ref_key:"scrollable",ref:E,class:ve(["flex flex-col h-full",{"my-2":e(s).root!==!0}]),style:Be(`${e(s).root===!0?"width: fit-content":"width: 100%"}`)},[e(s).root===!0?(n(),R("div",ds,[h("div",{class:"bumper mb-2",style:Be([{"background-color":"#f9f9fa","border-color":"#e7e7e9","border-bottom-width":"1px"},{"padding-left":`${(m.maxDepth||1)*13}px`}])},null,4),ee(zo,{ref_key:"tableHeader",ref:K,class:"mb-2",data:[],"header-only":!0},null,512)])):W("",!0),h("div",{class:ve({"px-[12px]":e(s).root===!0})},[ee(oe,{activeKey:e(de),"onUpdate:activeKey":a[0]||(a[0]=ie=>wt(de)?de.value=ie:null),class:"!bg-transparent w-full nc-group-wrapper",bordered:!1,"destroy-inactive-panel":"",onChange:Ie},{default:N(()=>{var ie;return[(n(!0),R(Re,null,it(Object.entries(((ie=e(s))==null?void 0:ie.children)??[]),([Le,F])=>(n(),C(l,{key:`group-panel-${Le}`,class:ve(["!border-1 nc-group rounded-[12px]",{"mb-4":e(s).children&&+Le!==e(s).children.length-1}]),style:Be(`background: rgb(${245-e(_)*10}, ${245-e(_)*10}, ${245-e(_)*10})`),"show-arrow":!1},{header:N(()=>[h("div",ps,[h("div",fs,[h("span",ms,[(n(),R("svg",{focusable:"false","data-icon":"right",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",viewBox:"64 64 896 896",style:Be(`${e(Z).includes(Le)?"transform: rotate(90deg)":""}`)},vs,4))])]),h("div",gs,[h("div",hs,[h("div",_s,[h("div",ys,U(F.column.title),1),h("div",bs,"("+U(m.$t("datatype.Count"))+": "+U(F.count)+")",1)]),h("div",xs,[F.column.uidt==="MultiSelect"?(n(!0),R(Re,{key:0},it(Object.entries(F.key.split(",")),([ae,Ee])=>(n(),C(M,{key:`panel-tag-${F.column.id}-${Ee}`,class:"!py-0 !px-[12px] !rounded-[12px]",color:F.color.split(",")[+ae]},{default:N(()=>[h("span",{class:"nc-group-value",style:Be({color:e(so).isReadable(F.color.split(",")[+ae]||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(so).mostReadable(F.color.split(",")[+ae]||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"14px","font-weight":500})},U(Ee in e(jt).VAR_TITLES?e(jt).VAR_TITLES[Ee]:Ee),5)]),_:2},1032,["color"]))),128)):!(F.key in e(jt).VAR_TITLES)&&P(F.column)?(n(),R("div",ks,[(n(!0),R(Re,null,it(A(F),(ae,Ee)=>(n(),R(Re,{key:Ee},[ae?(n(),C(ss,{key:0,column:F.column,"model-value":ae},null,8,["column","model-value"])):(n(),R("span",Rs,"No mapped value"))],64))),128))])):(n(),C(M,{key:`panel-tag-${F.column.id}-${F.key}`,class:ve(["!py-0 !px-[12px]",`${F.column.uidt==="SingleSelect"?"!rounded-[12px]":"!rounded-[6px]"}`]),color:F.color},{default:N(()=>{var ae;return[h("span",{class:"nc-group-value",style:Be({color:e(so).isReadable(F.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(so).mostReadable(F.color||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"14px","font-weight":500})},[F.key in e(jt).VAR_TITLES?(n(),R(Re,{key:0},[De(U(e(jt).VAR_TITLES[F.key]),1)],64)):(n(),R(Re,{key:1},[De(U((ae=A(F))==null?void 0:ae.join(", ")),1)],64))],4)]}),_:2},1032,["class","color"]))])])])])]),default:N(()=>[!F.nested&&F.rows?(n(),C(os,{key:0,group:F,"load-groups":m.loadGroups,"load-group-data":m.loadGroupData,"load-group-page":m.loadGroupPage,"group-wrapper-change-page":m.groupWrapperChangePage,"row-height":m.rowHeight,"redistribute-rows":m.redistributeRows,"expand-form":m.expandForm,"pagination-fixed-size":e(y)?r.viewWidth:void 0,"pagination-hide-sidebars":!0,"scroll-left":r.scrollLeft||e(j),"view-width":m.viewWidth,scrollable:e(E),"full-page":e(y)},null,8,["group","load-groups","load-group-data","load-group-page","group-wrapper-change-page","row-height","redistribute-rows","expand-form","pagination-fixed-size","scroll-left","view-width","scrollable","full-page"])):(n(),C(Oa,{key:1,group:F,"load-groups":m.loadGroups,"load-group-data":m.loadGroupData,"load-group-page":m.loadGroupPage,"group-wrapper-change-page":m.groupWrapperChangePage,"row-height":m.rowHeight,"redistribute-rows":m.redistributeRows,"expand-form":m.expandForm,"view-width":m.viewWidth,depth:e(_)+1,"scroll-left":e(te),"full-page":e(y)},null,8,["group","load-groups","load-group-data","load-group-page","group-wrapper-change-page","row-height","redistribute-rows","expand-form","view-width","depth","scroll-left","full-page"]))]),_:2},1032,["class","style"]))),128))]}),_:1},8,["activeKey"])],2)],6)],36),e(s).root?(n(),C($e,{key:0,"pagination-data":e(s).paginationData,"onUpdate:paginationData":a[1]||(a[1]=ie=>e(s).paginationData=ie),"align-count-on-right":"","custom-label":"groups","show-api-timing":"","change-page":ie=>m.groupWrapperChangePage(ie,e(s)),style:Be(`${r.depth&&r.depth>0?"border-radius: 0 0 12px 12px !important;":""}`)},null,8,["pagination-data","change-page","style"])):(n(),C($e,{key:1,"pagination-data":e(s).paginationData,"onUpdate:paginationData":a[2]||(a[2]=ie=>e(s).paginationData=ie),"align-count-on-right":"","custom-label":"groups","show-api-timing":"","change-page":ie=>m.groupWrapperChangePage(ie,e(s)),"hide-sidebars":!0,style:Be(`${r.depth&&r.depth>0?"border-radius: 0 0 12px 12px !important;":""}margin-left: ${e(te)}px;`),"fixed-size":e(y)?r.viewWidth:void 0},null,8,["pagination-data","change-page","style","fixed-size"]))])}}});const Oa=Ia(Cs,[["__scopeId","data-v-0eb1164d"]]),Ss=tt(()=>ot(()=>import("./index.caa4cb22.js").then(d=>d.i),["./index.caa4cb22.js","./entry.5958c07b.js","./entry.bdecbb78.css","./Button.vue.c3ca0e8f.js","./index.55641318.js","./debounce.7c24f171.js","./toNumber.e09cd85a.js","./isSymbol.114fe557.js","./_plugin-vue_export-helper.c27b6911.js","./Button.ff10bcb0.css","./Icon.vue.129448d5.js","./Menu.vue.6c65c050.js","./Menu.eff4a609.css","./Divider.7b1fba82.js","./index.07078df6.js","./Divider.3e739d27.css","./Dropdown.vue.0d2ed10f.js","./index.dc13a4d6.js","./Dropdown.041b2468.js","./RightOutlined.7161c742.js","./DivDataCell.7c09732c.js","./index.9b87fcff.js","./DivDataCell.1a716a1e.css","./Tooltip.vue.971897f4.js","./Tooltip.b86f91a1.css","./UserIcon.74e37fbe.js","./UserIcon.fda3e825.css","./config.c8203633.js","./sidebar.f5d81718.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./views.4281cbf1.js","./useSharedView.e8f68616.js","./dataUtils.3f874ca1.js","./index.e61e381a.js","./useKanbanViewStore.9f7f1dc5.js","./deepCompare.d32ec333.js","./useSmartsheetStore.f1a70558.js","./useSmartsheetRowStore.5b92cc1b.js","./virtualCell.427fa223.js","./iconify.e2b5aaa4.js","./index.ae235b22.js","./Input.dca3a2bc.js","./antInputDirective.8ac36ea7.js","./FormItemContext.ddc65fa5.js","./SearchOutlined.a517903c.js","./isPlainObject.ccda79fe.js","./_getPrototype.c1f3bae2.js","./TextArea.9074ff05.js","./Password.f52125e7.js","./Modal.vue.0f13e4cb.js","./DeleteModal.7ab6f524.css","./DeleteModal.vue.0320a9db.js","./Modal.vue.ee5af191.js","./useDashboard.7eae7d45.js","./index.c35df397.js","./Input.8209df88.js","./Element.a1e4f356.js","./index.35cd520e.css"],import.meta.url).then(d=>d.default||d)),Ds=tt(()=>ot(()=>import("./BulkUpdate.52ab0565.js"),["./BulkUpdate.52ab0565.js","./_plugin-vue_export-helper.c27b6911.js","./entry.5958c07b.js","./entry.bdecbb78.css"],import.meta.url).then(d=>d.default||d)),ou=Ft({__name:"index",setup(d,{expose:w}){const r=Me(Lo,b()),V=Me(Eo,b()),s=Me(fo,Vt());Me(Aa,b([]));const X=Gn(),Y=X.currentRoute,{xWhere:D,eventBus:_}=Ao(),{t:f}=po(),E=b(!1),K=pe(()=>Y.value.query),y=b(!1),de=b(),Z=b(),xe=b(),{loadData:Ie,paginationData:G,formattedData:j,updateOrSaveRow:te,changePage:B,addEmptyRow:A,deleteRow:P,deleteSelectedRows:m,selectedAllRecords:a,removeRowIfNew:M,navigateToSiblingRow:l,getExpandedRowIndex:oe,deleteRangeOfRows:$e,bulkUpdateRows:ie,bulkUpdateView:Le,optimisedQuery:F,islastRow:ae,isFirstRow:Ee}=lr(r,V,D),ct=pe(()=>{var S,k,H,Q;if(((k=(S=V.value)==null?void 0:S.view)==null?void 0:k.row_height)!==void 0)switch((Q=(H=V.value)==null?void 0:H.view)==null?void 0:Q.row_height){case 0:return 1;case 1:return 2;case 2:return 4;case 3:return 6;default:return 1}});je(Zn,b(!1)),je(er,b(!1)),je(tr,b(!0)),je(or,ct),je(ar,s);const vt=b(!1);function xt(S,k,H=!1){var Ce;const Q=At(S.row,(Ce=r.value)==null?void 0:Ce.columns);Q?(Z.value=k,X.push({query:{...K.value,rowId:Q}})):(de.value=S,Z.value=k,y.value=!0,vt.value=!H)}w({loadData:Ie,openColumnCreate:S=>{var k;(k=xe.value)==null||k.openColumnCreate(S)}});const at=pe({get(){return!!K.value.rowId},set(S){S||X.push({query:{...K.value,rowId:void 0}})}}),gt=S=>{vt.value||_.emit(Dt.CLEAR_NEW_ROW,S)},Oe=()=>{F.value?(F.value=!1,ye.info(f("msg.optimizedQueryDisabled"))):(F.value=!0,ye.info(f("msg.optimizedQueryEnabled")))},{rootGroup:Mt,groupBy:Pt,isGroupBy:Xe,loadGroups:Bt,loadGroupData:It,loadGroupPage:Ot,groupWrapperChangePage:Ge,redistributeRows:Gt}=sr(V,D),i=b(),u=b(0);_.on(S=>{S===Dt.GROUP_BY_RELOAD&&(s==null||s.trigger())}),$a(()=>{Hn(i).toBeTruthy().then(()=>{const S=new ResizeObserver(()=>{var k;u.value=((k=i.value)==null?void 0:k.clientWidth)||0});i.value&&S.observe(i.value)})});const p=()=>{var k,H;const S=oe();if(!G.value.isLastPage&&S===G.value.pageSize){const Q=(k=G.value)!=null&&k.page?((H=G.value)==null?void 0:H.page)+1:1;B(Q)}l(co.NEXT)},ue=()=>{var k,H;const S=oe();if(!G.value.isFirstPage&&S===1){const Q=(k=G.value)!=null&&k.page?((H=G.value)==null?void 0:H.page)-1:1;B(Q)}l(co.PREV)};return(S,k)=>{const H=Ss,Q=Wn,Ce=Ds;return n(),R("div",{ref_key:"coreWrapperRef",ref:i,class:"relative flex flex-col h-full min-h-0 w-full nc-grid-wrapper","data-testid":"nc-grid-wrapper",style:{"background-color":"var(--nc-grid-bg)"}},[e(Xe)?(n(),C(Oa,{key:1,group:e(Mt),"load-groups":e(Bt),"load-group-data":e(It),"load-group-page":e(Ot),"group-wrapper-change-page":e(Ge),"row-height":e(ct),"max-depth":e(Pt).length,"redistribute-rows":e(Gt),"expand-form":xt,"view-width":e(u)},null,8,["group","load-groups","load-group-data","load-group-page","group-wrapper-change-page","row-height","max-depth","redistribute-rows","view-width"])):(n(),C(zo,{key:0,ref_key:"tableRef",ref:xe,"selected-all-records":e(a),"onUpdate:selectedAllRecords":k[0]||(k[0]=ce=>wt(a)?a.value=ce:null),data:e(j),"pagination-data":e(G),"load-data":e(Ie),"change-page":e(B),"call-add-empty-row":e(A),"delete-row":e(P),"update-or-save-row":e(te),"delete-selected-rows":e(m),"delete-range-of-rows":e($e),"bulk-update-rows":e(ie),"remove-row-if-new":e(M),"expand-form":xt,"row-height":e(ct),onToggleOptimisedQuery:Oe,onBulkUpdateDlg:k[1]||(k[1]=ce=>E.value=!0)},null,8,["selected-all-records","data","pagination-data","load-data","change-page","call-add-empty-row","delete-row","update-or-save-row","delete-selected-rows","delete-range-of-rows","bulk-update-rows","remove-row-if-new","row-height"])),(n(),C(ya,null,{default:N(()=>[e(de)&&e(y)?(n(),C(H,{key:0,modelValue:e(y),"onUpdate:modelValue":[k[2]||(k[2]=ce=>wt(y)?y.value=ce:null),k[3]||(k[3]=ce=>gt(e(de)))],row:e(de),state:e(Z),meta:e(r),view:e(V)},null,8,["modelValue","row","state","meta","view"])):W("",!0)]),_:1})),e(at)?(n(),C(Q,{key:2,modelValue:e(at),"onUpdate:modelValue":k[4]||(k[4]=ce=>wt(at)?at.value=ce:null),row:{row:{},oldRow:{},rowMeta:{}},meta:e(r),state:e(Z),"row-id":e(K).rowId,view:e(V),"show-next-prev-icons":"","first-row":e(Ee),"last-row":e(ae),onNext:k[5]||(k[5]=ce=>p()),onPrev:k[6]||(k[6]=ce=>ue())},null,8,["modelValue","meta","state","row-id","view","first-row","last-row"])):W("",!0),(n(),C(ya,null,{default:N(()=>[e(E)?(n(),C(Ce,{key:0,modelValue:e(E),"onUpdate:modelValue":k[7]||(k[7]=ce=>wt(E)?E.value=ce:null),"pagination-data":e(G),meta:e(r),view:e(V),"bulk-update-rows":e(ie),"bulk-update-view":e(Le),"selected-all-records":e(a),rows:e(j).filter(ce=>ce.rowMeta.selected)},null,8,["modelValue","pagination-data","meta","view","bulk-update-rows","bulk-update-view","selected-all-records","rows"])):W("",!0)]),_:1}))],512)}}});export{ou as default};
