import{cG as e,gy as X,gz as lt,gl as _t,f as st,aF as yt,r as x,ba as Fe,e8 as gt,bF as ot,g as B,O as o,o as d,P as y,W as We,c as b,ae as Tt,Q as Y,S as be,cb as W,bb as le,aM as bt,cZ as kt,gA as ht,H as Ee,X as $e,Y as Ae,fk as xt,C as nt,bu as wt,M as Ct,i as He,l as Dt,c9 as Ft,U as Z,V as Le,a as E,t as q,au as ge,w as U,b as Ve,R as J,T as D,d as Te,gB as Lt,a9 as Vt,a0 as Mt,a1 as St}from"./entry.96205fa0.js";import{_ as Ut}from"./Select.vue.5a200a6a.js";import{_ as Bt}from"./Button.vue.02ce6d5b.js";import{_ as Ot}from"./FieldListAutoCompleteDropdown.vue.f84f4d57.js";import{_ as Rt}from"./Tooltip.vue.00c0d0fb.js";import{C as $t,E as At,i as Nt,m as jt,c as It,R as it,b as ut,M as rt,A as dt,G as Pt}from"./index.9b87fcff.js";import{x as Ye,c as Qe,d as Xe,m as Ze,l as Je,h as Et,g as zt,D as Gt,n as qt,t as Wt,u as Ht,s as Yt,p as Qt,E as Xt,y as Zt,j as Jt,w as Kt,F as ea}from"./cell.810c4fd3.js";import{a as ct,b as ta,f as aa,e as la}from"./bases.965a49bb.js";import sa from"./SingleSelect.47af94ce.js";import Ke from"./MultiSelect.b96d67b5.js";import oa from"./DatePicker.283bce89.js";import na from"./YearPicker.ad24df06.js";import ia from"./TimePicker.d85b8110.js";import{_ as ua}from"./Rating.vue.d4dc8d9d.js";import ra from"./Duration.d9c03913.js";import da from"./Percent.fb3d8d9f.js";import ca from"./Currency.f8cd98cd.js";import et from"./Decimal.6df51c36.js";import tt from"./Integer.baa7a240.js";import ma from"./Float.abb61a7f.js";import{_ as pa}from"./Text.vue.60b702e7.js";import at from"./User.f2b140f5.js";import{_ as fa,S as va}from"./index.b5e393d6.js";import{_ as mt}from"./_plugin-vue_export-helper.c27b6911.js";import{a as pt}from"./useSmartsheetStore.7d51347e.js";import{u as _a}from"./useViewColumns.8927231f.js";import{i as ya}from"./index.5b05c4cf.js";import{C as ga}from"./index.0b4c0f1e.js";const Ta=n=>lt(n)||n===e.Time?"=":[e.SingleSelect,e.Collaborator,e.LinkToAnotherRecord,e.Date,e.DateTime].includes(n)?"is":"is equal",ba=n=>lt(n)||n===e.Time?"!=":[e.SingleSelect,e.Collaborator,e.LinkToAnotherRecord,e.Date,e.DateTime].includes(n)?"is not":"is not equal",ka=n=>n===e.Attachment?"filenames contain":"is like",ha=n=>n===e.Attachment?"filenames doesn't contain":"is not like",xa=n=>[e.Date,e.DateTime].includes(n)?"is after":">",wa=n=>[e.Date,e.DateTime].includes(n)?"is before":"<",Ca=n=>[e.Date,e.DateTime].includes(n)?"is on or after":">=",Da=n=>[e.Date,e.DateTime].includes(n)?"is on or before":"<=",Me=(n,F)=>[{text:"is checked",value:"checked",ignoreVal:!0,includedTypes:[e.Checkbox]},{text:"is not checked",value:"notchecked",ignoreVal:!0,includedTypes:[e.Checkbox]},{text:Ta(n),value:"eq",ignoreVal:!1,excludedTypes:[e.Checkbox,e.MultiSelect,e.Attachment,e.User,e.CreatedBy,e.LastModifiedBy]},{text:ba(n),value:"neq",ignoreVal:!1,excludedTypes:[e.Checkbox,e.MultiSelect,e.Attachment,e.User,e.CreatedBy,e.LastModifiedBy]},{text:ka(n),value:"like",ignoreVal:!1,excludedTypes:[e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Date,e.DateTime,e.Time,...X]},{text:ha(n),value:"nlike",ignoreVal:!1,excludedTypes:[e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Date,e.DateTime,e.Time,...X]},{text:"is empty",value:"empty",ignoreVal:!0,excludedTypes:[e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Attachment,e.LinkToAnotherRecord,e.Lookup,e.Date,e.DateTime,e.Time,...X]},{text:"is not empty",value:"notempty",ignoreVal:!0,excludedTypes:[e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Attachment,e.LinkToAnotherRecord,e.Lookup,e.Date,e.DateTime,e.Time,...X]},{text:"is null",value:"null",ignoreVal:!0,excludedTypes:[...X,e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Attachment,e.LinkToAnotherRecord,e.Lookup,e.Date,e.DateTime,e.Time]},{text:"is not null",value:"notnull",ignoreVal:!0,excludedTypes:[...X,e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Attachment,e.LinkToAnotherRecord,e.Lookup,e.Date,e.DateTime,e.Time]},{text:"contains all of",value:"allof",ignoreVal:!1,includedTypes:[e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy]},{text:"contains any of",value:"anyof",ignoreVal:!1,includedTypes:[e.MultiSelect,e.SingleSelect,e.User,e.CreatedBy,e.LastModifiedBy]},{text:"does not contain all of",value:"nallof",ignoreVal:!1,includedTypes:[e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy]},{text:"does not contain any of",value:"nanyof",ignoreVal:!1,includedTypes:[e.MultiSelect,e.SingleSelect,e.User,e.CreatedBy,e.LastModifiedBy]},{text:xa(n),value:"gt",ignoreVal:!1,includedTypes:[...X,e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime,e.Time]},{text:wa(n),value:"lt",ignoreVal:!1,includedTypes:[...X,e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime,e.Time]},{text:Ca(n),value:"gte",ignoreVal:!1,includedTypes:[...X,e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime,e.Time]},{text:Da(n),value:"lte",ignoreVal:!1,includedTypes:[...X,e.Date,e.DateTime,e.Time]},{text:"is within",value:"isWithin",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"is blank",value:"blank",ignoreVal:!0,excludedTypes:[e.Checkbox,e.Links,e.Rollup]},{text:"is not blank",value:"notblank",ignoreVal:!0,excludedTypes:[e.Checkbox,e.Links,e.Rollup]}],Ne=(n,F)=>{const g=F&&_t(F);return n==="isWithin"?[{text:"the past week",value:"pastWeek",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the past month",value:"pastMonth",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the past year",value:"pastYear",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the next week",value:"nextWeek",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the next month",value:"nextMonth",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the next year",value:"nextYear",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the next number of days",value:"nextNumberOfDays",ignoreVal:!1,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the past number of days",value:"pastNumberOfDays",ignoreVal:!1,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]}]:[{text:"today",value:"today",ignoreVal:!0,includedTypes:[...g?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"tomorrow",value:"tomorrow",ignoreVal:!0,includedTypes:[...g?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"yesterday",value:"yesterday",ignoreVal:!0,includedTypes:[...g?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"one week ago",value:"oneWeekAgo",ignoreVal:!0,includedTypes:[...g?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"one week from now",value:"oneWeekFromNow",ignoreVal:!0,includedTypes:[...g?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"one month ago",value:"oneMonthAgo",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"one month from now",value:"oneMonthFromNow",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"number of days ago",value:"daysAgo",ignoreVal:!1,includedTypes:[...g?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"number of days from now",value:"daysFromNow",ignoreVal:!1,includedTypes:[...g?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:g?"exact month":"exact date",value:"exactDate",ignoreVal:!1,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]}]},Fa=st({__name:"FilterInput",props:{column:{},filter:{}},emits:["updateFilterValue"],setup(n,{emit:F}){var oe,z;const g=n,L=F,h=yt(g,"column"),K=x(!0);Fe($t,h),Fe(At,gt(K)),Fe(Nt,x(!1));const w={isSingleSelect:zt,isMultiSelect:Gt,isDate:Qe,isYear:Je,isDateTime:Xe,isTime:Ze,isRating:qt,isDuration:Wt,isPercent:Ht,isCurrency:Yt,isDecimal:Qt,isReadonlyDateTime:Xt,isInt:Ye,isFloat:Zt,isTextArea:Jt,isLinks:_=>_.uidt===e.Links,isUser:Kt,isReadonlyUser:ea},{sqlUis:se}=ot(ct()),V=x((oe=h.value)!=null&&oe.source_id?se.value[(z=h.value)==null?void 0:z.source_id]:Object.values(se.value)[0]),R=B(()=>h.value&&V.value.getAbstractType(h.value)),ue=_=>{const i=w[_];return!h.value||!i?!1:i(h.value,R)},C=B({get:()=>g.filter.value,set:_=>{L("updateFilterValue",_)}}),N=[{value:!0,label:"true"},{value:!1,label:"false"},{value:null,label:"unset"}],M=_=>["anyof","nanyof"].includes(_)?Ke:sa,H=_=>["daysAgo","daysFromNow","pastNumberOfDays","nextNumberOfDays"].includes(_)?et:oa,ee=B(()=>({isSingleSelect:M(g.filter.comparison_op),isMultiSelect:Ke,isDate:H(g.filter.comparison_sub_op),isYear:na,isDateTime:H(g.filter.comparison_sub_op),isReadonlyDateTime:H(g.filter.comparison_sub_op),isTime:ia,isRating:ua,isDuration:ra,isPercent:da,isCurrency:ca,isDecimal:et,isInt:tt,isFloat:ma,isLinks:tt,isUser:at,isReadonlyUser:at})),j=B(()=>Object.keys(ee.value).find(_=>ue(_))),fe=B(()=>{switch(j.value){case"isSingleSelect":case"isMultiSelect":return{disableOptionCreation:!0};case"isPercent":case"isDecimal":case"isFloat":case"isLinks":case"isInt":return{class:"h-32px"};case"isDuration":return{showValidationError:!1};case"isUser":return{forceMulti:!0};case"isReadonlyUser":return["anyof","nanyof"].includes(g.filter.comparison_op)?{forceMulti:!0}:{};default:return{}}}),re=B(()=>{var _;return h.value&&(((_=h.value)==null?void 0:_.uidt)===e.Links||Ye(h.value,R)||Qe(h.value,R)||Xe(h.value,R)||Ze(h.value,R)||Je(h.value,R))}),I=x(!1);return Fe(jt,x(!0)),Fe(It,x(!0)),(_,i)=>{const te=fa;return o(h)&&o(Et)(o(h),o(R))?(d(),y(te,{key:0,value:o(C),"onUpdate:value":i[0]||(i[0]=P=>We(C)?C.value=P:null),disabled:_.filter.readOnly,options:N},null,8,["value","disabled"])):(d(),b("div",{key:1,class:be(["bg-white border-1 flex flex-grow min-h-4 h-full items-center nc-filter-input-wrapper !rounded-lg",{"px-2":o(re),"border-brand-500":o(I)}]),onMouseup:i[4]||(i[4]=W(()=>{},["stop"]))},[(d(),y(Y(o(j)?o(ee)[o(j)]:pa),Tt({modelValue:o(C),"onUpdate:modelValue":i[1]||(i[1]=P=>We(C)?C.value=P:null),disabled:_.filter.readOnly,placeholder:"Enter a value",column:o(h),class:"flex"},o(fe),{location:"filter",onFocus:i[2]||(i[2]=P=>I.value=!0),onBlur:i[3]||(i[3]=P=>I.value=!1)}),null,16,["modelValue","disabled","column"]))],34))}}});const La=mt(Fa,[["__scopeId","data-v-ffc096e1"]]);function Va(n,F,g,L,h,K,w){const se=x(h),V=x({}),R=le(it),{nestedFilters:ue}=pt(),{baseMeta:C}=ot(ct()),N=le(ut,x(!1)),{$api:M,$e:H}=nt(),{isUIAllowed:ee}=bt(),{metas:j,getMeta:fe}=ta(),{addUndo:re,clone:I,defineViewScope:oe}=aa(),z=x([]),_=B(()=>N.value||!ee("filterSync")||!ee("filterChildrenRead")),i=B({get:()=>_.value?se.value:z.value,set:a=>{if(_.value){se.value=a,K&&(ue.value=a),ue.value=[...ue.value],R==null||R.trigger();return}z.value=a}}),te=B(()=>i.value.filter(a=>a.status!=="delete")),P=le(rt,x()),ke=le(dt,x()),{showSystemFields:je,metaColumnById:he}=_a(),Se=B(()=>{var a,s;return(s=(a=P.value)==null?void 0:a.columns)==null?void 0:s.filter(u=>{var c;return kt((c=he==null?void 0:he.value)==null?void 0:c[u.id])?je.value:u.uidt===e.QrCode||u.uidt===e.Barcode||u.uidt===e.ID||u.system?!1:!(u.colOptions&&u.system)})}),de=B(()=>{var a,s,u,c;return(s=(a=P.value)==null?void 0:a.columns)!=null&&s.length?(c=(u=P.value)==null?void 0:u.columns)==null?void 0:c.reduce((f,T)=>(V.value[T.id]?f[T.id]=V.value[T.id].uidt:f[T.id]=T.uidt,f),{}):{}}),ce=x([]);ht(i,a=>{ce.value=I(a)});const Ie=(a,s)=>Object.entries(s).filter(([u,c])=>a[u]!==c&&u in a).reduce((u,[c,f])=>({...u,[c]:f}),{}),Ue=(a,s)=>{const u=["empty","notempty","null","notnull"].includes(s.value);return s.includedTypes?a.fk_column_id&&s.includedTypes.includes(de.value[a.fk_column_id])?u?C.value.showNullAndEmptyInFilter:!0:!1:s.excludedTypes?a.fk_column_id&&!s.excludedTypes.includes(de.value[a.fk_column_id])?u?C.value.showNullAndEmptyInFilter:!0:!1:u?C.value.showNullAndEmptyInFilter:!0},Pe=(a,s)=>{if(s.includedTypes)return a.fk_column_id&&s.includedTypes.includes(de.value[a.fk_column_id]);if(s.excludedTypes)return a.fk_column_id&&!s.excludedTypes.includes(de.value[a.fk_column_id])},ve=()=>{var a,s;return{comparison_op:(s=Me((a=Se.value)==null?void 0:a[0].uidt).filter(u=>{var c;return Ue({fk_column_id:(c=Se.value)==null?void 0:c[0].id},u)}))==null?void 0:s[0].value,value:"",status:"create",logical_op:"and"}},_e=async(a,s=!1)=>{var u;if((u=n.value)!=null&&u.id&&!_.value)try{s||a?F?i.value=(await M.dbTableFilter.childrenRead(F)).list:a&&(i.value=(await M.dbTableWebhookFilter.read(a)).list):F?i.value=(await M.dbTableFilter.childrenRead(F)).list:i.value=(await M.dbTableFilter.read(n.value.id)).list}catch(c){console.log(c),$e.error(await Ae(c))}},me=async(a,s=!1)=>{var u;try{for(const[c,f]of Object.entries(i.value))f.status==="delete"?await M.dbTableFilter.delete(f.id):f.status==="update"?await M.dbTableFilter.update(f.id,{...f,fk_parent_id:F}):f.status==="create"&&(a?i.value[+c]=await M.dbTableWebhookFilter.create(a,{...f,fk_parent_id:F}):i.value[+c]=await M.dbTableFilter.create((u=n==null?void 0:n.value)==null?void 0:u.id,{...f,fk_parent_id:F}));w||L==null||L()}catch(c){console.log(c),$e.error(await Ae(c))}},Q=async(a,s,u=!1,c=!1)=>{if(n.value){if(!c){const f=ce.value[s];if(f){const T=I(Ie(a,f));Object.keys(T).length>0&&re({undo:{fn:(O,ne)=>{const A=i.value[s];A&&(A[O]=ne,Q(A,s,u,!0))},args:[Object.keys(T)[0],Object.values(T)[0]]},redo:{fn:(O,ne)=>{const A=i.value[s];A&&(A[O]=ne,Q(A,s,u,!0))},args:[Object.keys(T)[0],a[Object.keys(T)[0]]]},scope:oe({view:ke.value})})}}try{_.value?(i.value[s]={...a},i.value=[...i.value]):!(g!=null&&g.value)&&!u?a.status=a.id?"update":"create":a.id&&a.status!=="create"?(await M.dbTableFilter.update(a.id,{...a,fk_parent_id:F}),H("a:filter:update",{logical:a.logical_op,comparison:a.comparison_op})):i.value[s]=await M.dbTableFilter.create(n.value.id,{...a,fk_parent_id:F})}catch(f){console.log(f),$e.error(await Ae(f))}ce.value=I(i.value),w||L==null||L()}},$=async(a,s,u=!1)=>{if(!u&&!a.is_group&&re({undo:{fn:async c=>{c.status="create",i.value.splice(s,0,c),await Q(c,s,!1,!0)},args:[I(a)]},redo:{fn:async c=>{await $(i.value[c],c,!0)},args:[s]},scope:oe({view:ke.value})}),_.value)i.value.splice(s,1),i.value=[...i.value],w||L==null||L();else{if(a.id)if(!(g!=null&&g.value))a.status="delete";else try{await M.dbTableFilter.delete(a.id),w||L==null||L(),i.value.splice(s,1)}catch(c){console.log(c),$e.error(await Ae(c))}else i.value.splice(s,1);H("a:filter:delete",{length:te.value.length})}},Be=xt(Q,500),Oe=async(a=!1)=>{i.value.push(ve()),a||re({undo:{fn:async function(u){this.redo.args=[u,I(i.value[u])],await $(i.value[u],u,!0)},args:[i.value.length-1]},redo:{fn:async(s,u)=>{u.status="create",i.value.splice(s,0,u),await Q(u,s,!1,!0)},args:[]},scope:oe({view:ke.value})}),ce.value=I(i.value),H("a:filter:add",{length:i.value.length})},xe=async()=>{const a=ve(),s={is_group:!0,status:"create",logical_op:"and"};_.value&&(s.children=[a]),i.value.push(s);const u=i.value.length-1;await Q(i.value[u],u,!0),ce.value=I(i.value),H("a:filter:add",{length:i.value.length,group:!0})};return Ee(()=>{var a,s,u,c,f,T;return!(n!=null&&n.value)||!((s=j==null?void 0:j.value)!=null&&s[(a=n==null?void 0:n.value)==null?void 0:a.fk_model_id])?0:((T=(f=(c=j==null?void 0:j.value)==null?void 0:c[(u=n==null?void 0:n.value)==null?void 0:u.fk_model_id])==null?void 0:f.columns)==null?void 0:T.length)||0},async(a,s)=>{a&&a<s&&await _e()}),{filters:i,nonDeletedFilters:te,loadFilters:_e,sync:me,deleteFilter:$,saveOrUpdate:Q,addFilter:Oe,addFilterGroup:xe,saveOrUpdateDebounced:Be,isComparisonOpAllowed:Ue,isComparisonSubOpAllowed:Pe,loadBtLookupTypes:async()=>{var s,u,c,f;const a={};try{for(const T of((s=P.value)==null?void 0:s.columns)||[]){if(T.uidt!==e.Lookup)continue;let O=T;for(;O&&O.uidt===e.Lookup;){const ne=(c=(u=await fe(O.fk_model_id))==null?void 0:u.columns)==null?void 0:c.find(pe=>pe.id===O.colOptions.fk_relation_column_id),A=await fe(ne.colOptions.fk_related_model_id);if(O=(f=A==null?void 0:A.columns)==null?void 0:f.find(pe=>pe.id===O.colOptions.fk_lookup_column_id),O.id===T.id)break}a[T.id]=O}V.value=a}catch(T){console.error(T)}},btLookupTypesMap:V}}const Ma=Mt(()=>St(()=>Promise.resolve().then(()=>Za),void 0,import.meta.url).then(n=>n.default||n)),Sa={key:0,class:"flex flex-col w-full gap-y-2"},Ua={class:"flex flex-row w-full justify-between items-center"},Ba={key:0,class:"flex items-center ml-2"},Oa={class:"flex items-center w-full justify-between w-full gap-2"},Ra={class:"truncate flex-1 capitalize"},$a={key:1,class:"flex flex-row gap-x-2 w-full"},Aa={key:0,class:"flex items-center ml-2 mr-7.35"},Na={class:"flex items-center w-full justify-between w-full gap-2"},ja={class:"truncate flex-1 capitalize"},Ia={class:"flex items-center w-full justify-between w-full gap-2"},Pa={class:"truncate flex-1"},Ea={key:2,class:"flex flex-grow"},za={class:"flex items-center w-full justify-between w-full gap-2 max-w-40"},Ga={key:6,class:"flex-grow"},qa={class:"flex items-center gap-1"},Wa={class:"flex items-center gap-1"},Ha={class:"flex items-center gap-1"},Ya={class:"flex items-center gap-1"},Qa=st({__name:"ColumnFilter",props:{nestedLevel:{default:0},parentId:{default:void 0},autoSave:{type:Boolean,default:!0},hookId:{default:void 0},showLoading:{type:Boolean,default:!0},modelValue:{},webHook:{type:Boolean,default:!1}},emits:["update:filtersLength"],setup(n,{expose:F,emit:g}){const L=n,h=g,{nestedLevel:K,parentId:w,autoSave:se,hookId:V,modelValue:R,showLoading:ue,webHook:C}=wt(L),N=B(()=>K.value>0),{t:M}=Ct(),H=[{value:"and",text:M("general.and")},{value:"or",text:M("general.or")}],ee=le(rt,x()),j=le(dt,x()),fe=le(it),re=le(ut,x(!1)),{$e:I}=nt(),{nestedFilters:oe}=pt(),{filters:z,nonDeletedFilters:_,deleteFilter:i,saveOrUpdate:te,loadFilters:P,addFilter:ke,addFilterGroup:je,sync:he,saveOrUpdateDebounced:Se,isComparisonOpAllowed:de,isComparisonSubOpAllowed:ce,loadBtLookupTypes:Ie,btLookupTypesMap:Ue}=Va(j,w==null?void 0:w.value,B(()=>se.value),()=>fe.trigger(ue.value),R.value||oe.value,!R.value,C.value),{getPlanLimit:Pe}=la(),ve=x(),_e=x(),me=x(),Q=B(()=>{var t;return(t=ee.value)==null?void 0:t.columns}),$=t=>{var r;return Ue.value[t.fk_column_id]||((r=Q.value)==null?void 0:r.find(p=>p.id===t.fk_column_id))},Be=x({}),Oe=(t,r)=>{var p,k,v,G;return!(t.id||t.comparison_op&&((k=Ne(t.comparison_op,(p=r==null?void 0:r.meta)==null?void 0:p.date_format).find(ie=>ie.value===t.comparison_sub_op))!=null&&k.ignoreVal)||(G=Me(r.uidt,(v=r==null?void 0:r.meta)==null?void 0:v.date_format).find(ie=>ie.value===t.comparison_op))!=null&&G.ignoreVal||t.value)},xe=(t,r)=>{var k;const p=$(t);p&&(p.uidt===e.SingleSelect&&["anyof","nanyof"].includes(Be.value[t.id])&&["eq","neq"].includes(t.comparison_op)?t.value=null:["blank","notblank","empty","notempty","null","notnull"].includes(t.comparison_op)?(t.value=null,t.comparison_sub_op=null):Re(p.uidt)&&(t.value=null,Ne(t.comparison_op,(k=p==null?void 0:p.meta)==null?void 0:k.date_format).map(v=>v.value).includes(t.comparison_sub_op)||(t.comparison_op==="isWithin"?t.comparison_sub_op="pastNumberOfDays":t.comparison_sub_op="exactDate")),Oe(t,p)||te(t,r),Be.value[t.id]=t.comparison_op,I("a:filter:update",{logical:t.logical_op,comparison:t.comparison_op,comparison_sub_op:t.comparison_sub_op}))},ze=B(()=>{var t,r,p,k;return(r=(t=ee.value)==null?void 0:t.columns)!=null&&r.length?(k=(p=ee.value)==null?void 0:p.columns)==null?void 0:k.reduce((v,G)=>(v[G.id]=G.uidt,v),{}):{}});Ee(()=>{var t;return(t=j.value)==null?void 0:t.id},(t,r)=>{!N.value&&t!==r&&(V!=null&&V.value||!C.value)&&P(V==null?void 0:V.value,C.value)});const a=le(Pt,x({}));Ee(()=>_.value.length,t=>{a.value[(w==null?void 0:w.value)??"root"]=[..._.value],h("update:filtersLength",t??0)});const s=B(()=>Object.values(a.value).reduce((t,r)=>t+r.filter(p=>!p.is_group).length,0)),u=async(t,r=!1,p=!0)=>{var k;if(!p)for(let v=z.value.length-1;v>=0;v--)await i(z.value[v],v);if(await he(t,r),!!((k=ve.value)!=null&&k.length))for(const v of ve.value)v.parentId&&await v.applyChanges(t,!0)},c=(t,r)=>{var k,v;const p=$(t);p&&(t.comparison_op=(v=Me(p.uidt,(k=p==null?void 0:p.meta)==null?void 0:k.date_format).find(G=>de(t,G)))==null?void 0:v.value,Re(p.uidt)&&!["blank","notblank"].includes(t.comparison_op)?t.comparison_op==="isWithin"?t.comparison_sub_op="pastNumberOfDays":t.comparison_sub_op="exactDate":t.comparison_sub_op=null,t.value=null,Oe(t,p)||te(t,r))},f=(t,r,p)=>{r.value=t,Se(r,p)};F({applyChanges:u,parentId:w==null?void 0:w.value});const T=()=>{var t;(t=_e.value)==null||t.scrollTo({top:_e.value.scrollHeight,behavior:"smooth"})},O=()=>{var t;N.value&&((t=me==null?void 0:me.value)==null||t.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}))},ne=async()=>{await ke(),N.value?O():T()},A=async()=>{await je(),N.value?O():T()},pe=t=>{var p,k,v,G,ie;const r=$(t);return t.comparison_op?t.comparison_sub_op?!((v=Ne(t.comparison_op,(k=(p=$(t))==null?void 0:p.meta)==null?void 0:k.date_format).find(we=>we.value===t.comparison_sub_op))!=null&&v.ignoreVal):!((ie=Me(r==null?void 0:r.uidt,(G=r==null?void 0:r.meta)==null?void 0:G.date_format).find(we=>we.value===t.comparison_op))!=null&&ie.ignoreVal):!1};He(()=>{P(V==null?void 0:V.value,C.value)}),He(async()=>{await Ie()}),Dt(()=>{w.value&&delete a.value[w.value]});function Re(t){return[e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime].includes(t)}return(t,r)=>{const p=va,k=Ut,v=Bt,G=Ma,ie=Ot,we=Rt,ft=ga,vt=La,ye=Ft("e");return d(),b("div",{class:be(["menu-filter-dropdown",{"max-h-[max(80vh,500px)] min-w-112 py-6 pl-6":!o(N),"w-full ":o(N)}])},[o(z)&&o(z).length?(d(),b("div",{key:0,ref_key:"wrapperDomRef",ref:_e,class:be(["flex flex-col gap-y-3 nc-filter-grid pb-2 w-full",{"max-h-420px nc-scrollbar-md  pr-3.5 nc-filter-top-wrapper":!o(N)}]),onClick:r[4]||(r[4]=W(()=>{},["stop"]))},[(d(!0),b(Z,null,Le(o(z),(l,S)=>{var Ge,qe;return d(),b(Z,{key:S},[l.status!=="delete"?(d(),b(Z,{key:0},[l.is_group?(d(),b("div",Sa,[E("div",Ua,[S?(d(),b("div",{key:`${S}nested`,class:"flex nc-filter-logical-op"},[ge((d(),y(k,{value:l.logical_op,"onUpdate:value":m=>l.logical_op=m,"dropdown-match-select-width":!1,class:"min-w-20 capitalize",placeholder:"Group op","dropdown-class-name":"nc-dropdown-filter-logical-op-group",onClick:r[0]||(r[0]=W(()=>{},["stop"])),onChange:m=>o(te)(l,S)},{default:U(()=>[(d(),b(Z,null,Le(H,m=>Ve(p,{key:m.value,value:m.value},{default:U(()=>[E("div",Oa,[E("div",Ra,q(m.value),1),l.logical_op===m.value?(d(),y(Y(o(J).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):D("",!0)])]),_:2},1032,["value"])),64))]),_:2},1032,["value","onUpdate:value","onChange"])),[[ye,["c:filter:logical-op:select"]]])])):(d(),b("span",Ba,q(t.$t("labels.where")),1)),l.readOnly?D("",!0):ge((d(),y(v,{key:S,type:"text",size:"small",class:"nc-filter-item-remove-btn cursor-pointer",onClick:W(m=>o(i)(l,S),["stop"])},{default:U(()=>[(d(),y(Y(o(J).deleteListItem)))]),_:2},1032,["onClick"])),[[ye,["c:filter:delete"]]])]),E("div",{class:be(["flex border-1 rounded-lg p-2 w-full",o(K)%2!==0?"bg-white":"bg-gray-100"])},[l.id||l.children?(d(),y(G,{key:l.id??S,ref_for:!0,ref_key:"localNestedFilters",ref:ve,modelValue:l.children,"onUpdate:modelValue":m=>l.children=m,"nested-level":o(K)+1,"parent-id":l.id,"auto-save":o(se),"web-hook":o(C)},null,8,["modelValue","onUpdate:modelValue","nested-level","parent-id","auto-save","web-hook"])):D("",!0)],2)])):(d(),b("div",$a,[S?ge((d(),y(k,{key:1,value:l.logical_op,"onUpdate:value":m=>l.logical_op=m,"dropdown-match-select-width":!1,class:"h-full !min-w-20 !max-w-20 capitalize","hide-details":"",disabled:l.readOnly,"dropdown-class-name":"nc-dropdown-filter-logical-op",onChange:m=>xe(l,S),onClick:r[1]||(r[1]=W(()=>{},["stop"]))},{default:U(()=>[(d(),b(Z,null,Le(H,m=>Ve(p,{key:m.value,value:m.value},{default:U(()=>[E("div",Na,[E("div",ja,q(m.value),1),l.logical_op===m.value?(d(),y(Y(o(J).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):D("",!0)])]),_:2},1032,["value"])),64))]),_:2},1032,["value","onUpdate:value","disabled","onChange"])),[[ye,["c:filter:logical-op:select"]]]):(d(),b("span",Aa,q(t.$t("labels.where")),1)),(d(),y(ie,{key:`${S}_6`,modelValue:l.fk_column_id,"onUpdate:modelValue":m=>l.fk_column_id=m,class:"nc-filter-field-select min-w-32 max-w-32 max-h-8",columns:o(Q),disabled:l.readOnly,onClick:r[2]||(r[2]=W(()=>{},["stop"])),onChange:m=>c(l,S)},null,8,["modelValue","onUpdate:modelValue","columns","disabled","onChange"])),ge((d(),y(k,{value:l.comparison_op,"onUpdate:value":m=>l.comparison_op=m,"dropdown-match-select-width":!1,class:"caption nc-filter-operation-select !min-w-26.75 !max-w-26.75 max-h-8",placeholder:t.$t("labels.operation"),density:"compact",variant:"solo",disabled:l.readOnly,"hide-details":"","dropdown-class-name":"nc-dropdown-filter-comp-op !max-w-80",onChange:m=>xe(l,S)},{default:U(()=>{var m,Ce,ae;return[(d(!0),b(Z,null,Le(o(Me)((m=$(l))==null?void 0:m.uidt,(ae=(Ce=$(l))==null?void 0:Ce.meta)==null?void 0:ae.date_format),De=>(d(),b(Z,{key:De.value},[o(de)(l,De)?(d(),y(p,{key:0,value:De.value},{default:U(()=>[E("div",Ia,[E("div",Pa,q(De.text),1),l.comparison_op===De.value?(d(),y(Y(o(J).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):D("",!0)])]),_:2},1032,["value"])):D("",!0)],64))),128))]}),_:2},1032,["value","onUpdate:value","placeholder","disabled","onChange"])),[[ye,["c:filter:comparison-op:select"]]]),["blank","notblank"].includes(l.comparison_op)?(d(),b("div",Ea)):Re((Ge=$(l))==null?void 0:Ge.uidt)?ge((d(),y(k,{key:3,value:l.comparison_sub_op,"onUpdate:value":m=>l.comparison_sub_op=m,"dropdown-match-select-width":!1,class:be(["caption nc-filter-sub_operation-select min-w-28",{"flex-grow w-full":!pe(l),"max-w-28":pe(l)}]),placeholder:t.$t("labels.operationSub"),density:"compact",variant:"solo",disabled:l.readOnly,"hide-details":"","dropdown-class-name":"nc-dropdown-filter-comp-sub-op",onChange:m=>xe(l,S)},{default:U(()=>{var m,Ce;return[(d(!0),b(Z,null,Le(o(Ne)(l.comparison_op,(Ce=(m=$(l))==null?void 0:m.meta)==null?void 0:Ce.date_format),ae=>(d(),b(Z,{key:ae.value},[o(ce)(l,ae)?(d(),y(p,{key:0,value:ae.value},{default:U(()=>[E("div",za,[Ve(we,{"show-on-truncate-only":"",class:"truncate flex-1"},{title:U(()=>[Te(q(ae.text),1)]),default:U(()=>[Te(" "+q(ae.text),1)]),_:2},1024),l.comparison_sub_op===ae.value?(d(),y(Y(o(J).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):D("",!0)])]),_:2},1032,["value"])):D("",!0)],64))),128))]}),_:2},1032,["value","onUpdate:value","class","placeholder","disabled","onChange"])),[[ye,["c:filter:sub-comparison-op:select"]]]):D("",!0),l.field&&o(ze)[l.field]==="boolean"?(d(),y(ft,{key:4,checked:l.value,"onUpdate:checked":m=>l.value=m,dense:"",disabled:l.readOnly,onChange:m=>o(te)(l,S)},null,8,["checked","onUpdate:checked","disabled","onChange"])):D("",!0),pe(l)?(d(),y(vt,{key:5,class:"nc-filter-value-select rounded-md min-w-34",column:$(l),filter:l,onUpdateFilterValue:m=>f(m,l,S),onClick:r[3]||(r[3]=W(()=>{},["stop"]))},null,8,["column","filter","onUpdateFilterValue"])):Re((qe=$(l))==null?void 0:qe.uidt)?D("",!0):(d(),b("div",Ga)),l.readOnly?D("",!0):ge((d(),y(v,{key:7,type:"text",size:"small",class:"nc-filter-item-remove-btn self-center",onClick:W(m=>o(i)(l,S),["stop"])},{default:U(()=>[(d(),y(Y(o(J).deleteListItem)))]),_:2},1032,["onClick"])),[[ye,["c:filter:delete"]]])]))],64)):D("",!0)],64)}),128))],2)):D("",!0),("isEeUI"in t?t.isEeUI:o(ya))&&!o(re)?(d(),b(Z,{key:1},[o(s)<o(Pe)(o(Lt).FILTER_LIMIT)?(d(),b("div",{key:0,ref_key:"addFiltersRowDomRef",ref:me,class:"flex gap-2"},[Ve(v,{size:"small",type:"text",class:"!text-brand-500",onClick:r[5]||(r[5]=W(l=>ne(),["stop"]))},{default:U(()=>[E("div",qa,[(d(),y(Y(o(J).plus))),Te(q(t.$t("activity.addFilter")),1)])]),_:1}),!o(C)&&o(K)<5?(d(),y(v,{key:0,type:"text",size:"small",onClick:r[6]||(r[6]=W(l=>A(),["stop"]))},{default:U(()=>[E("div",Wa,[(d(),y(Y(o(J).plus))),Te(" "+q(t.$t("activity.addFilterGroup")),1)])]),_:1})):D("",!0)],512)):D("",!0)],64)):(d(),b("div",{key:2,ref_key:"addFiltersRowDomRef",ref:me,class:"flex gap-2"},[Ve(v,{size:"small",type:"text",class:"!text-brand-500",onClick:r[7]||(r[7]=W(l=>ne(),["stop"]))},{default:U(()=>[E("div",Ha,[(d(),y(Y(o(J).plus))),Te(q(t.$t("activity.addFilter")),1)])]),_:1}),!o(C)&&o(K)<5?(d(),y(v,{key:0,type:"text",size:"small",onClick:r[8]||(r[8]=W(l=>A(),["stop"]))},{default:U(()=>[E("div",Ya,[(d(),y(Y(o(J).plus))),Te(" "+q(t.$t("activity.addFilterGroup")),1)])]),_:1})):D("",!0)],512)),o(z).length?D("",!0):(d(),b("div",{key:3,class:be(["flex flex-row text-gray-400 mt-2",{"ml-1":o(N),"ml-0.5":!o(N)}])},q(t.$t("title.noFiltersAdded")),3)),Vt(t.$slots,"default",{},void 0,!0)],2)}}});const Xa=mt(Qa,[["__scopeId","data-v-adb98711"]]),Za=Object.freeze(Object.defineProperty({__proto__:null,default:Xa},Symbol.toStringTag,{value:"Module"}));export{Za as C,Xa as _,Va as u};
