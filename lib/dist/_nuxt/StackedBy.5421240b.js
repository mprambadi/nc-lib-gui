import{f as z,ba as R,r as s,bb as l,H,g as C,cG as W,c9 as q,O as a,o as r,P as f,w as d,c as J,cb as c,a as n,b,W as h,T as v,au as Q,d as X,t as I,a0 as Y,a1 as Z,a8 as ee}from"./entry.96205fa0.js";import{_ as oe}from"./Icon.vue.6d0583a0.js";import{j as te,M as ae,A as ne,b as se,f as ie}from"./index.9b87fcff.js";import{a as le}from"./useKanbanViewStore.4bcd49a7.js";import{u as re}from"./index.e38f94a1.js";import{f as de}from"./bases.965a49bb.js";import{u as ce}from"./useViewColumns.8927231f.js";import{D as pe}from"./index.6c1d17b6.js";import{_ as ue}from"./index.b5e393d6.js";import"./deepCompare.d32ec333.js";import"./dataUtils.fb0a3616.js";import"./useSmartsheetStore.7d51347e.js";import"./views.2c163cf7.js";import"./useSharedView.9e320acb.js";import"./index.e034edbd.js";import"./index.0c5b3837.js";import"./Dropdown.1dedd322.js";import"./RightOutlined.3ce786f5.js";import"./toArray.3561b70e.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.dbc63a5f.js";import"./useState.5a301439.js";import"./CheckOutlined.3b90c20d.js";import"./SearchOutlined.c9794270.js";import"./FormItemContext.b19eb48c.js";const me=Y(()=>Z(()=>import("./EditOrAddProvider.c574dfb1.js"),["./EditOrAddProvider.c574dfb1.js","./EditOrAddProvider.vue.8b187915.js","./entry.96205fa0.js","./entry.d09b2482.css","./Icon.vue.6d0583a0.js","./Button.vue.02ce6d5b.js","./index.9e8f59f4.js","./debounce.1d5af9bf.js","./toNumber.ed208f2f.js","./isSymbol.d46b4957.js","./_plugin-vue_export-helper.c27b6911.js","./Button.ff10bcb0.css","./index.9b87fcff.js","./views.2c163cf7.js","./bases.965a49bb.js","./index.0c5b3837.js","./useSharedView.9e320acb.js","./validation.64563eeb.js","./index.886d43e1.js","./FormItem.9f1f85f2.js","./identity.309e9ead.js","./_getPrototype.459a70cf.js","./Col.b3c5d725.js","./responsiveObserve.358bcfe9.js","./toArray.3561b70e.js","./FormItemContext.b19eb48c.js","./useSize.c98e621d.js","./_flatRest.ce557a88.js","./isPlainObject.631eb8fb.js","./vuedraggable.umd.5a03c14e.js","./v3-infinite-loading.e5e5dc2d.js","./index.6c1d17b6.js","./Dropdown.1dedd322.js","./RightOutlined.3ce786f5.js","./index.1431a68b.js","./Input.3f1aaf0c.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.c9794270.js","./TextArea.b81a19ed.js","./Password.803cc3dc.js","./cell.810c4fd3.js","./index.0b4c0f1e.js","./Checkbox.cf2cdba0.js","./createForOfIteratorHelper.f2005dfe.js","./index.b5e393d6.js","./isMobile.e2e89480.js","./useMemo.dbc63a5f.js","./useState.5a301439.js","./CheckOutlined.3b90c20d.js","./EditOrAddProvider.9247d0ff.css"],import.meta.url).then(p=>p.default||p)),_e={class:"nc-kanban-btn"},fe={class:"flex items-center gap-1"},be={class:"text-capitalize !text-sm"},ve={class:"font-bold ml-0.25"},ge=n("div",null,"Select a field to stack records by",-1),we={class:"nc-fields-list py-2"},ke={class:"grouping-field"},ye={class:"mt-4 border-1 px-4 pt-4 pb-3 border-gray-50 rounded-2xl"},Ce=n("div",{class:"text-base font-medium mb-2"},"Options",-1),Je=z({__name:"StackedBy",setup(p){R(te,s(!0));const x=l(ae,s()),u=l(ne,s()),S=l(se,s(!1)),V=l(ie,s(!1)),{fields:D,loadViewColumns:B,metaColumnById:O}=ce(),{kanbanMetaData:g,loadKanbanMeta:w,loadKanbanData:k,updateKanbanMeta:j,groupingField:M,groupingFieldColumn:F}=le(),{addUndo:K,defineViewScope:P}=de(),t=s(!1);re(t),H(()=>{var o;return(o=u.value)==null?void 0:o.id},async(o,e)=>{o!==e&&x.value&&await B()},{immediate:!0});const m=async o=>{var e;await j({fk_grp_col_id:o}),await w(),await k(),((e=u.value)==null?void 0:e.view).fk_grp_col_id=o},_=C({get:()=>g.value.fk_grp_col_id,set:async o=>{o&&(K({undo:{fn:await m,args:[g.value.fk_grp_col_id]},redo:{fn:await m,args:[o]},scope:P({view:u.value})}),await m(o))}}),T=C(()=>{var o;return(o=D.value)==null?void 0:o.filter(e=>e.fk_column_id&&O.value[e.fk_column_id].uidt===W.SingleSelect).map(e=>({value:e.fk_column_id,label:e.title}))}),A=async()=>{t.value=!1,await w(),await k()},E=()=>{t.value=!1};return(o,e)=>{const y=oe,U=ee,G=ue,L=me,N=pe,$=q("e");return a(S)?v("",!0):(r(),f(N,{key:0,visible:a(t),"onUpdate:visible":e[6]||(e[6]=i=>h(t)?t.value=i:null),trigger:["click"],"overlay-class-name":"nc-dropdown-kanban-stacked-by-menu",class:"!xs:hidden"},{overlay:d(()=>[a(t)?(r(),J("div",{key:0,class:"p-6 w-90 bg-white shadow-lg nc-table-toolbar-menu !border-1 border-gray-50 rounded-2xl",onClick:e[5]||(e[5]=c(()=>{},["stop"]))},[ge,n("div",we,[n("div",ke,[b(G,{value:a(_),"onUpdate:value":e[0]||(e[0]=i=>h(_)?_.value=i:null),class:"w-full nc-kanban-grouping-field-select",options:a(T),placeholder:"Select a Grouping Field",onChange:E,onClick:e[1]||(e[1]=c(()=>{},["stop"]))},{suffixIcon:d(()=>[b(y,{icon:"arrowDown",class:"text-gray-700"})]),_:1},8,["value","options"])])]),n("div",ye,[Ce,a(t)?(r(),f(L,{key:0,column:a(F),"embed-mode":"","column-label":o.$t("general.changes"),"hide-title":"","hide-type":"","hide-additional-options":"",onCancel:e[2]||(e[2]=i=>t.value=!1),onSubmit:A,onClick:e[3]||(e[3]=c(()=>{},["stop"])),onKeydown:e[4]||(e[4]=c(()=>{},["stop"]))},null,8,["column","column-label"])):v("",!0)])])):v("",!0)]),default:d(()=>[n("div",_e,[Q((r(),f(U,{class:"nc-kanban-stacked-by-menu-btn nc-toolbar-btn",disabled:a(V)},{default:d(()=>[n("div",fe,[b(y,{icon:"layers",class:"mr-0.5"}),n("span",be,[X(I(o.$t("activity.kanban.stackedBy"))+" ",1),n("span",ve,I(a(M)),1)])])]),_:1},8,["disabled"])),[[$,["c:kanban:change-grouping-field"]]])])]),_:1},8,["visible"]))}}});export{Je as default};
