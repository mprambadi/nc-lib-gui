import{C as H,i as N,r as W,l as J,m as Q,E as T,t as X}from"./index.9b87fcff.js";import{f as Z,M as ee,$ as te,bb as s,r as i,g as p,gl as ae,cp as f,H as le,cg as re,i as ne,bR as ce,o as oe,P as se,w as ie,O as a,W as ue,S as de,bv as pe,eR as U}from"./entry.96205fa0.js";import{p as me}from"./bases.965a49bb.js";import{u as fe}from"./index.a5de28c1.js";import{D as ve}from"./dayjs.06eaa8eb.js";import{_ as ke}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.0c5b3837.js";import"./index.afb04277.js";import"./createForOfIteratorHelper.f2005dfe.js";import"./index.b7feb234.js";import"./useState.5a301439.js";import"./useMemo.dbc63a5f.js";import"./FormItemContext.b19eb48c.js";const be=Z({__name:"DatePicker",props:{modelValue:{},isPk:{type:Boolean}},emits:["update:modelValue"],setup(n,{emit:_}){const D=_,{t:v}=ee(),{showNull:E}=te(),k=s(H,null),b=s(N,i(!1)),B=s(W,i(!1)),g=s(J,i(!1)),y=s(Q,i(!1)),h=s(T,i(!1)),V=i(!1),w=p(()=>{var e,r;return((r=me((e=k==null?void 0:k.value)==null?void 0:e.meta))==null?void 0:r.date_format)??"YYYY-MM-DD"}),S=p(()=>ae(w.value)?"month":""),l=p({get(){if(!n.modelValue)return;if(!f(n.modelValue).isValid()){V.value=!0;return}const e=S.value==="month"?w:"YYYY-MM-DD";return f(/^\d+$/.test(n.modelValue)?+n.modelValue:n.modelValue,e)},set(e){if(!e){D("update:modelValue",null);return}S.value==="month"&&(e=f(e).date(1)),e.isValid()&&D("update:modelValue",e==null?void 0:e.format("YYYY-MM-DD"))}}),t=i(!1),q=`picker_${Math.floor(Math.random()*99999)}`;le(t,e=>{e?re(document.querySelector(`.${q}`),()=>t.value=!1):h.value=!1},{flush:"post"});const K=p(()=>B.value&&(n.modelValue===""||n.modelValue===null)?v("labels.optional"):n.modelValue===null&&E.value?v("general.null").toUpperCase():V.value?v("msg.invalidDate"):"");fe(y,e=>{var r,m,u,C,I,M,Y,P,j,O,$,R,A,F;switch(e.key){case"Enter":if(e.stopPropagation(),U())return;if(!t.value)t.value=!0;else{const c=document.querySelector(".nc-picker-date.active .ant-picker-cell-selected");c&&(c.click(),t.value=!1)}break;case"Escape":if(U())return;t.value&&(e.stopPropagation(),t.value=!1);break;case"ArrowLeft":if(!l.value)(r=document.querySelector(".nc-picker-date.active .ant-picker-header-prev-btn"))==null||r.click();else{const c=(m=document.querySelector(".nc-picker-date.active .ant-picker-cell-selected"))==null?void 0:m.previousElementSibling;if(c)c.click();else{const d=(I=(C=(u=document.querySelector(".nc-picker-date.active .ant-picker-cell-selected"))==null?void 0:u.closest("tr"))==null?void 0:C.previousElementSibling)==null?void 0:I.querySelector("td:last-child");d?d.click():(M=document.querySelector(".nc-picker-date.active .ant-picker-header-prev-btn"))==null||M.click()}}break;case"ArrowRight":if(!l.value)(Y=document.querySelector(".nc-picker-date.active .ant-picker-header-next-btn"))==null||Y.click();else{const c=(P=document.querySelector(".nc-picker-date.active .ant-picker-cell-selected"))==null?void 0:P.nextElementSibling;if(c)c.click();else{const d=($=(O=(j=document.querySelector(".nc-picker-date.active .ant-picker-cell-selected"))==null?void 0:j.closest("tr"))==null?void 0:O.nextElementSibling)==null?void 0:$.querySelector("td:first-child");d?d.click():(R=document.querySelector(".nc-picker-date.active .ant-picker-header-next-btn"))==null||R.click()}}break;case"ArrowUp":l.value||(A=document.querySelector(".nc-picker-date.active .ant-picker-header-super-prev-btn"))==null||A.click();break;case"ArrowDown":l.value||(F=document.querySelector(".nc-picker-date.active .ant-picker-header-super-next-btn"))==null||F.click();break;case";":l.value=f(new Date);break}});const L=p(()=>b.value||(b.value||l.value&&n.isPk)&&!y.value&&!h.value?!1:t.value),z=e=>{t.value&&!e&&(t.value=!1)},o=s(X,null),x=()=>{t.value=(y.value||h.value)&&!t.value};ne(()=>{o==null||o.on(x)}),ce(()=>{o==null||o.on(x)});const G=()=>{o||x()};return(e,r)=>{const m=ve;return oe(),se(m,{value:a(l),"onUpdate:value":r[0]||(r[0]=u=>ue(l)?l.value=u:null),picker:a(S),tabindex:0,bordered:!1,class:de(["!w-full !py-1 !border-none !text-current",{"nc-null":e.modelValue===null&&a(E),"!px-2":a(g),"!px-0":!a(g)}]),format:a(w),placeholder:a(K),"allow-clear":!a(b)&&!a(l)&&!e.isPk,"input-read-only":!0,"dropdown-class-name":`${q} nc-picker-date  children:border-1 children:border-gray-200  ${a(t)?"active":""} `,open:a(L),onClick:G,"onUpdate:open":z,onKeydown:r[1]||(r[1]=pe(u=>t.value=!a(t),["enter"]))},{suffixIcon:ie(()=>[]),_:1},8,["value","picker","class","format","placeholder","allow-clear","dropdown-class-name","open"])}}});const Ye=ke(be,[["__scopeId","data-v-50247cdd"]]);export{Ye as default};
