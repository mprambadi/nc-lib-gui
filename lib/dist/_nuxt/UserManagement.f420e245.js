import{o as a,c as h,a as s,f as pe,M as _e,L as fe,bF as ve,aM as xe,r as m,e0 as ye,h0 as he,c9 as we,O as l,b as r,P as i,w as n,d as q,t as d,W as D,S as ge,au as P,Q as x,R as y,T as g,U as F,V as be,aK as O,cq as W,cu as K,X as p,Y as z,a8 as ke,ah as Ue,af as $e,ce as Ce,cf as Re,a0 as Ie,a1 as Me,C as Se}from"./entry.5958c07b.js";import{a as je,u as De}from"./bases.e6c8e3c4.js";import{u as ze}from"./useCopy.0241e728.js";import{u as Ae}from"./useDashboard.7eae7d45.js";import{_ as Be}from"./baseline-more-vert.5cb1bc9f.js";import{_ as Ee}from"./round-edit.55a44805.js";import{S as Te}from"./index.55641318.js";import"./index.ae235b22.js";import{I as Pe}from"./Input.dca3a2bc.js";import{D as Le}from"./index.dc13a4d6.js";import{_ as Ne}from"./index.023e2de7.js";import"./index.0feaca99.js";import"./debounce.7c24f171.js";import"./toNumber.e09cd85a.js";import"./isSymbol.114fe557.js";import"./SearchOutlined.a517903c.js";import"./isPlainObject.ccda79fe.js";import"./_getPrototype.c1f3bae2.js";import"./TextArea.9074ff05.js";import"./antInputDirective.8ac36ea7.js";import"./FormItemContext.ddc65fa5.js";import"./Password.f52125e7.js";import"./Dropdown.041b2468.js";import"./RightOutlined.7161c742.js";import"./LeftOutlined.1d2f193f.js";import"./index.5c6e4286.js";import"./toArray.fd74ce6f.js";import"./isMobile.e2e89480.js";import"./useMemo.1dd071d8.js";import"./useState.b891c8bb.js";import"./CheckOutlined.1fe5f230.js";import"./useBreakpoint.cbf2ba72.js";import"./responsiveObserve.0baefba6.js";const Ve={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},qe=s("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0c.41-.41.41-1.08 0-1.49zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14"},null,-1),Fe=[qe];function Oe(C,b){return a(),h("svg",Ve,[...Fe])}const We={name:"ic-round-search",render:Oe},Ke=Ie(()=>Me(()=>import("./UsersModal.fd337e0e.js"),["./UsersModal.fd337e0e.js","./entry.5958c07b.js","./entry.bdecbb78.css","./Modal.vue.ee5af191.js","./DeleteModal.7ab6f524.css","./validation.2de04583.js","./index.c35df397.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./useCopy.0241e728.js","./useDashboard.7eae7d45.js","./send-outline.b8c4f9e3.js","./index.b06c8b67.js","./FormItem.0bbf90a3.js","./identity.34c7640e.js","./isSymbol.114fe557.js","./_getPrototype.c1f3bae2.js","./Col.a97e3e76.js","./responsiveObserve.0baefba6.js","./toArray.fd74ce6f.js","./toNumber.e09cd85a.js","./FormItemContext.ddc65fa5.js","./useSize.fad35fe8.js","./_flatRest.39582a58.js","./debounce.7c24f171.js","./isPlainObject.ccda79fe.js","./index.ae235b22.js","./Input.dca3a2bc.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.a517903c.js","./TextArea.9074ff05.js","./Password.f52125e7.js","./index.1862798a.js","./index.5c6e4286.js","./isMobile.e2e89480.js","./useMemo.1dd071d8.js","./useState.b891c8bb.js","./CheckOutlined.1fe5f230.js"],import.meta.url).then(C=>C.default||C)),Qe={key:0,class:"h-full w-full flex items-center justify-center"},Xe={key:1,class:"flex flex-col w-full px-6"},Ye={class:"flex flex-col h-full"},Ge=s("div",{class:"flex flex-row justify-center mt-2 text-center w-full text-base"}," This action will remove this user from this base ",-1),He={class:"flex mt-6 justify-end space-x-2"},Je={class:"flex flex-row mb-4 mx-4 justify-between pb-2"},Ze={class:"flex w-1/3"},et={class:"flex flex-row space-x-1"},tt={class:"flex flex-row justify-center items-center caption capitalize space-x-1"},st={class:"text-gray-500"},ot={class:"flex flex-row justify-center items-center caption capitalize space-x-1"},at={class:"px-5"},lt={class:"flex flex-row border-b-1 pb-2 px-2"},nt={class:"flex flex-row w-3/6 space-x-1 items-center pl-1"},it={class:"text-gray-600 text-xs space-x-1"},rt={class:"flex flex-row justify-start w-2/6 space-x-1 items-center pl-1"},ct={class:"text-gray-600 text-xs"},dt={class:"flex flex-row w-1/6 justify-end items-center pl-1"},ut={class:"text-gray-600 text-xs"},mt={class:"flex w-3/6 flex-wrap nc-user-email"},pt={class:"flex w-2/6 justify-start gap-2 flex-wrap ml-4"},_t={class:"flex w-1/6 flex-wrap justify-end"},ft={class:"flex flex-row items-center"},vt={class:"flex flex-row items-center h-[1.2rem]"},xt=["onClick"],yt={class:"text-xs pl-2"},ht=["onClick"],wt={class:"text-xs pl-2"},es=pe({__name:"UserManagement",setup(C){const{t:b}=_e(),{$e:R}=Se(),{api:I}=fe(),{base:_}=ve(je()),{copy:Q}=ze(),{isUIAllowed:X}=xe(),{dashboardUrl:Y}=Ae(),{clearBasesUser:G}=De(),A=m(null),w=m(null),k=m(!1),f=m(!1),B=m(!1),L=m(0),U=m(1),M=m(10),$=m(""),v=async(e=U.value,t=M.value)=>{var u,S;try{if(!((u=_.value)!=null&&u.id))return;const c=await I.auth.baseUserList((S=_.value)==null?void 0:S.id,{query:{limit:t,offset:(e-1)*t,query:$.value}});if(!c.users)return;L.value=c.users.pageInfo.totalRows??0,A.value=c.users.list}catch(c){p.error(await z(c))}},H=async e=>{var t;try{if(!((t=_.value)!=null&&t.id))return;e.roles||(e.roles="editor"),await I.auth.baseUserAdd(_.value.id,e),G(),p.success(b("msg.success.userAddedToProject")),await v()}catch(u){p.error(await z(u))}R("a:user:add")},J=async()=>{var e,t;try{if(!((e=_.value)!=null&&e.id)||!((t=w.value)!=null&&t.id))return;await I.auth.baseUserRemove(_.value.id,w.value.id),p.success(b("msg.success.userDeletedFromProject")),await v(),f.value=!1}catch(u){p.error(await z(u))}finally{f.value=!1}R("a:user:delete")},Z=e=>{w.value=e,k.value=!0},ee=()=>{w.value=null,k.value=!0},te=e=>{w.value=e,f.value=!0},se=async e=>{var t;if((t=_.value)!=null&&t.id){try{await I.auth.baseUserResendInvite(_.value.id,e.id),p.success(b("msg.success.inviteEmailSent")),await v()}catch(u){p.error(await z(u))}R("a:user:resend-invite")}},oe=async e=>{if(e.invite_token){try{await Q(`${Y.value}#/signup/${e.invite_token}`),p.success(b("msg.success.inviteURLCopied"))}catch(t){p.error(t.message)}R("c:user:copy-url")}};ye(async()=>{A.value||(B.value=!0,await v(),B.value=!1)}),he($,()=>{U.value=1,v()},{debounce:300,maxWait:600});const N=e=>{var t;return(t=e.main_roles)==null?void 0:t.split(",").includes(K.SUPER_ADMIN)};return(e,t)=>{const u=Te,S=Ke,c=ke,ae=Ue,le=We,ne=Pe,ie=Ee,E=$e,re=Be,V=Ce,ce=Re,de=Le,ue=Ne,T=we("e");return l(B)?(a(),h("div",Qe,[r(u,{size:"large"})])):(a(),h("div",Xe,[(a(),i(S,{key:`${l(k)}`,show:l(k),"selected-user":l(w),onClosed:t[0]||(t[0]=o=>k.value=!1),onReload:t[1]||(t[1]=o=>v())},null,8,["show","selected-user"])),r(ae,{visible:l(f),"onUpdate:visible":t[3]||(t[3]=o=>D(f)?f.value=o:null),class:ge([{active:l(f)},"!rounded-md"]),closable:!1,width:"28rem",centered:"",footer:null,"wrap-class-name":"nc-modal-delete-user"},{default:n(()=>[s("div",Ye,[Ge,s("div",He,[r(c,{class:"!rounded-md",onClick:t[2]||(t[2]=o=>f.value=!1)},{default:n(()=>[q(d(e.$t("general.cancel")),1)]),_:1}),r(c,{class:"!rounded-md",type:"primary",danger:"",onClick:J},{default:n(()=>[q(d(e.$t("general.confirm")),1)]),_:1})])])]),_:1},8,["visible","class"]),s("div",Je,[s("div",Ze,[r(ne,{value:l($),"onUpdate:value":t[4]||(t[4]=o=>D($)?$.value=o:null),placeholder:e.$t("placeholder.filterByEmail")},{prefix:n(()=>[r(le,{class:"text-gray-400"})]),_:1},8,["value","placeholder"])]),s("div",et,[P((a(),i(c,{size:"middle",type:"text",onClick:t[5]||(t[5]=o=>v())},{default:n(()=>[s("div",tt,[(a(),i(x(l(y).reload),{class:"text-gray-500"})),s("div",st,d(e.$t("general.reload")),1)])]),_:1})),[[T,["a:user:reload"]]]),l(X)("newUser")?P((a(),i(c,{key:0,size:"middle",type:"primary",class:"nc-invite-team !rounded-md",onClick:ee},{default:n(()=>[s("div",ot,[(a(),i(x(l(y).accountPlus),{class:"mr-1"})),s("div",null,d(e.$t("activity.inviteTeam")),1)])]),_:1})),[[T,["c:user:invite"]]]):g("",!0)])]),s("div",at,[s("div",lt,[s("div",nt,[(a(),i(x(l(y).email),{class:"flex text-gray-500 -mt-0.5"})),s("div",it,d(e.$t("labels.email")),1)]),s("div",rt,[(a(),i(x(l(y).role),{class:"flex text-gray-500 -mt-0.5"})),s("div",ct,d(e.$t("objects.role")),1)]),s("div",dt,[s("div",ut,d(e.$t("labels.actions")),1)])]),(a(!0),h(F,null,be(l(A),(o,me)=>(a(),h("div",{key:me,class:"flex flex-row items-center border-b-1 py-2 px-2 nc-user-row"},[s("div",mt,d(o.email),1),s("div",pt,[N(o)?(a(),h("div",{key:0,class:"rounded-full px-3 py-1 nc-user-role",style:O({backgroundColor:l(W)[l(K).SUPER_ADMIN]})}," Super Admin ",4)):g("",!0),o.roles?(a(),h("div",{key:1,class:"rounded-full px-3 py-1 nc-user-role",style:O({backgroundColor:l(W)[o.roles]})},d(e.$t(`objects.roleType.${o.roles}`)),5)):g("",!0)]),s("div",_t,[N(o)?g("",!0):(a(),h(F,{key:0},[o.base_id?(a(),i(E,{key:0,placement:"bottom"},{title:n(()=>[s("span",null,d(e.$t("activity.editUser")),1)]),default:n(()=>[r(c,{type:"text",class:"!rounded-md nc-user-edit",onClick:j=>Z(o)},{icon:n(()=>[r(ie,{class:"flex mx-auto h-[1rem] text-gray-500"})]),_:2},1032,["onClick"])]),_:2},1024)):g("",!0),o.base_id?(a(),i(E,{key:2,placement:"bottom"},{title:n(()=>[s("span",null,d(e.$t("activity.deleteUser")),1)]),default:n(()=>[P((a(),i(c,{type:"text",class:"!rounded-md nc-user-delete",onClick:j=>te(o)},{icon:n(()=>[(a(),i(x(l(y).delete),{class:"flex mx-auto h-[1.1rem] text-gray-500"}))]),_:2},1032,["onClick"])),[[T,["c:user:delete"]]])]),_:2},1024)):(a(),i(E,{key:1,placement:"bottom"},{title:n(()=>[s("span",null,d(e.$t("activity.addUserToProject")),1)]),default:n(()=>[r(c,{type:"text",class:"!rounded-md nc-user-invite",onClick:j=>H(o)},{icon:n(()=>[(a(),i(x(l(y).plus),{class:"flex mx-auto h-[1.1rem] text-gray-500"}))]),_:2},1032,["onClick"])]),_:2},1024)),o.invite_token?(a(),i(de,{key:3,trigger:["click"],class:"flex",placement:"bottomRight","overlay-class-name":"nc-dropdown-user-mgmt"},{overlay:n(()=>[r(ce,null,{default:n(()=>[r(V,null,{default:n(()=>[s("div",{class:"flex flex-row items-center py-3",onClick:j=>se(o)},[(a(),i(x(l(y).sendEmail),{class:"flex h-[1rem] text-gray-500"})),s("div",yt,d(e.$t("activity.resendInvite")),1)],8,xt)]),_:2},1024),r(V,null,{default:n(()=>[s("div",{class:"flex flex-row items-center py-3",onClick:j=>oe(o)},[(a(),i(x(l(y).copy),{class:"flex h-[1rem] text-gray-500"})),s("div",wt,d(e.$t("activity.copyInviteURL")),1)],8,ht)]),_:2},1024)]),_:2},1024)]),default:n(()=>[s("div",ft,[r(c,{type:"text",class:"!px-0"},{default:n(()=>[s("div",vt,[r(re)])]),_:1})])]),_:2},1024)):g("",!0)],64))])]))),128)),r(ue,{current:l(U),"onUpdate:current":t[6]||(t[6]=o=>D(U)?U.value=o:null),"page-size":l(M),"onUpdate:pageSize":t[7]||(t[7]=o=>D(M)?M.value=o:null),"hide-on-single-page":"",class:"mt-4",total:+l(L),"show-less-items":"",onChange:v},null,8,["current","page-size","total"])])]))}}});export{es as default};
