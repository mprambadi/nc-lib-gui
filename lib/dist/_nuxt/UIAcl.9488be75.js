import{_ as ee}from"./Tooltip.vue.00c0d0fb.js";import{_ as te}from"./Button.vue.02ce6d5b.js";import{_ as se}from"./Checkbox.vue.3730d8c8.js";import{_ as ae}from"./TableIcon.vue.03001c7d.js";import{_ as oe}from"./ViewIcon.vue.fd0fd4d4.js";import{k as ne}from"./index.9b87fcff.js";import{f as le,M as ie,bF as ce,bb as re,r as _,g as V,$ as me,i as pe,o as n,c as r,a,b as l,w as o,d as h,t as s,O as i,P as $,Q as C,R as I,W as de,S as R,U as A,_ as E,T,V as ue,X as U,Y as _e,n as fe,a8 as ve,af as he,C as be}from"./entry.96205fa0.js";import{a as we}from"./bases.965a49bb.js";import"./index.1431a68b.js";import{I as ye}from"./Input.3f1aaf0c.js";import{_ as ge}from"./index.aa7d30db.js";import"./index.9e8f59f4.js";import"./debounce.1d5af9bf.js";import"./toNumber.ed208f2f.js";import"./isSymbol.d46b4957.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./index.0b4c0f1e.js";import"./Checkbox.cf2cdba0.js";import"./FormItemContext.b19eb48c.js";import"./createForOfIteratorHelper.f2005dfe.js";import"./iconify.e008aad7.js";import"./index.0c5b3837.js";import"./SearchOutlined.c9794270.js";import"./isPlainObject.631eb8fb.js";import"./_getPrototype.459a70cf.js";import"./TextArea.b81a19ed.js";import"./antInputDirective.8ac36ea7.js";import"./Password.803cc3dc.js";import"./eagerComputed.5bad0f6f.js";import"./useState.5a301439.js";import"./index.339951af.js";import"./LeftOutlined.5e2085dd.js";import"./RightOutlined.3ce786f5.js";import"./index.b5e393d6.js";import"./toArray.3561b70e.js";import"./isMobile.e2e89480.js";import"./useMemo.dbc63a5f.js";import"./CheckOutlined.3b90c20d.js";import"./useBreakpoint.2e009418.js";import"./responsiveObserve.358bcfe9.js";import"./index.11096307.js";import"./index.6c1d17b6.js";import"./Dropdown.1dedd322.js";import"./index.10eee714.js";const xe={class:"flex flex-row w-full items-center justify-center"},ke={class:"flex flex-col w-[900px]"},$e={class:"flex flex-row items-center w-full mb-4 gap-2 justify-between"},Ce={class:"flex"},Ie={class:"flex items-center gap-2 text-gray-600 font-light"},Te={class:"flex flex-row items-center w-full gap-x-1"},Ne={class:"flex"},je={class:"max-h-600px overflow-y-auto"},Me={key:0,class:"flex flex-row gap-x-1"},Le={class:"flex capitalize"},Ve={key:0},Re={class:"flex items-center gap-1"},Ae={class:"min-w-5 flex items-center justify-center"},Ee={key:1},Ue={class:"flex items-center gap-1"},Be={class:"min-w-5 flex items-center justify-center"},Se={key:0},ze={key:0},De={key:1},Vt=le({__name:"UIAcl",props:{sourceId:{}},setup(B){const S=B,{t:d}=ie(),{$api:N,$e:z}=be(),{base:x}=ce(we()),D=re(ne,_()),b=V(()=>{var e;return D.value??((e=x.value)==null?void 0:e.id)}),{includeM2M:G}=me(),j=_(["editor","commenter","viewer"]),w=_(!1),y=_([]),f=_(""),u=_({editor:!1,commenter:!1,viewer:!1}),g=V(()=>y.value.filter(e=>(e==null?void 0:e.source_id)===S.sourceId&&(typeof(e==null?void 0:e._ptn)=="string"&&e._ptn.toLowerCase().includes(f.value.toLowerCase())||typeof(e==null?void 0:e.title)=="string"&&e.title.toLowerCase().includes(f.value.toLowerCase()))));async function M(){try{if(!b.value)return;w.value=!0,y.value=await N.base.modelVisibilityList(b.value,{includeM2M:G.value})}catch(e){console.error(e)}finally{w.value=!1}}async function P(){try{if(!b.value)return;await N.base.modelVisibilitySet(b.value,y.value.filter(e=>e.edited)),U.success(d("msg.success.updatedUIACL"))}catch(e){U.error(await _e(e))}z("a:proj-meta:ui-acl")}const F=(e,c)=>{e.disabled[c]=!e.disabled[c],e.edited=!0,u.value[c]=g.value.every(m=>!m.disabled[c])};pe(async()=>{y.value.length===0&&await M();for(const e of j.value)u.value[e]=g.value.every(c=>!c.disabled[e])});const v=e=>()=>fe("div",{class:"text-gray-500"},e),H=[{title:v(d("labels.tableName")),name:"Table Name"},{title:v(d("labels.viewName")),name:"View Name"},{title:v(d("objects.roleType.editor")),name:"editor",width:120},{title:v(d("objects.roleType.commenter")),name:"commenter",width:120},{title:v(d("objects.roleType.viewer")),name:"viewer",width:120}],O=e=>{u.value[e]=!u.value[e];const c=u.value[e];g.value.forEach(m=>{m.disabled[e]=!c,m.edited=!0})};return(e,c)=>{const m=ee,Q=ye,W=ve,X=te,L=se,Y=E,q=ae,J=oe,K=he,Z=ge;return n(),r("div",xe,[a("div",ke,[l(m,{class:"mb-4 first-letter:capital font-bold max-w-100 truncate","show-on-truncate-only":""},{title:o(()=>[h(s(i(x).title),1)]),default:o(()=>[a("span",null," UI ACL : "+s(i(x).title),1)]),_:1}),a("div",$e,[l(Q,{value:i(f),"onUpdate:value":c[0]||(c[0]=t=>de(f)?f.value=t:null),placeholder:e.$t("placeholder.searchModels"),class:"nc-acl-search !w-[400px]"},{prefix:o(()=>[(n(),$(C(i(I).search)))]),_:1},8,["value","placeholder"]),a("div",Ce,[l(W,{type:"text",ghost:"",class:"self-start !rounded-md nc-acl-reload",onClick:M},{default:o(()=>[a("div",Ie,[(n(),$(C(i(I).reload),{class:R({"animate-infinite animate-spin !text-success":i(w)})},null,8,["class"])),h(" "+s(e.$t("general.reload")),1)])]),_:1}),l(X,{size:"large",class:"z-10 !rounded-lg !px-2 mr-2.5",type:"primary",onClick:P},{default:o(()=>[a("div",Te,[(n(),$(C(i(I).save))),a("div",Ne,s(e.$t("general.save")),1)])]),_:1})])]),a("div",je,[l(Z,{class:"w-full",size:"small","data-source":i(g),columns:H,pagination:!1,loading:i(w),sticky:"",bordered:"","custom-row":t=>({class:`nc-acl-table-row nc-acl-table-row-${t.title}`})},{headerCell:o(({column:t})=>[["editor","commenter","viewer"].includes(t.name)?(n(),r("div",Me,[l(L,{checked:i(u)[t.name],onChange:()=>O(t.name)},null,8,["checked","onChange"]),a("div",Le,s(t.name),1)])):(n(),r(A,{key:1},[h(s(t.name),1)],64))]),emptyText:o(()=>[l(Y,{image:i(E).PRESENTED_IMAGE_SIMPLE,description:e.$t("labels.noData")},null,8,["image","description"])]),bodyCell:o(({record:t,column:k})=>[k.name==="Table Name"?(n(),r("div",Ve,[a("div",Re,[a("div",Ae,[l(q,{meta:{meta:t.table_meta,type:t.ptype},class:"text-gray-500"},null,8,["meta"])]),l(m,{class:"overflow-ellipsis min-w-0 shrink-1 truncate","show-on-truncate-only":""},{title:o(()=>[h(s(t._ptn),1)]),default:o(()=>[a("span",null,s(t._ptn),1)]),_:2},1024)])])):T("",!0),k.name==="View Name"?(n(),r("div",Ee,[a("div",Ue,[a("div",Be,[l(J,{meta:t,class:"text-gray-500"},null,8,["meta"])]),l(m,{class:"overflow-ellipsis min-w-0 shrink-1 truncate","show-on-truncate-only":""},{title:o(()=>[h(s(t.title),1)]),default:o(()=>[a("span",null,s(t.title),1)]),_:2},1024)])])):T("",!0),(n(!0),r(A,null,ue(i(j),p=>(n(),r("div",{key:p},[k.name===p?(n(),r("div",Se,[l(K,null,{title:o(()=>[t.disabled[p]?(n(),r("span",ze,s(e.$t("labels.clickToMake"))+" '"+s(t.title)+"' "+s(e.$t("labels.visibleForRole"))+" "+s(p)+" "+s(e.$t("labels.inUI"))+" dashboard",1)):(n(),r("span",De,s(e.$t("labels.clickToHide"))+"'"+s(t.title)+"' "+s(e.$t("labels.forRole"))+":"+s(p)+" "+s(e.$t("labels.inUI")),1))]),default:o(()=>[l(L,{checked:!t.disabled[p],class:R(`nc-acl-${t.title}-${p}-chkbox !ml-0.25`),onChange:Ge=>F(t,p)},null,8,["checked","class","onChange"])]),_:2},1024)])):T("",!0)]))),128))]),_:1},8,["data-source","loading","custom-row"])])])])}}});export{Vt as default};
