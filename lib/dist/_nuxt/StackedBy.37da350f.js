import{f as z,ba as R,r as s,bb as l,H,g as C,cG as W,c9 as q,O as a,o as r,P as f,w as d,c as J,cb as c,a as n,b,W as h,T as v,au as Q,d as X,t as I,a0 as Y,a1 as Z,a8 as ee}from"./entry.5958c07b.js";import{_ as oe}from"./Icon.vue.129448d5.js";import{j as te,M as ae,A as ne,b as se,f as ie}from"./index.9b87fcff.js";import{a as le}from"./useKanbanViewStore.9f7f1dc5.js";import{u as re}from"./index.852e6a77.js";import{f as de}from"./bases.e6c8e3c4.js";import{u as ce}from"./useViewColumns.f203dc14.js";import{D as pe}from"./index.dc13a4d6.js";import{_ as ue}from"./index.5c6e4286.js";import"./deepCompare.d32ec333.js";import"./dataUtils.3f874ca1.js";import"./useSmartsheetStore.f1a70558.js";import"./views.4281cbf1.js";import"./useSharedView.e8f68616.js";import"./index.e61e381a.js";import"./index.0feaca99.js";import"./Dropdown.041b2468.js";import"./RightOutlined.7161c742.js";import"./toArray.fd74ce6f.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.1dd071d8.js";import"./useState.b891c8bb.js";import"./CheckOutlined.1fe5f230.js";import"./SearchOutlined.a517903c.js";import"./FormItemContext.ddc65fa5.js";const me=Y(()=>Z(()=>import("./EditOrAddProvider.d18fd4c3.js"),["./EditOrAddProvider.d18fd4c3.js","./EditOrAddProvider.vue.31035ffc.js","./entry.5958c07b.js","./entry.bdecbb78.css","./Icon.vue.129448d5.js","./Button.vue.c3ca0e8f.js","./index.55641318.js","./debounce.7c24f171.js","./toNumber.e09cd85a.js","./isSymbol.114fe557.js","./_plugin-vue_export-helper.c27b6911.js","./Button.ff10bcb0.css","./index.9b87fcff.js","./views.4281cbf1.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./useSharedView.e8f68616.js","./validation.2de04583.js","./index.b06c8b67.js","./FormItem.0bbf90a3.js","./identity.34c7640e.js","./_getPrototype.c1f3bae2.js","./Col.a97e3e76.js","./responsiveObserve.0baefba6.js","./toArray.fd74ce6f.js","./FormItemContext.ddc65fa5.js","./useSize.fad35fe8.js","./_flatRest.39582a58.js","./isPlainObject.ccda79fe.js","./vuedraggable.umd.00f5fccc.js","./v3-infinite-loading.660bd977.js","./index.dc13a4d6.js","./Dropdown.041b2468.js","./RightOutlined.7161c742.js","./index.ae235b22.js","./Input.dca3a2bc.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.a517903c.js","./TextArea.9074ff05.js","./Password.f52125e7.js","./cell.165313cd.js","./index.5e1434a7.js","./Checkbox.2e7b0035.js","./createForOfIteratorHelper.33de41ba.js","./index.5c6e4286.js","./isMobile.e2e89480.js","./useMemo.1dd071d8.js","./useState.b891c8bb.js","./CheckOutlined.1fe5f230.js","./EditOrAddProvider.9247d0ff.css"],import.meta.url).then(p=>p.default||p)),_e={class:"nc-kanban-btn"},fe={class:"flex items-center gap-1"},be={class:"text-capitalize !text-sm"},ve={class:"font-bold ml-0.25"},ge=n("div",null,"Select a field to stack records by",-1),we={class:"nc-fields-list py-2"},ke={class:"grouping-field"},ye={class:"mt-4 border-1 px-4 pt-4 pb-3 border-gray-50 rounded-2xl"},Ce=n("div",{class:"text-base font-medium mb-2"},"Options",-1),Je=z({__name:"StackedBy",setup(p){R(te,s(!0));const x=l(ae,s()),u=l(ne,s()),S=l(se,s(!1)),V=l(ie,s(!1)),{fields:D,loadViewColumns:B,metaColumnById:O}=ce(),{kanbanMetaData:g,loadKanbanMeta:w,loadKanbanData:k,updateKanbanMeta:j,groupingField:M,groupingFieldColumn:F}=le(),{addUndo:K,defineViewScope:P}=de(),t=s(!1);re(t),H(()=>{var o;return(o=u.value)==null?void 0:o.id},async(o,e)=>{o!==e&&x.value&&await B()},{immediate:!0});const m=async o=>{var e;await j({fk_grp_col_id:o}),await w(),await k(),((e=u.value)==null?void 0:e.view).fk_grp_col_id=o},_=C({get:()=>g.value.fk_grp_col_id,set:async o=>{o&&(K({undo:{fn:await m,args:[g.value.fk_grp_col_id]},redo:{fn:await m,args:[o]},scope:P({view:u.value})}),await m(o))}}),T=C(()=>{var o;return(o=D.value)==null?void 0:o.filter(e=>e.fk_column_id&&O.value[e.fk_column_id].uidt===W.SingleSelect).map(e=>({value:e.fk_column_id,label:e.title}))}),A=async()=>{t.value=!1,await w(),await k()},E=()=>{t.value=!1};return(o,e)=>{const y=oe,U=ee,G=ue,L=me,N=pe,$=q("e");return a(S)?v("",!0):(r(),f(N,{key:0,visible:a(t),"onUpdate:visible":e[6]||(e[6]=i=>h(t)?t.value=i:null),trigger:["click"],"overlay-class-name":"nc-dropdown-kanban-stacked-by-menu",class:"!xs:hidden"},{overlay:d(()=>[a(t)?(r(),J("div",{key:0,class:"p-6 w-90 bg-white shadow-lg nc-table-toolbar-menu !border-1 border-gray-50 rounded-2xl",onClick:e[5]||(e[5]=c(()=>{},["stop"]))},[ge,n("div",we,[n("div",ke,[b(G,{value:a(_),"onUpdate:value":e[0]||(e[0]=i=>h(_)?_.value=i:null),class:"w-full nc-kanban-grouping-field-select",options:a(T),placeholder:"Select a Grouping Field",onChange:E,onClick:e[1]||(e[1]=c(()=>{},["stop"]))},{suffixIcon:d(()=>[b(y,{icon:"arrowDown",class:"text-gray-700"})]),_:1},8,["value","options"])])]),n("div",ye,[Ce,a(t)?(r(),f(L,{key:0,column:a(F),"embed-mode":"","column-label":o.$t("general.changes"),"hide-title":"","hide-type":"","hide-additional-options":"",onCancel:e[2]||(e[2]=i=>t.value=!1),onSubmit:A,onClick:e[3]||(e[3]=c(()=>{},["stop"])),onKeydown:e[4]||(e[4]=c(()=>{},["stop"]))},null,8,["column","column-label"])):v("",!0)])])):v("",!0)]),default:d(()=>[n("div",_e,[Q((r(),f(U,{class:"nc-kanban-stacked-by-menu-btn nc-toolbar-btn",disabled:a(V)},{default:d(()=>[n("div",fe,[b(y,{icon:"layers",class:"mr-0.5"}),n("span",be,[X(I(o.$t("activity.kanban.stackedBy"))+" ",1),n("span",ve,I(a(M)),1)])])]),_:1},8,["disabled"])),[[$,["c:kanban:change-grouping-field"]]])])]),_:1},8,["visible"]))}}});export{Je as default};
