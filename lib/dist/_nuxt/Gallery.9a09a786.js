import{f as Le,bb as v,r as m,bA as ze,bF as Pe,ba as k,c8 as je,u as Te,g,aM as Fe,a7 as Oe,H as Ue,eN as Me,c9 as $e,o as l,c as i,b as w,w as d,O as e,P as u,au as Ne,d as qe,t as Be,T as I,a as _,S as Ge,U as h,V as L,dy as He,eW as M,W as z,d4 as ae,f_ as ne,a0 as p,a1 as f,ce as We,cf as Je,p as Xe,e as Ye}from"./entry.5958c07b.js";import{u as Ke}from"./views.4281cbf1.js";import{a as Qe}from"./useSmartsheetStore.f1a70558.js";import{M as Ze,A as et,h as tt,R as ot,O as at,c as nt,y as lt,q as st,z as rt,F as it,B as ut}from"./index.9b87fcff.js";import{e as mt}from"./dataUtils.3f874ca1.js";import{i as dt}from"./fileUtils.43128440.js";import{A as _t}from"./cell.165313cd.js";import{u as ct}from"./useAttachment.6cac8464.js";import{u as pt}from"./useViewData.1858eb56.js";import{_ as ft}from"./chevron-right.ec8c7e51.js";import{_ as yt,a as wt}from"./FileIconImageBox.f602208f.js";import{_ as vt}from"./index.bed897b5.js";import{C as gt}from"./index.f98c1d80.js";import{D as ht}from"./index.dc13a4d6.js";import{_ as xt}from"./Input.8209df88.js";import{_ as bt}from"./_plugin-vue_export-helper.c27b6911.js";import"./bases.e6c8e3c4.js";import"./index.0feaca99.js";import"./useSharedView.e8f68616.js";import"./index.e61e381a.js";import"./urlUtils.18c797fa.js";import"./virtualCell.427fa223.js";import"./debounce.7c24f171.js";import"./toNumber.e09cd85a.js";import"./isSymbol.114fe557.js";import"./index.912f77e8.js";import"./Dropdown.041b2468.js";import"./useState.b891c8bb.js";import"./useRefs.40c81887.js";import"./identity.34c7640e.js";import"./_flatRest.39582a58.js";import"./isMobile.e2e89480.js";import"./index.357e1bba.js";import"./Col.a97e3e76.js";import"./responsiveObserve.0baefba6.js";import"./isPlainObject.ccda79fe.js";import"./_getPrototype.c1f3bae2.js";import"./RightOutlined.7161c742.js";import"./Element.a1e4f356.js";const Vt=p(()=>f(()=>import("./Image.36097f59.js"),["./Image.36097f59.js","./entry.5958c07b.js","./entry.bdecbb78.css"],import.meta.url).then(n=>n.default||n)),kt=p(()=>f(()=>import("./VirtualCell.3d02a7f6.js"),["./VirtualCell.3d02a7f6.js","./entry.5958c07b.js","./entry.bdecbb78.css","./index.9b87fcff.js","./virtualCell.427fa223.js","./cell.165313cd.js"],import.meta.url).then(n=>n.default||n)),It=p(()=>f(()=>import("./Cell.2a47fcd0.js"),["./Cell.2a47fcd0.js","./entry.5958c07b.js","./entry.bdecbb78.css","./index.9b87fcff.js","./cell.165313cd.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./useSmartsheetRowStore.5b92cc1b.js","./deepCompare.d32ec333.js","./dataUtils.3f874ca1.js","./virtualCell.427fa223.js","./index.e61e381a.js","./_plugin-vue_export-helper.c27b6911.js","./Cell.f27da8af.css"],import.meta.url).then(n=>n.default||n)),Rt=p(()=>f(()=>import("./VirtualCell.276a28e0.js"),["./VirtualCell.276a28e0.js","./entry.5958c07b.js","./entry.bdecbb78.css","./Tooltip.vue.971897f4.js","./Tooltip.b86f91a1.css","./EditOrAddProvider.vue.31035ffc.js","./Icon.vue.129448d5.js","./Button.vue.c3ca0e8f.js","./index.55641318.js","./debounce.7c24f171.js","./toNumber.e09cd85a.js","./isSymbol.114fe557.js","./_plugin-vue_export-helper.c27b6911.js","./Button.ff10bcb0.css","./index.9b87fcff.js","./views.4281cbf1.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./useSharedView.e8f68616.js","./validation.2de04583.js","./index.b06c8b67.js","./FormItem.0bbf90a3.js","./identity.34c7640e.js","./_getPrototype.c1f3bae2.js","./Col.a97e3e76.js","./responsiveObserve.0baefba6.js","./toArray.fd74ce6f.js","./FormItemContext.ddc65fa5.js","./useSize.fad35fe8.js","./_flatRest.39582a58.js","./isPlainObject.ccda79fe.js","./vuedraggable.umd.00f5fccc.js","./v3-infinite-loading.660bd977.js","./index.dc13a4d6.js","./Dropdown.041b2468.js","./RightOutlined.7161c742.js","./index.ae235b22.js","./Input.dca3a2bc.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.a517903c.js","./TextArea.9074ff05.js","./Password.f52125e7.js","./cell.165313cd.js","./index.5e1434a7.js","./Checkbox.2e7b0035.js","./createForOfIteratorHelper.33de41ba.js","./index.5c6e4286.js","./isMobile.e2e89480.js","./useMemo.1dd071d8.js","./useState.b891c8bb.js","./CheckOutlined.1fe5f230.js","./EditOrAddProvider.9247d0ff.css","./virtualCell.427fa223.js","./VirtualCell.ff98befc.css"],import.meta.url).then(n=>n.default||n)),Dt=p(()=>f(()=>import("./Cell.0991f33c.js"),["./Cell.0991f33c.js","./entry.5958c07b.js","./entry.bdecbb78.css","./CellIcon.b1340151.js","./index.9b87fcff.js","./cell.165313cd.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./Tooltip.vue.971897f4.js","./Tooltip.b86f91a1.css","./EditOrAddProvider.vue.31035ffc.js","./Icon.vue.129448d5.js","./Button.vue.c3ca0e8f.js","./index.55641318.js","./debounce.7c24f171.js","./toNumber.e09cd85a.js","./isSymbol.114fe557.js","./_plugin-vue_export-helper.c27b6911.js","./Button.ff10bcb0.css","./views.4281cbf1.js","./useSharedView.e8f68616.js","./validation.2de04583.js","./index.b06c8b67.js","./FormItem.0bbf90a3.js","./identity.34c7640e.js","./_getPrototype.c1f3bae2.js","./Col.a97e3e76.js","./responsiveObserve.0baefba6.js","./toArray.fd74ce6f.js","./FormItemContext.ddc65fa5.js","./useSize.fad35fe8.js","./_flatRest.39582a58.js","./isPlainObject.ccda79fe.js","./vuedraggable.umd.00f5fccc.js","./v3-infinite-loading.660bd977.js","./index.dc13a4d6.js","./Dropdown.041b2468.js","./RightOutlined.7161c742.js","./index.ae235b22.js","./Input.dca3a2bc.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.a517903c.js","./TextArea.9074ff05.js","./Password.f52125e7.js","./index.5e1434a7.js","./Checkbox.2e7b0035.js","./createForOfIteratorHelper.33de41ba.js","./index.5c6e4286.js","./isMobile.e2e89480.js","./useMemo.1dd071d8.js","./useState.b891c8bb.js","./CheckOutlined.1fe5f230.js","./EditOrAddProvider.9247d0ff.css","./Cell.14116970.css"],import.meta.url).then(n=>n.default||n)),Ct=p(()=>f(()=>import("./Row.3bf51c0f.js"),["./Row.3bf51c0f.js","./index.9b87fcff.js","./useSmartsheetRowStore.5b92cc1b.js","./entry.5958c07b.js","./entry.bdecbb78.css","./deepCompare.d32ec333.js","./dataUtils.3f874ca1.js","./virtualCell.427fa223.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./index.e61e381a.js","./useSmartsheetStore.f1a70558.js","./views.4281cbf1.js","./useSharedView.e8f68616.js"],import.meta.url).then(n=>n.default||n)),Et=p(()=>f(()=>import("./Pagination.cfda58a8.js"),["./Pagination.cfda58a8.js","./Pagination.c0f166a7.js","./Icon.vue.129448d5.js","./entry.5958c07b.js","./entry.bdecbb78.css","./Button.vue.c3ca0e8f.js","./index.55641318.js","./debounce.7c24f171.js","./toNumber.e09cd85a.js","./isSymbol.114fe557.js","./_plugin-vue_export-helper.c27b6911.js","./Button.ff10bcb0.css","./Tooltip.vue.971897f4.js","./Tooltip.b86f91a1.css","./index.5c6e4286.js","./toArray.fd74ce6f.js","./antInputDirective.8ac36ea7.js","./isMobile.e2e89480.js","./useMemo.1dd071d8.js","./useState.b891c8bb.js","./CheckOutlined.1fe5f230.js","./SearchOutlined.a517903c.js","./FormItemContext.ddc65fa5.js","./Pagination.fabf8b70.css","./views.4281cbf1.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./useSharedView.e8f68616.js","./index.9b87fcff.js","./sidebar.f5d81718.js","./index.025c8e21.js","./index.36af7517.js","./Element.a1e4f356.js","./Input.8209df88.js","./Image.c63a7a56.js","./index.ae235b22.js","./Input.dca3a2bc.js","./isPlainObject.ccda79fe.js","./_getPrototype.c1f3bae2.js","./TextArea.9074ff05.js","./Password.f52125e7.js","./Pagination.9422c247.css"],import.meta.url).then(n=>n.default||n)),At=p(()=>f(()=>import("./index.caa4cb22.js").then(n=>n.i),["./index.caa4cb22.js","./entry.5958c07b.js","./entry.bdecbb78.css","./Button.vue.c3ca0e8f.js","./index.55641318.js","./debounce.7c24f171.js","./toNumber.e09cd85a.js","./isSymbol.114fe557.js","./_plugin-vue_export-helper.c27b6911.js","./Button.ff10bcb0.css","./Icon.vue.129448d5.js","./Menu.vue.6c65c050.js","./Menu.eff4a609.css","./Divider.7b1fba82.js","./index.07078df6.js","./Divider.3e739d27.css","./Dropdown.vue.0d2ed10f.js","./index.dc13a4d6.js","./Dropdown.041b2468.js","./RightOutlined.7161c742.js","./DivDataCell.7c09732c.js","./index.9b87fcff.js","./DivDataCell.1a716a1e.css","./Tooltip.vue.971897f4.js","./Tooltip.b86f91a1.css","./UserIcon.74e37fbe.js","./UserIcon.fda3e825.css","./config.c8203633.js","./sidebar.f5d81718.js","./bases.e6c8e3c4.js","./index.0feaca99.js","./views.4281cbf1.js","./useSharedView.e8f68616.js","./dataUtils.3f874ca1.js","./index.e61e381a.js","./useKanbanViewStore.9f7f1dc5.js","./deepCompare.d32ec333.js","./useSmartsheetStore.f1a70558.js","./useSmartsheetRowStore.5b92cc1b.js","./virtualCell.427fa223.js","./iconify.e2b5aaa4.js","./index.ae235b22.js","./Input.dca3a2bc.js","./antInputDirective.8ac36ea7.js","./FormItemContext.ddc65fa5.js","./SearchOutlined.a517903c.js","./isPlainObject.ccda79fe.js","./_getPrototype.c1f3bae2.js","./TextArea.9074ff05.js","./Password.f52125e7.js","./Modal.vue.0f13e4cb.js","./DeleteModal.7ab6f524.css","./DeleteModal.vue.0320a9db.js","./Modal.vue.ee5af191.js","./useDashboard.7eae7d45.js","./index.c35df397.js","./Input.8209df88.js","./Element.a1e4f356.js","./index.35cd520e.css"],import.meta.url).then(n=>n.default||n)),le=n=>(Xe("data-v-c9f5949b"),n=n(),Ye(),n),St={class:"nc-base-menu-item"},Lt={key:0,class:"flex flex-col h-full"},zt={class:"flex flex-row p-3 !pr-1 gap-x-2 flex-wrap gap-y-2"},Pt={key:1,class:"nc-gallery-container grid gap-3 my-4 px-3"},jt=le(()=>_("a",null,[_("div",{class:"pt-[12px]"},[_("div")])],-1)),Tt={class:"z-10 arrow"},Ft={class:"z-10 arrow"},Ot={key:1,class:"h-52 w-full !flex flex-row !border-b-1 !border-gray-200 items-center justify-center"},Ut=le(()=>_("img",{class:"object-contain w-[48px] h-[48px]",src:wt},null,-1)),Mt=[Ut],$t={key:0,class:"text-base mt-3 mx-3 font-bold"},Nt={class:"flex flex-col first:mt-3 ml-2 !pr-3.5 !mb-[0.75rem] rounded-lg w-full"},qt={class:"flex flex-row w-full justify-start scale-75"},Bt={class:"w-full pb-1 text-gray-300"},Gt={key:0,class:"flex flex-row w-full text-gray-700 px-1 mt-[-0.25rem] items-center justify-start"},Ht={key:1,class:"flex flex-row w-full h-[1.375rem] pl-1 items-center justify-start"},Wt=Le({__name:"Gallery",setup(n){const y=v(Ze,m()),R=v(et,m()),P=v(tt),D=v(ot),j=v(at,ze()),{isViewDataLoading:C}=Pe(Ke()),{isSqlView:$,xWhere:se}=Qe(),x=m(!1),T=m(),N=m(),{loadData:q,paginationData:F,formattedData:re,loadGalleryData:B,galleryData:G,changePage:ie,addEmptyRow:ue,deleteRow:me,navigateToSiblingRow:H}=pt(y,R,se);k(nt,m(!1)),k(lt,m(!0)),k(st,m(!1)),k(rt,m(1));const W=v(it,m([])),E=je(),J=Te(),{getPossibleAttachmentSrc:de}=ct(),_e=g(()=>W.value.filter(a=>!_t(a))),c=g(()=>{var a,t;return((t=(a=y.value)==null?void 0:a.columns)==null?void 0:t.find(r=>r.pv&&W.value.includes(r)))??null}),b=g(()=>{var a,t;return(a=y.value)!=null&&a.columnsById?y.value.columnsById[(t=G.value)==null?void 0:t.fk_cover_image_col_id]:{}}),ce=(a,t)=>{const r=a.row[t.title];return r?Array.isArray(r)&&r.length===0:!0},{isUIAllowed:pe}=Fe(),fe=g(()=>pe("dataEdit")),X=m(!1),A=g({get:()=>X.value,set:a=>{fe.value&&(X.value=a)}}),O=m(null),ye=(a,t)=>{$.value||(a.preventDefault(),t&&(O.value=t))},Y=a=>{var t;try{return(t=b.value)!=null&&t.title&&a.row[b.value.title]?typeof a.row[b.value.title]=="string"?JSON.parse(a.row[b.value.title]):a.row[b.value.title]:[]}catch{return[]}},K=(a,t)=>{const r=mt(a.row,y.value.columns);r?J.push({query:{...E.query,rowId:r}}):(T.value=a,N.value=t,x.value=!0)},Q=async(a,t)=>{const r=a.target;r.closest(".arrow")||r.closest(".slick-dots")||K(t)};j==null||j.on(async()=>{const a=await ue();K(a)});const S=g({get(){return!!E.query.rowId},set(a){a||J.push({query:{...E.query,rowId:void 0}})}}),U=m(!1);return P==null||P.on(async()=>{await B(),U.value=!0,Oe(()=>{U.value=!1})}),D==null||D.on(async()=>{await q()}),k(ut,D),Ue(R,async a=>{C.value=!0;try{(a==null?void 0:a.type)===Me.GALLERY&&(await q(),await B())}finally{C.value=!1}},{immediate:!0}),(a,t)=>{const r=We,we=Je,ve=xt,ge=yt,he=ft,xe=Vt,be=vt,Z=kt,ee=It,Ve=Rt,ke=Dt,Ie=gt,Re=Ct,De=ht,Ce=Et,te=At,Ee=$e("e");return l(),i(h,null,[w(De,{visible:e(A),"onUpdate:visible":t[2]||(t[2]=o=>z(A)?A.value=o:null),trigger:e($)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:d(()=>[w(we,{class:"shadow !rounded !py-0",onClick:t[1]||(t[1]=o=>A.value=!1)},{default:d(()=>[e(O)?(l(),u(r,{key:0,onClick:t[0]||(t[0]=o=>e(me)(e(O).row))},{default:d(()=>[Ne((l(),i("div",St,[qe(Be(a.$t("activity.deleteRow")),1)])),[[Ee,["a:row:delete"]]])]),_:1})):I("",!0)]),_:1})]),default:d(()=>[_("div",{class:Ge(["flex flex-col w-full nc-gallery nc-scrollbar-md bg-[#fbfbfb]",{"!overflow-hidden":e(C)}]),"data-testid":"nc-gallery-wrapper",style:{height:"calc(100% - var(--topbar-height) + 0.7rem)"}},[e(C)?(l(),i("div",Lt,[_("div",zt,[(l(!0),i(h,null,L(Array(20),o=>(l(),u(ve,{key:o,class:"!min-w-60.5 !h-96 !rounded-md overflow-hidden"}))),128))])])):(l(),i("div",Pt,[(l(!0),i(h,null,L(e(re),(o,Ae)=>(l(),i("div",{key:`record-${o.row.id}`},[w(Re,{row:o},{default:d(()=>{var oe;return[w(Ie,{class:"!rounded-lg h-full border-gray-200 border-1 group overflow-hidden break-all max-w-[450px] shadow-sm hover:shadow-md cursor-pointer","body-style":{padding:"0px"},"data-testid":`nc-gallery-card-${o.row.id}`,onClick:s=>Q(s,o),onContextmenu:s=>ye(s,{row:Ae})},He({default:d(()=>[e(c)?(l(),i("h2",$t,[e(M)(e(c))?(l(),u(Z,{key:0,modelValue:o.row[e(c).title],"onUpdate:modelValue":s=>o.row[e(c).title]=s,class:"!text-brand-500",column:e(c),row:o},null,8,["modelValue","onUpdate:modelValue","column","row"])):(l(),u(ee,{key:1,modelValue:o.row[e(c).title],"onUpdate:modelValue":s=>o.row[e(c).title]=s,class:"!text-brand-500",column:e(c),"edit-enabled":!1,"read-only":!0},null,8,["modelValue","onUpdate:modelValue","column"]))])):I("",!0),(l(!0),i(h,null,L(e(_e),s=>(l(),i("div",{key:`record-${o.row.id}-${s.id}`},[_("div",Nt,[_("div",qt,[_("div",Bt,[e(M)(s)?(l(),u(Ve,{key:0,column:s,"hide-menu":!0,"hide-icon":!0},null,8,["column"])):(l(),u(ke,{key:1,column:s,"hide-menu":!0,"hide-icon":!0},null,8,["column"]))])]),ce(o,s)?(l(),i("div",Ht,"-")):(l(),i("div",Gt,[e(M)(s)?(l(),u(Z,{key:0,modelValue:o.row[s.title],"onUpdate:modelValue":V=>o.row[s.title]=V,column:s,row:o},null,8,["modelValue","onUpdate:modelValue","column","row"])):(l(),u(ee,{key:1,modelValue:o.row[s.title],"onUpdate:modelValue":V=>o.row[s.title]=V,column:s,"edit-enabled":!1,"read-only":!0},null,8,["modelValue","onUpdate:modelValue","column"]))]))])]))),128))]),_:2},[(oe=e(G))!=null&&oe.fk_cover_image_col_id?{name:"cover",fn:d(()=>[!e(U)&&Y(o).length?(l(),u(be,{key:0,class:"gallery-carousel !border-b-1 !border-gray-200",arrows:""},{customPaging:d(()=>[jt]),prevArrow:d(()=>[_("div",Tt,[w(ge,{class:"text-gray-700 w-6 h-6 absolute left-1.5 bottom-[-90px] !opacity-0 !group-hover:opacity-100 !bg-white border-1 border-gray-200 rounded-md transition"})])]),nextArrow:d(()=>[_("div",Ft,[w(he,{class:"text-gray-700 w-6 h-6 absolute right-1.5 bottom-[-90px] !opacity-0 !group-hover:opacity-100 !bg-white border-1 border-gray-200 rounded-md transition"})])]),default:d(()=>[(l(!0),i(h,null,L(Y(o),(s,V)=>(l(),i(h,null,[e(dt)(s.title,s.mimetype??s.type)?(l(),u(xe,{key:`carousel-${o.row.id}-${V}`,class:"h-52 object-cover",srcs:e(de)(s),onClick:Se=>Q(Se,o)},null,8,["srcs","onClick"])):I("",!0)],64))),256))]),_:2},1024)):(l(),i("div",Ot,Mt))]),key:"0"}:void 0]),1032,["data-testid","onClick","onContextmenu"])]}),_:2},1032,["row"])]))),128))]))],2)]),_:1},8,["visible","trigger"]),w(Ce,{"pagination-data":e(F),"onUpdate:paginationData":t[3]||(t[3]=o=>z(F)?F.value=o:null),"show-api-timing":"","change-page":e(ie)},null,8,["pagination-data","change-page"]),(l(),u(ae,null,{default:d(()=>[e(T)&&e(x)?(l(),u(te,{key:0,modelValue:e(x),"onUpdate:modelValue":t[4]||(t[4]=o=>z(x)?x.value=o:null),row:e(T),state:e(N),meta:e(y),view:e(R)},null,8,["modelValue","row","state","meta","view"])):I("",!0)]),_:1})),(l(),u(ae,null,{default:d(()=>[e(S)?(l(),u(te,{key:0,modelValue:e(S),"onUpdate:modelValue":t[5]||(t[5]=o=>z(S)?S.value=o:null),row:{row:{},oldRow:{},rowMeta:{}},meta:e(y),"row-id":e(E).query.rowId,view:e(R),"show-next-prev-icons":"",onNext:t[6]||(t[6]=o=>e(H)(e(ne).NEXT)),onPrev:t[7]||(t[7]=o=>e(H)(e(ne).PREV))},null,8,["modelValue","meta","row-id","view"])):I("",!0)]),_:1}))],64)}}});const Po=bt(Wt,[["__scopeId","data-v-c9f5949b"]]);export{Po as default};
