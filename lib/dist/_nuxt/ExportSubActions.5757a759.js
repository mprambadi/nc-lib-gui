import{f as O,bb as d,r as p,bF as A,c9 as J,o as r,c as x,a as T,t as w,b as g,w as $,au as N,cb as q,O as s,gh as i,P as u,Q as L,R as D,d as I,U as G,a1 as X,X as Q,Y as U,ce as Y,C as z}from"./entry.96205fa0.js";import{a as H}from"./Button.vue.02ce6d5b.js";import{u as K}from"./views.2c163cf7.js";import{u as W}from"./useSharedView.9e320acb.js";import{b as Z,F as ee,M as te,A as se}from"./index.9b87fcff.js";import{a as ae}from"./bases.965a49bb.js";import"./index.9e8f59f4.js";import"./debounce.1d5af9bf.js";import"./toNumber.ed208f2f.js";import"./isSymbol.d46b4957.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./index.0c5b3837.js";const oe={class:"flex py-3 px-4 font-bold uppercase text-xs text-gray-500"},we=O({__name:"ExportSubActions",setup(re){const B=d(Z,p(!1)),b=d(ee,p([])),P=ae(),{base:R}=A(P),{$api:j}=z(),v=d(te,p()),f=d(se),{activeNestedFilters:y,activeSorts:E}=A(K()),m=p(void 0),S=async e=>{var C,V,k,F;let t=0,n=1;const l=e===i.EXCEL?"base64":"blob";m.value=e;const c=await X(()=>import("./xlsx.6ed613d4.js"),[],import.meta.url),_=await X(()=>import("./FileSaver.min.87a4e9ea.js").then(a=>a.F),["./FileSaver.min.87a4e9ea.js","./entry.96205fa0.js","./entry.d09b2482.css"],import.meta.url);try{for(;!isNaN(t)&&t>-1;){let a;if(B.value){const{exportFile:o}=W();a=await o(b.value,t,e,l,{sortsArr:E.value,filtersArr:y.value})}else a=await j.dbViewRow.export("noco",(C=R.value)==null?void 0:C.id,(V=v.value)==null?void 0:V.id,f==null?void 0:f.value.id,e,{responseType:l,query:{fields:b.value.map(o=>o.title),offset:t,sortArrJson:JSON.stringify(E.value),filterArrJson:JSON.stringify(y.value)}});const{data:h,headers:M}=a;if(e===i.EXCEL){const o=c.read(h,{type:"base64"});c.writeFile(o,`${(k=v.value)==null?void 0:k.title}_exported_${n++}.xlsx`)}else if(e===i.CSV){const o=new Blob([h],{type:"text/plain;charset=utf-8"});_.saveAs(o,`${(F=v.value)==null?void 0:F.title}_exported_${n++}.csv`)}t=+M["nc-export-offset"],setTimeout(()=>{m.value=void 0},200)}}catch(a){Q.error(await U(a))}};return(e,t)=>{const n=H,l=Y,c=J("e");return r(),x(G,null,[T("div",oe,w(e.$t("labels.downloadData")),1),g(l,{class:"!mx-1 !py-2 !rounded-md"},{default:$(()=>[N((r(),x("div",{class:"flex flex-row items-center nc-base-menu-item !py-0",onClick:t[0]||(t[0]=q(_=>S(s(i).CSV),["stop"]))},[s(m)===s(i).CSV?(r(),u(n,{key:0,class:"!max-h-4.5 !-mt-1 !mr-0.7"})):(r(),u(L(s(D).csv),{key:1})),I(w(e.$t("activity.downloadCSV")),1)])),[[c,["a:download:csv"]]])]),_:1}),g(l,{class:"!mx-1 !py-2 !rounded-md"},{default:$(()=>[N((r(),x("div",{class:"flex flex-row items-center nc-base-menu-item !py-0",onClick:t[1]||(t[1]=_=>S(s(i).EXCEL))},[s(m)===s(i).EXCEL?(r(),u(n,{key:0,class:"!max-h-4.5 !-mt-1 !mr-0.7"})):(r(),u(L(s(D).excel),{key:1})),I(w(e.$t("activity.downloadExcel")),1)])),[[c,["a:download:excel"]]])]),_:1})],64)}}});export{we as default};
