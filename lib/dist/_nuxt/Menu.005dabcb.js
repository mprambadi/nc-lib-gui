import{_ as Be}from"./Icon.vue.129448d5.js";import{_ as Re,a as Fe}from"./Menu.vue.6c65c050.js";import{_ as Ne}from"./CellIcon.b1340151.js";import{_ as Ue}from"./DeleteModal.vue.0320a9db.js";import{f as le,a5 as ne,bb as S,r as L,$ as je,o,P as r,w as f,O as t,c as V,b as x,a as O,t as w,T as b,W,eZ as se,eX as ae,X as Z,Y as ie,C as re,L as Ge,bF as Ke,g as oe,ad as Pe,d as D,S as ze,bv as Ye,d1 as ge,gp as U,aF as Xe,M as qe,c9 as Je,Q as R,R as F,au as z,cG as N,U as Ce,aK as Qe,cb as We,a7 as Ze,fS as He}from"./entry.5958c07b.js";import{C as ke,M as de,R as he,A as et,f as tt}from"./index.9b87fcff.js";import{b as ue,a as st,c as at,f as ot}from"./bases.e6c8e3c4.js";import{_ as lt}from"./Button.vue.c3ca0e8f.js";import{_ as nt}from"./Modal.vue.ee5af191.js";import{a as De}from"./useSmartsheetStore.f1a70558.js";import{C as it}from"./index.5e1434a7.js";import{_ as xe}from"./index.07078df6.js";import{u as rt}from"./useViewSorts.a16054fa.js";import{D as dt}from"./index.dc13a4d6.js";import{_ as ut}from"./_plugin-vue_export-helper.c27b6911.js";import"./cell.165313cd.js";import"./index.0feaca99.js";import"./index.55641318.js";import"./debounce.7c24f171.js";import"./toNumber.e09cd85a.js";import"./isSymbol.114fe557.js";import"./views.4281cbf1.js";import"./useSharedView.e8f68616.js";import"./index.e61e381a.js";import"./Checkbox.2e7b0035.js";import"./FormItemContext.ddc65fa5.js";import"./createForOfIteratorHelper.33de41ba.js";import"./Dropdown.041b2468.js";import"./RightOutlined.7161c742.js";const ct={key:0,class:"flex flex-row items-center py-2 px-3 bg-gray-50 rounded-lg text-gray-700 mb-4"},mt={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.5",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},pt=le({__name:"DeleteColumnModal",props:{visible:{type:Boolean}},emits:["update:visible"],setup(Y,{emit:X}){const T=ne(Y,"visible",X),{$api:_,$e:u}=re(),e=S(ke),g=S(de,L()),{getMeta:i}=ue(),{includeM2M:p}=je(),{loadTables:J}=st(),j=L(!1),v=async()=>{var A,d,k,$,m;if(e!=null&&e.value){j.value=!0;try{await _.dbTableColumn.delete((A=e==null?void 0:e.value)==null?void 0:A.id),await i((d=g==null?void 0:g.value)==null?void 0:d.id,!0),se(e==null?void 0:e.value)&&((k=e.value)!=null&&k.colOptions)&&(await i((($=e.value)==null?void 0:$.colOptions).fk_related_model_id,!0),p.value&&((m=e.value)==null?void 0:m.colOptions).type===ae.MANY_TO_MANY&&J()),u("a:column:delete"),T.value=!1}catch(y){Z.error(await ie(y))}finally{j.value=!1}}};return(A,d)=>{const k=Ne,$=Ue;return o(),r($,{visible:t(T),"onUpdate:visible":d[0]||(d[0]=m=>W(T)?T.value=m:null),"entity-name":A.$t("objects.column"),"on-delete":v},{"entity-preview":f(()=>[t(e)?(o(),V("div",ct,[x(k,{class:"nc-view-icon"}),O("div",mt,w(t(e).title),1)])):b("",!0)]),_:1},8,["visible","entity-name"])}}}),vt={class:"prose-xl font-bold self-center"},ft=O("div",{class:"mt-4"},"Are you sure you want to duplicate the field?",-1),_t={class:"prose-md self-center text-gray-500 mt-4"},yt={class:"text-xs p-2"},wt={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},bt=le({__name:"ColumnDuplicate",props:{modelValue:{type:Boolean},column:{},extra:{}},emits:["update:modelValue"],setup(Y,{expose:X,emit:q}){const M=Y,T=q,{api:_}=Ge(),u=ne(M,"modelValue",T),{$e:e,$poller:g}=re();Ke(at());const i=S(he),{eventBus:p}=De(),{getMeta:J}=ue(),j=S(de,L()),v=L({includeData:!0}),A=oe(()=>{const{includeData:m}=v.value;return{excludeData:!m}}),d=L(!1),k=async()=>{await J(j.value.id,!0),p.emit(U.FIELD_RELOAD),i==null||i.trigger()},$=async()=>{try{d.value=!0;const m=await _.dbTable.duplicateColumn(M.column.base_id,M.column.id,{options:A.value,extra:M.extra});g.subscribe({id:m.id},async y=>{y.status!=="close"&&(y.status===ge.COMPLETED?(k(),d.value=!1,u.value=!1):y.status===ge.FAILED&&(Z.error("There was an error duplicating the column."),k(),d.value=!1,u.value=!1))}),e("a:column:duplicate")}catch(m){Z.error(await ie(m)),d.value=!1,u.value=!1}};return Pe("Enter",()=>{u.value&&$()}),X({duplicate:$}),(m,y)=>{const G=xe,ee=it,Q=lt,K=nt;return o(),r(K,{visible:t(u),"onUpdate:visible":y[2]||(y[2]=B=>W(u)?u.value=B:null),class:ze([{active:t(u)},"!w-[30rem]"]),closable:!t(d),"mask-closable":!t(d),keyboard:!t(d),centered:"","wrap-class-name":"nc-modal-column-duplicate",footer:null,onKeydown:y[3]||(y[3]=Ye(B=>u.value=!1,["esc"]))},{default:f(()=>[O("div",null,[O("div",vt,w(m.$t("general.duplicate"))+" "+w(m.$t("objects.column")),1),ft,O("div",_t,w(m.$t("title.advancedSettings")),1),x(G,{class:"!m-0 !p-0 !my-2"}),O("div",yt,[x(ee,{checked:t(v).includeData,"onUpdate:checked":y[0]||(y[0]=B=>t(v).includeData=B),disabled:t(d)},{default:f(()=>[D(w(m.$t("labels.includeData")),1)]),_:1},8,["checked","disabled"])])]),O("div",wt,[t(d)?b("",!0):(o(),r(Q,{key:"back",type:"secondary",onClick:y[1]||(y[1]=B=>u.value=!1)},{default:f(()=>[D(w(m.$t("general.cancel")),1)]),_:1})),x(Q,{key:"submit",type:"primary",loading:t(d),onClick:$},{default:f(()=>[D(w(m.$t("general.confirm")),1)]),_:1},8,["loading"])])]),_:1},8,["visible","class","closable","mask-closable","keyboard"])}}}),gt={class:"nc-column-edit nc-header-menu-item"},Ct={class:"nc-column-insert-before nc-header-menu-item"},kt={class:"nc-column-set-primary nc-header-menu-item item"},ht={class:"nc-column-insert-after nc-header-menu-item"},Dt={class:"nc-column-insert-before nc-header-menu-item"},xt={class:"nc-column-duplicate nc-header-menu-item"},$t={class:"nc-column-insert-after nc-header-menu-item"},Lt={class:"nc-column-insert-before nc-header-menu-item"},Ot={class:"nc-column-delete nc-header-menu-item text-red-600"},It=le({__name:"Menu",props:{virtual:{type:Boolean},isOpen:{type:Boolean}},emits:["edit","addColumn","update:isOpen"],setup(Y,{emit:X}){const q=Y,M=X,T=Xe(q,"virtual"),_=ne(q,"isOpen",M),{eventBus:u}=De(),e=S(ke),g=S(he),i=S(de,L()),p=S(et,L()),{insertSort:J}=rt(p,()=>g==null?void 0:g.trigger()),j=S(tt),{$api:v,$e:A}=re(),{t:d}=qe(),{getMeta:k}=ue(),{addUndo:$,defineModelScope:m,defineViewScope:y}=ot(),G=L(!1),ee=async()=>{var c,s,l,a,n;try{const C=(s=(c=i==null?void 0:i.value)==null?void 0:c.columns)==null?void 0:s.find(h=>h.pv);_.value=!1,await v.dbTableColumn.primaryColumnSet((l=e==null?void 0:e.value)==null?void 0:l.id),await k((a=i==null?void 0:i.value)==null?void 0:a.id,!0),u.emit(U.FIELD_RELOAD),A("a:column:set-primary"),$({redo:{fn:async h=>{var I;await v.dbTableColumn.primaryColumnSet(h),await k((I=i==null?void 0:i.value)==null?void 0:I.id,!0),u.emit(U.FIELD_RELOAD)},args:[(n=e==null?void 0:e.value)==null?void 0:n.id]},undo:{fn:async h=>{var I;await v.dbTableColumn.primaryColumnSet(h),await k((I=i==null?void 0:i.value)==null?void 0:I.id,!0),u.emit(U.FIELD_RELOAD)},args:[C==null?void 0:C.id]},scope:m({model:i.value})})}catch{Z.error(d("msg.error.primaryColumnUpdateFailed"))}},Q=async c=>{await J({column:e.value,direction:c,reloadDataHook:g})},K=L(!1),B=L(),H=L(),$e=async()=>{var l;let c={};const s=He(`${e.value.title} copy`,i.value.columns);c={...e.value,...e.value.colOptions??{},title:s,column_name:s.replace(/\s/g,"_"),id:void 0,colOptions:void 0,order:void 0,system:!1};try{const a=(await v.dbViewColumn.list((l=p.value)==null?void 0:l.id)).list,n=a.findIndex(h=>h.fk_column_id===e.value.id);let C;n===a.length-1?C=a[n].order+1:C=(a[n].order+a[n+1].order)/2,await v.dbTableColumn.create(i.value.id,{...c,pv:!1,view_id:p.value.id,column_order:{order:C,view_id:p.value.id}}),await k(i.value.id,!0),u.emit(U.FIELD_RELOAD),g==null||g.trigger()}catch(a){Z.error(await ie(a))}_.value=!1},Le=async()=>{var c;if(e!=null&&e.value)if(e.value.uidt&&[N.Lookup,N.Rollup,N.CreatedTime,N.LastModifiedTime,N.CreatedBy,N.LastModifiedBy].includes(e.value.uidt))$e();else{const s=(await v.dbViewColumn.list((c=p.value)==null?void 0:c.id)).list,l=s.findIndex(n=>n.fk_column_id===e.value.id);let a;l===s.length-1?a=s[l].order+1:a=(s[l].order+s[l+1].order)/2,B.value={pv:!1,view_id:p.value.id,column_order:{order:a,view_id:p.value.id}},e.value.uidt===N.Formula?Ze(()=>{var n;(n=H==null?void 0:H.value)==null||n.duplicate()}):K.value=!0,_.value=!1}},ce=async(c=!1)=>{var n,C,h,I;const s=(await v.dbViewColumn.list((n=p.value)==null?void 0:n.id)).list,l=s.findIndex(te=>te.fk_column_id===e.value.id);let a;c?l===0?a=s[l].order/2:a=(s[l].order+((C=s[l-1])==null?void 0:C.order))/2:l===s.length-1?a=s[l].order+1:a=(s[l].order+((h=s[l+1])==null?void 0:h.order))/2,M("addColumn",{column_order:{order:a,view_id:(I=p.value)==null?void 0:I.id}})},Oe=async()=>{var l;const s=(await v.dbViewColumn.list((l=p.value)==null?void 0:l.id)).list.find(a=>a.fk_column_id===e.value.id);await v.dbViewColumn.update(p.value.id,s.id,{show:!1}),u.emit(U.FIELD_RELOAD),$({redo:{fn:async function(n){await v.dbViewColumn.update(p.value.id,n,{show:!1}),u.emit(U.FIELD_RELOAD)},args:[s.id]},undo:{fn:async function(n){await v.dbViewColumn.update(p.value.id,n,{show:!0}),u.emit(U.FIELD_RELOAD)},args:[s.id]},scope:y({view:p.value})})},Ie=()=>{_.value=!1,G.value=!0},Me=()=>{_.value=!1,M("edit")},Ee=()=>{_.value=!1,ce(!0)},Ve=()=>{_.value=!1,ce()},Se=oe(()=>(e==null?void 0:e.value)&&!e.value.system),Te=oe(()=>(e==null?void 0:e.value)&&!e.value.system);return(c,s)=>{const l=Be,a=Re,n=xe,C=Fe,h=dt,I=pt,te=bt,P=Je("e");return o(),V(Ce,null,[t(j)?b("",!0):(o(),r(h,{key:0,visible:t(_),"onUpdate:visible":s[2]||(s[2]=E=>W(_)?_.value=E:null),trigger:["click"],placement:"bottomRight","overlay-class-name":"nc-dropdown-column-operations !border-1 rounded-lg !shadow-xl",onClick:s[3]||(s[3]=We(E=>_.value=!t(_),["stop"]))},{overlay:f(()=>[x(C,{class:"flex flex-col gap-1 border-gray-200 nc-column-options"},{default:f(()=>{var E,me,pe,ve,fe,_e,ye,we,be;return[x(a,{onClick:Me},{default:f(()=>[O("div",gt,[(o(),r(R(t(F).edit),{class:"text-gray-700"})),D(w(c.$t("general.edit")),1)])]),_:1}),(E=t(e))!=null&&E.pv?b("",!0):(o(),r(n,{key:0,class:"!my-0"})),(me=t(e))!=null&&me.pv?b("",!0):(o(),r(a,{key:1,onClick:Oe},{default:f(()=>[z((o(),V("div",Ct,[(o(),r(R(t(F).eye),{class:"text-gray-700 !w-3.75 !h-3.75"})),D(w(c.$t("general.hideField")),1)])),[[P,["a:field:hide"]]])]),_:1})),(!t(T)||((pe=t(e))==null?void 0:pe.uidt)===t(N).Formula)&&!((ve=t(e))!=null&&ve.pv)?(o(),r(a,{key:2,onClick:ee},{default:f(()=>[O("div",kt,[x(l,{icon:"star",class:"text-gray-700 !w-4.25 !h-4.25"}),D(w(c.$t("activity.setDisplay")),1)])]),_:1})):b("",!0),!t(se)(t(e))||t(e).colOptions.type!==t(ae).BELONGS_TO?(o(),r(n,{key:3,class:"!my-0"})):b("",!0),!t(se)(t(e))||t(e).colOptions.type!==t(ae).BELONGS_TO?(o(),V(Ce,{key:4},[x(a,{onClick:s[0]||(s[0]=Ae=>Q("asc"))},{default:f(()=>[z((o(),V("div",ht,[(o(),r(R(t(F).sortDesc),{class:"text-gray-700 !rotate-180 !w-4.25 !h-4.25",style:Qe({transform:"rotate(180deg)"})},null,8,["style"])),D(w(c.$t("general.sortAsc")),1)])),[[P,["a:field:sort",{dir:"asc"}]]])]),_:1}),x(a,{onClick:s[1]||(s[1]=Ae=>Q("desc"))},{default:f(()=>[z((o(),V("div",Dt,[(o(),r(R(t(F).sortDesc),{class:"text-gray-700 !w-4.25 !h-4.25 ml-0.5 mr-0.25"})),D(w(c.$t("general.sortDesc")),1)])),[[P,["a:field:sort",{dir:"desc"}]]])]),_:1})],64)):b("",!0),(fe=t(e))!=null&&fe.pk?b("",!0):(o(),r(n,{key:5,class:"!my-0"})),(_e=t(e))!=null&&_e.pk?b("",!0):(o(),r(a,{key:6,disabled:!Te.value,onClick:Le},{default:f(()=>[z((o(),V("div",xt,[(o(),r(R(t(F).duplicate),{class:"text-gray-700"})),D(w(t(d)("general.duplicate")),1)])),[[P,["a:field:duplicate"]]])]),_:1},8,["disabled"])),x(a,{onClick:Ve},{default:f(()=>[z((o(),V("div",$t,[(o(),r(R(t(F).colInsertAfter),{class:"text-gray-700 !w-4.5 !h-4.5"})),D(w(t(d)("general.insertAfter")),1)])),[[P,["a:field:insert:after"]]])]),_:1}),(ye=t(e))!=null&&ye.pv?b("",!0):(o(),r(a,{key:7,onClick:Ee},{default:f(()=>[z((o(),V("div",Lt,[(o(),r(R(t(F).colInsertBefore),{class:"text-gray-600 !w-4.5 !h-4.5"})),D(w(t(d)("general.insertBefore")),1)])),[[P,["a:field:insert:before"]]])]),_:1})),(we=t(e))!=null&&we.pv?b("",!0):(o(),r(n,{key:8,class:"!my-0"})),(be=t(e))!=null&&be.pv?b("",!0):(o(),r(a,{key:9,disabled:!Se.value,class:"!hover:bg-red-50",onClick:Ie},{default:f(()=>[O("div",Ot,[(o(),r(R(t(F).delete))),D(w(c.$t("general.delete")),1)])]),_:1},8,["disabled"]))]}),_:1})]),default:f(()=>[O("div",null,[x(l,{icon:"arrowDown",class:"text-grey h-full text-grey nc-ui-dt-dropdown cursor-pointer outline-0 mr-2"})])]),_:1},8,["visible"])),x(I,{visible:t(G),"onUpdate:visible":s[4]||(s[4]=E=>W(G)?G.value=E:null)},null,8,["visible"]),t(e)?(o(),r(te,{key:1,ref_key:"duplicateDialogRef",ref:H,modelValue:t(K),"onUpdate:modelValue":s[5]||(s[5]=E=>W(K)?K.value=E:null),column:t(e),extra:t(B)},null,8,["modelValue","column","extra"])):b("",!0)],64)}}});const ls=ut(It,[["__scopeId","data-v-49a5b554"]]);export{ls as default};
