import{_ as ue}from"./Tooltip.vue.971897f4.js";import{_ as de}from"./Select.vue.8e3ebbe2.js";import{f as pe,$ as fe,bb as u,r,g as f,aM as ve,H as me,fV as U,X as _e,Y as we,a6 as ye,o as v,c as j,O as t,P as C,w as d,a as g,aK as G,fo as E,S as O,b as R,d as N,t as k,T as Q,U as ge,V as he,cb as W,Q as be,R as xe,W as ke,bv as Se,C as Ce,eR as Oe}from"./entry.5958c07b.js";import{C as Ee,i as Ie,E as $e,m as Me,c as Ke,l as Ve,j as je,b as Re,r as Ne}from"./index.9b87fcff.js";import{b as Ae,a as Be}from"./bases.e6c8e3c4.js";import{u as X}from"./index.c35df397.js";import{_ as Pe}from"./index.27219acd.js";import{S as Fe}from"./index.5c6e4286.js";import{_ as Te}from"./_plugin-vue_export-helper.c27b6911.js";import"./Button.vue.c3ca0e8f.js";import"./index.55641318.js";import"./debounce.7c24f171.js";import"./toNumber.e09cd85a.js";import"./isSymbol.114fe557.js";import"./Icon.vue.129448d5.js";import"./index.0feaca99.js";import"./toArray.fd74ce6f.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.1dd071d8.js";import"./useState.b891c8bb.js";import"./CheckOutlined.1fe5f230.js";import"./SearchOutlined.a517903c.js";import"./FormItemContext.ddc65fa5.js";const qe=["onKeydown"],ze={key:0,class:"w-full"},De={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Le={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},He={class:"flex gap-2 text-gray-500 items-center h-full"},Ue={class:"text-xs whitespace-normal"},Ge=pe({__name:"SingleSelect",props:{modelValue:{},rowIndex:{},disableOptionCreation:{type:Boolean}},emits:["update:modelValue"],setup(A,{emit:Y}){const J=Y,{isMobileMode:B}=fe(),o=u(Ee),I=u(Ie),$=u($e,r(!1)),P=u(Me,r(!1)),M=u(Ke,r(!1)),Z=u(Ve,r(!1)),m=f(()=>P.value||$.value||M.value),_=r(),a=r(!1),F=u(je,r(!1)),T=u(Re,r(!1)),ee=u(Ne,r(!1)),{$api:te}=Ce(),w=r(),{getMeta:le}=Ae(),{isUIAllowed:q}=ve(),{isPg:z,isMysql:ae}=Be(),S=r(),K=r(!1),D=f(()=>!T.value&&!A.disableOptionCreation&&q("fieldEdit")),p=f(()=>{if(o!=null&&o.value.colOptions){const e=o.value.colOptions?o.value.colOptions.options.filter(l=>l.title!=="")||[]:[];for(const l of e.filter(n=>n.order===null))l.title=l.title.replace(/^'/,"").replace(/'$/,"");return e.map(l=>({...l,value:l.title}))}return[]}),se=f(()=>(p.value??[]).every(e=>e.title!==w.value)),V=f(()=>q("dataEdit")||M.value),y=f(()=>(V.value||M.value)&&m.value),c=f({get:()=>S.value??A.modelValue,set:e=>{if(e&&D.value&&(p.value??[]).every(l=>l.title!==e))return S.value=e,oe();J("update:modelValue",e||null)}});me(a,(e,l)=>{var n,s,b,x,i,H;y.value&&(e?(H=(i=(x=_.value)==null?void 0:x.$el)==null?void 0:i.querySelector("input"))==null||H.focus():(b=(s=(n=_.value)==null?void 0:n.$el)==null?void 0:s.querySelector("input"))==null||b.blur())}),X(P,e=>{var l;switch(e.key){case"Escape":a.value=!1;break;case"Enter":y.value&&m.value&&!a.value&&(a.value=!0);break;case" ":break;default:if(!y.value){e.preventDefault();break}!(e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)&&((l=e.key)==null?void 0:l.length)===1&&!Oe()&&(e.stopPropagation(),a.value=!0);break}}),X(a,e=>{e.key==="Escape"&&(a.value=!1)});async function oe(){var l,n;if(!S.value||T.value)return!1;const e=S.value;if(w.value="",S.value=void 0,e&&!p.value.some(s=>s.title===e))try{p.value.push({title:e,value:e,color:U.light[(p.value.length+1)%U.light.length]}),o.value.colOptions={options:p.value.map(({value:b,...x})=>x)};const s={...o.value};s.cdf&&(z(o.value.source_id)&&(s.cdf=s.cdf.substring(s.cdf.indexOf("'")+1,s.cdf.lastIndexOf("'"))),!ae(o.value.source_id)&&!z(o.value.source_id)&&(s.cdf=s.cdf.replace(/''/g,"'"))),await te.dbTableColumn.update(((l=o.value)==null?void 0:l.fk_column_id)||((n=o.value)==null?void 0:n.id),s),c.value=e,await le(o.value.fk_model_id,!0)}catch(s){console.log(s),_e.error(await we(s))}}const ne=()=>{var e,l,n;B.value||(w.value=(n=(l=(e=_.value)==null?void 0:e.$el)==null?void 0:l.querySelector(".ant-select-selection-search-input"))==null?void 0:n.value)},ie=e=>{a.value&&m.value&&e.stopPropagation(),e.key==="Enter"&&e.stopPropagation(),e.key==="Escape"&&(a.value=!1,setTimeout(()=>{var l;(l=_.value)==null||l.$el.querySelector(".ant-select-selection-search > input").focus()},100))},re=()=>{a.value=!1,$.value=!1},L=e=>{var l,n;if((l=e.target)!=null&&l.classList.contains("ant-select-clear")||(n=e.target)!=null&&n.closest(".ant-select-clear"))return c.value="",e.stopPropagation();K.value||(a.value=y.value&&!a.value)};ye(document,"click",e=>{a.value&&_.value&&!_.value.$el.contains(e.target)&&(a.value=!1)},!0);const h=f(()=>p.value.find(e=>{var l;return e.value===c.value||e.value===((l=c.value)==null?void 0:l.trim())})),ce=()=>{K.value=!0,setTimeout(()=>{K.value=!1},250),a.value=!0};return(e,l)=>{const n=ue,s=Pe,b=Fe,x=de;return v(),j("div",{class:O(["h-full w-full flex items-center nc-single-select focus:outline-transparent",{"read-only":t(I),"px-2":t(Z)}]),onClick:L,onKeydown:Se(W(L,["stop","prevent"]),["enter"])},[t(m)||t($)?(v(),C(x,{key:1,ref_key:"aselect",ref:_,value:t(c),"onUpdate:value":l[1]||(l[1]=i=>ke(c)?c.value=i:null),class:O(["w-full overflow-hidden xs:min-h-12",{"caret-transparent":!t(V)}]),placeholder:t(ee)?e.$t("labels.optional"):"","allow-clear":!t(o).rqd&&t(y),bordered:!1,open:t(a)&&t(y),disabled:t(I)||!t(y),"show-search":!t(B)&&t(a)&&t(m),"show-arrow":t(V)&&!t(I)&&t(m)&&(t(c)===null||t(c)===void 0),"dropdown-class-name":`nc-dropdown-single-select-cell !min-w-200px ${t(a)&&t(m)?"active":""}`,"dropdown-match-select-width":!0,onSelect:re,onKeydown:l[2]||(l[2]=i=>ie(i)),onSearch:ne,onBlur:l[3]||(l[3]=i=>a.value=!1),onFocus:ce},{default:d(()=>[(v(!0),j(ge,null,he(t(p),i=>(v(),C(b,{key:i.title,value:i.title,"data-testid":`select-option-${t(o).title}-${e.rowIndex}`,class:O(`nc-select-option-${t(o).title}-${i.title}`),onClick:l[0]||(l[0]=W(()=>{},["stop"]))},{default:d(()=>[R(s,{class:"rounded-tag max-w-full",color:i.color},{default:d(()=>[g("span",{style:G({color:t(E).isReadable(i.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":t(E).mostReadable(i.color||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:O({"text-sm":t(F)})},[R(n,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>[N(k(i.title),1)]),default:d(()=>[g("span",Le,k(i.title),1)]),_:2},1024)],6)]),_:2},1032,["color"])]),_:2},1032,["value","data-testid","class"]))),128)),t(w)&&t(se)&&t(D)?(v(),C(b,{key:t(w),value:t(w)},{default:d(()=>[g("div",He,[(v(),C(be(t(xe).plusThick),{class:"min-w-4"})),g("div",Ue,[N(k(e.$t("msg.selectOption.createNewOptionNamed"))+" ",1),g("strong",null,k(t(w)),1)])])]),_:1},8,["value"])):Q("",!0)]),_:1},8,["value","class","placeholder","allow-clear","open","disabled","show-search","show-arrow","dropdown-class-name"])):(v(),j("div",ze,[t(h)?(v(),C(s,{key:0,class:"rounded-tag max-w-full",color:t(h).color},{default:d(()=>[g("span",{style:G({color:t(E).isReadable(t(h).color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":t(E).mostReadable(t(h).color||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:O({"text-sm":t(F)})},[R(n,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>[N(k(t(h).title),1)]),default:d(()=>[g("span",De,k(t(h).title),1)]),_:1})],6)]),_:1},8,["color"])):Q("",!0)]))],42,qe)}}});const gt=Te(Ge,[["__scopeId","data-v-824a631a"]]);export{gt as default};
