import{_ as J}from"./TableIcon.vue.03001c7d.js";import{f as Q,bF as X,M as Y,r as b,i as q,n as M,c9 as K,o,c as _,a as t,O as i,au as E,P as f,w as y,Q as I,R as $,d as T,t as h,b as v,S as U,_ as N,T as W,d1 as R,X as w,Y as Z,a8 as ee,C as j}from"./entry.96205fa0.js";import{a as te}from"./bases.965a49bb.js";import{_ as se}from"./index.cd5853db.js";import{_ as ae}from"./index.aa7d30db.js";import"./index.0c5b3837.js";import"./eagerComputed.5bad0f6f.js";import"./useState.5a301439.js";import"./index.9e8f59f4.js";import"./debounce.1d5af9bf.js";import"./toNumber.ed208f2f.js";import"./isSymbol.d46b4957.js";import"./index.339951af.js";import"./LeftOutlined.5e2085dd.js";import"./RightOutlined.3ce786f5.js";import"./index.b5e393d6.js";import"./toArray.3561b70e.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.dbc63a5f.js";import"./CheckOutlined.3b90c20d.js";import"./SearchOutlined.c9794270.js";import"./FormItemContext.b19eb48c.js";import"./useBreakpoint.2e009418.js";import"./responsiveObserve.358bcfe9.js";import"./index.11096307.js";import"./index.0b4c0f1e.js";import"./Checkbox.cf2cdba0.js";import"./createForOfIteratorHelper.f2005dfe.js";import"./index.6c1d17b6.js";import"./Dropdown.1dedd322.js";import"./index.10eee714.js";import"./index.1431a68b.js";import"./Input.3f1aaf0c.js";import"./isPlainObject.631eb8fb.js";import"./_getPrototype.459a70cf.js";import"./TextArea.b81a19ed.js";import"./Password.803cc3dc.js";const oe={class:"flex flex-col w-full"},ne={class:"flex flex-col"},ie={class:"flex flex-row justify-between items-center w-full mb-4"},ce={class:"flex"},re={key:0},le={class:"flex items-center gap-2"},me={key:1},de={class:"flex items-center gap-2 text-gray-600 font-light"},pe={class:"max-h-600px overflow-y-auto"},ue={key:0},_e={class:"flex items-center gap-1"},fe={class:"min-w-5 flex items-center justify-center"},ye={class:"overflow-ellipsis min-w-0 shrink-1"},ve=t("div",{class:"flex place-content-center item-center"},null,-1),st=Q({__name:"Metadata",props:{sourceId:{}},emits:["baseSynced"],setup(B,{emit:L}){const x=B,P=L,{$api:S}=j(),D=te(),{loadTables:V}=D,{base:m}=X(D),{t:d}=Y(),n=b(!1),p=b(!1),u=b([]);async function g(){var e,c,a;try{if(!((e=m.value)!=null&&e.id))return;n.value=!0,p.value=!1,u.value=await S.source.metaDiffGet((c=m.value)==null?void 0:c.id,x.sourceId);for(const s of u.value)((a=s.detectedChanges)==null?void 0:a.length)>0&&(s.syncState=s.detectedChanges.map(r=>r==null?void 0:r.msg).join(", "),p.value=!0)}catch(s){console.error(s)}finally{n.value=!1}}const{$poller:A}=j();async function F(){var e,c;try{if(!((e=m.value)!=null&&e.id)||!p.value)return;n.value=!0;const a=await S.source.metaDiffSync((c=m.value)==null?void 0:c.id,x.sourceId);A.subscribe({id:a.id},async s=>{s.status!=="close"&&(s.status===R.COMPLETED?(w.info(d("msg.info.metaDataRecreated")),await V(),await g(),P("baseSynced"),n.value=!1):status===R.FAILED&&(w.error("Failed to sync base metadata"),n.value=!1))})}catch(a){w.error(await Z(a))}}q(async()=>{u.value.length===0&&await g()});const k=e=>()=>M("div",{class:"text-gray-500"},e),G=[{title:k(d("labels.models")),key:"table_name"},{title:k(d("labels.syncState")),dataIndex:"syncState",key:"syncState",customRender:e=>M("div",{style:{color:e.text?"red":"gray"}},e.text||d("msg.info.metaNoChange"))}];return(e,c)=>{const a=ee,s=se,r=N,z=J,O=ae,C=K("e");return o(),_("div",oe,[t("div",ne,[t("div",ie,[t("div",ce,[i(p)?(o(),_("div",re,[E((o(),f(a,{class:"nc-btn-metasync-sync-now",type:"primary",onClick:F},{default:y(()=>[t("div",le,[(o(),f(I(i($).databaseSync))),T(" "+h(e.$t("activity.metaSync")),1)])]),_:1})),[[C,["a:proj-meta:meta-data:sync"]]])])):(o(),_("div",me,[t("span",null,[v(s,{message:e.$t("msg.info.tablesMetadataInSync"),type:"success","show-icon":""},null,8,["message"])])]))]),E((o(),f(a,{class:"self-start !rounded-md nc-btn-metasync-reload",onClick:g},{default:y(()=>[t("div",de,[(o(),f(I(i($).reload),{class:U({"animate-infinite animate-spin !text-success":i(n)})},null,8,["class"])),T(" "+h(e.$t("general.reload")),1)])]),_:1})),[[C,["a:proj-meta:meta-data:reload"]]])]),t("div",pe,[v(O,{class:"w-full",size:"small","custom-row":l=>({class:`nc-metasync-row nc-metasync-row-${l.table_name}`}),"data-source":i(u)??[],columns:G,pagination:!1,loading:i(n),bordered:""},{emptyText:y(()=>[v(r,{image:i(N).PRESENTED_IMAGE_SIMPLE,description:e.$t("labels.noData")},null,8,["image","description"])]),bodyCell:y(({record:l,column:H})=>[H.key==="table_name"?(o(),_("div",ue,[t("div",_e,[t("div",fe,[v(z,{meta:l,class:"text-gray-500"},null,8,["meta"])]),t("span",ye,h(l.title||l.table_name),1)])])):W("",!0)]),_:1},8,["custom-row","data-source","loading"])])]),ve])}}});export{st as default};
